<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Seq Setup With API Key | James Hughes</title>
<meta name=keywords content="Seq,Docker"><meta name=description content="I was setting up a project that is made up of several Dotnet Core services and have a common logging service with Seq.  I decided to dockerize the app for easy debugging and couldn't, for the life of me, figure out how to set up seq with a default API Key! Here's how I did it."><meta name=author content><link rel=canonical href=https://blog.jimdhughes.com/posts/2020/docker-seq-setup-default-api-key/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.jimdhughes.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.jimdhughes.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.jimdhughes.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.jimdhughes.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.jimdhughes.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.jimdhughes.com/posts/2020/docker-seq-setup-default-api-key/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-0ET0VYDXCL"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0ET0VYDXCL")</script><meta property="og:url" content="https://blog.jimdhughes.com/posts/2020/docker-seq-setup-default-api-key/"><meta property="og:site_name" content="James Hughes"><meta property="og:title" content="Docker Seq Setup With API Key"><meta property="og:description" content="I was setting up a project that is made up of several Dotnet Core services and have a common logging service with Seq.  I decided to dockerize the app for easy debugging and couldn't, for the life of me, figure out how to set up seq with a default API Key! Here's how I did it."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-31T23:29:42-06:00"><meta property="article:modified_time" content="2020-07-31T23:29:42-06:00"><meta property="article:tag" content="Seq"><meta property="article:tag" content="Docker"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker Seq Setup With API Key"><meta name=twitter:description content="I was setting up a project that is made up of several Dotnet Core services and have a common logging service with Seq.  I decided to dockerize the app for easy debugging and couldn't, for the life of me, figure out how to set up seq with a default API Key! Here's how I did it."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Docker Seq Setup With API Key","item":"https://blog.jimdhughes.com/posts/2020/docker-seq-setup-default-api-key/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker Seq Setup With API Key","name":"Docker Seq Setup With API Key","description":"I was setting up a project that is made up of several Dotnet Core services and have a common logging service with Seq.  I decided to dockerize the app for easy debugging and couldn't, for the life of me, figure out how to set up seq with a default API Key! Here's how I did it.","keywords":["Seq","Docker"],"articleBody":"Here’s what happened I was playing around with a system that my team was building at work. The system, when deployed, will have 3 components living on 3 different servers with their networks locked down. You can think of it like:\na — b — c\nServer a can talk to server b, b to a and c, and c to b.\nTo test these without deploying to the actual environment, I figured I may as well dockerize it! Frequenting our stack at work is Seq which is a logging platform. Our components write to a common Seq setup to help us with debugging.\nOriginally, I wasn’t going to include the Seq configuration in my docker stack mostly because I was lazy. However I ran into an issue in my e2e test and I couldn’t, for the life of me, debug it. So instead of doing it right the first time, I had to go back and do it again. I had to add Seq to the stack.\nSeq requires an API Key for tools to log to it but you cannot configure the Seq docker image to have an API key by default. Since my setup is a ‘run and throwaway’ setup, I wasn’t mounting any volumes so I would lose any keys that I create in my Seq instance. I set out on a mission to find a better way\nProposed Solutions I found a few solutions on the web. Most of them were derivatives of this forum post. This solution suggests to load up the seqcli and to run a command on startup. Since seq takes a while to startup, you need to wait for it to come up. The forum suggests that we can fix this by doing something like this:\ncommand: /bin/bash -c \"sleep 10; /bin/seqcli/seqcli apikey create --title='newapikey' --token='123456' --server=http://seq\" For the life of me, I couldn’t get this to work. I think it’s because the seqcli docker image must run the seqcli command by default so any bash commands that I try to run just end up with an error stating:\nUsage: seqcli [] Type `seqcli help` for available commands After smacking my head against the wall, I deleted most of the start of the command. I ended up with this:\ncommand: apikey create -t newapikey --token 12345678901234567890 -s http://seq It worked! Sort of. Since I wasn’t waiting for seq to start up, I just kept getting the error:\nseqcli_1 | The command failed: Connection refused Which is expected since the image isn’t up yet.\nAfter some mulling, I remembered that docker-compose has the awesome restart feature which will… restart your container after a failure. Since this was issuing a failure command, I set the restart as follows\nrestart: on-failure On my next docker-compose up, it worked! Below is a minimal dockerfile to get seq up and running\nDocker-Compose version: \"3\" services: seqcli: image: datalust/seqcli:latest command: apikey create -t newapikey --token 12345678901234567890 -s http://seq depends_on: - seq restart: on-failure networks: - seqnetwork seq: image: datalust/seq:latest environment: - ACCEPT_EULA=Y ports: - 8003:80 networks: - seqnetwork networks: seqnetwork: Paste this into a docker-compose.yml file and run it. I’ve bound seq to a local port 8003 so I can see if it is working.\nHead over to http://localhost:8003 to see the seq dashboard. Head to settings -\u003e API Keys and you will see our very secret and not at all guessable key 12345678901234567890 Now you can pre-configure your docker-compose files to have an api key handed to all your services. Pretty decent right?\nHopefully this helps anyone that was stuck hacking around like I was earlier this week. This solution seems to work! Let me know if you have any better ideas below.\n","wordCount":"618","inLanguage":"en","datePublished":"2020-07-31T23:29:42-06:00","dateModified":"2020-07-31T23:29:42-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.jimdhughes.com/posts/2020/docker-seq-setup-default-api-key/"},"publisher":{"@type":"Organization","name":"James Hughes","logo":{"@type":"ImageObject","url":"https://blog.jimdhughes.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.jimdhughes.com/ accesskey=h title="James Hughes (Alt + H)">James Hughes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Docker Seq Setup With API Key</h1><div class=post-description>I was setting up a project that is made up of several Dotnet Core services and have a common logging service with Seq. I decided to dockerize the app for easy debugging and couldn't, for the life of me, figure out how to set up seq with a default API Key! Here's how I did it.</div><div class=post-meta><span title='2020-07-31 23:29:42 -0600 -0600'>July 31, 2020</span></div></header><div class=post-content><h1 id=heres-what-happened>Here&rsquo;s what happened<a hidden class=anchor aria-hidden=true href=#heres-what-happened>#</a></h1><p>I was playing around with a system that my team was building at work. The system, when deployed, will have 3 components living on 3 different servers with their networks locked down. You can think of it like:</p><p>a &mdash; b &mdash; c</p><p>Server a can talk to server b, b to a and c, and c to b.</p><p>To test these without deploying to the actual environment, I figured I may as well dockerize it! Frequenting our stack at work is <a href=https://datalust.co/seq>Seq</a> which is a logging platform. Our components write to a common Seq setup to help us with debugging.</p><p>Originally, I wasn&rsquo;t going to include the Seq configuration in my docker stack mostly because I was lazy. However I ran into an issue in my e2e test and I couldn&rsquo;t, for the life of me, debug it. So instead of doing it right the first time, I had to go back and do it again. I had to add Seq to the stack.</p><p>Seq requires an API Key for tools to log to it but you cannot configure the Seq docker image to have an API key by default. Since my setup is a &lsquo;run and throwaway&rsquo; setup, I wasn&rsquo;t mounting any volumes so I would lose any keys that I create in my Seq instance. I set out on a mission to find a better way</p><h1 id=proposed-solutions>Proposed Solutions<a hidden class=anchor aria-hidden=true href=#proposed-solutions>#</a></h1><p>I found a few solutions on the web. Most of them were derivatives of <a href=https://docs.datalust.co/discuss/5e552e8bdc8f4c3e8d41d4a4>this forum post</a>. This solution suggests to load up the seqcli and to run a command on startup. Since seq takes a while to startup, you need to wait for it to come up. The forum suggests that we can fix this by doing something like this:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>command: /bin/bash -c &#34;sleep 10; /bin/seqcli/seqcli apikey create --title=&#39;newapikey&#39; --token=&#39;123456&#39; --server=http://seq&#34;
</code></pre><p>For the life of me, I couldn&rsquo;t get this to work.
I think it&rsquo;s because the seqcli docker image <em>must</em> run the <code>seqcli</code> command by default so any bash commands that I try to run just end up with an error stating:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>Usage: seqcli &lt;command&gt; [&lt;args&gt;]
Type `seqcli help` for available commands
</code></pre><p>After smacking my head against the wall, I deleted most of the start of the command. I ended up with this:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>command: apikey create -t newapikey --token 12345678901234567890 -s http://seq
</code></pre><p>It worked! Sort of. Since I wasn&rsquo;t waiting for seq to start up, I just kept getting the error:</p><pre tabindex=0><code class=language-terminal data-lang=terminal>seqcli_1         | The command failed: Connection refused
</code></pre><p>Which is expected since the image isn&rsquo;t up yet.</p><p>After some mulling, I remembered that docker-compose has the awesome <code>restart</code> feature which will&mldr; restart your container after a failure. Since this was issuing a failure command, I set the <code>restart</code> as follows</p><pre tabindex=0><code class=language-terminal data-lang=terminal>restart: on-failure
</code></pre><p>On my next docker-compose up, it worked! Below is a minimal dockerfile to get seq up and running</p><h1 id=docker-compose>Docker-Compose<a hidden class=anchor aria-hidden=true href=#docker-compose>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>seqcli</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>datalust/seqcli:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: <span style=color:#ae81ff>apikey create -t newapikey --token 12345678901234567890 -s http://seq</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>seq</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#66d9ef>on</span>-<span style=color:#ae81ff>failure</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>seqnetwork</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>seq</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>datalust/seq:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ACCEPT_EULA=Y</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>8003</span>:<span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>seqnetwork</span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>seqnetwork</span>:
</span></span></code></pre></div><p>Paste this into a <code>docker-compose.yml</code> file and run it. I&rsquo;ve bound seq to a local port <code>8003</code> so I can see if it is working.</p><p>Head over to <code>http://localhost:8003</code> to see the seq dashboard. Head to settings -> API Keys and you will see our very secret and not at all guessable key <code>12345678901234567890</code> Now you can pre-configure your docker-compose files to have an api key handed to all your services. Pretty decent right?</p><p>Hopefully this helps anyone that was stuck hacking around like I was earlier this week. This solution seems to work! Let me know if you have any better ideas below.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.jimdhughes.com/tags/seq/>Seq</a></li><li><a href=https://blog.jimdhughes.com/tags/docker/>Docker</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.jimdhughes.com/>James Hughes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>