<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Designing an Open Data Stack - Part 2 | James Hughes</title>
<meta name=keywords content="data,open-source"><meta name=description content="Designing an Open Data Stack - Part 2"><meta name=author content="James D Hughes"><link rel=canonical href=https://blog.jimdhughes.com/posts/2025/open-data-stack-p2/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.jimdhughes.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.jimdhughes.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.jimdhughes.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.jimdhughes.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.jimdhughes.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.jimdhughes.com/posts/2025/open-data-stack-p2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-0ET0VYDXCL"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0ET0VYDXCL")</script><meta property="og:url" content="https://blog.jimdhughes.com/posts/2025/open-data-stack-p2/"><meta property="og:site_name" content="James Hughes"><meta property="og:title" content="Designing an Open Data Stack - Part 2"><meta property="og:description" content="Designing an Open Data Stack - Part 2"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-01T00:00:00-06:00"><meta property="article:modified_time" content="2025-04-01T00:00:00-06:00"><meta property="article:tag" content="Data"><meta property="article:tag" content="Open-Source"><meta name=twitter:card content="summary"><meta name=twitter:title content="Designing an Open Data Stack - Part 2"><meta name=twitter:description content="Designing an Open Data Stack - Part 2"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Designing an Open Data Stack - Part 2","item":"https://blog.jimdhughes.com/posts/2025/open-data-stack-p2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Designing an Open Data Stack - Part 2","name":"Designing an Open Data Stack - Part 2","description":"Designing an Open Data Stack - Part 2","keywords":["data","open-source"],"articleBody":"Dagster As with most initiatives in technology… It seems that my first plan is never my purest plan. Setting up Dagster in Docker was confusing for me. Honestly, I almost gave up the blog series dream as I just didn’t have a lot of time to sit down and troubleshoot. HOWEVER\nHere we are, to continue the good fight. I picked myself up by my shoelaces and got to work getting this thing up and running. For that reason, I’m probably going to have to break blog part 2 into a couple of parts to really get the point across.\nThe official docs for setting up Dagster with docker-compose can be found here: https://docs.dagster.io/guides/deploy/deployment-options/docker The documentation leaves something to be desired, however.\nThe full example that exists on Github is located here: https://github.com/dagster-io/dagster/tree/master/examples/deploy_docker\nWith all good troubleshooting scenarios, this is what I ended up turning to to figure out why I couldn’t get my stuff up and running. So I’m going to drag you through my epic journey of setting up Dagster w/ Docker compose, and the re-working of my previous docker-compose.yaml file that only contained my minio services.\nAfter poking around for a while, I understand the Dagster Architecture to look a little like this:\n--- title: Dagster Architecture --- flowchart LR A[Dagster Webserver] B[Dagster Daemon] C[Daemon Workers 1..n] D[Dagster Code Locations] DB[(PostgreSQL)] DB1[(Dagster Volume)] A--GRPC---D A----DB B----DB C----DB B---C A--fs---DB1 B--fs---DB1 Where the Dagster Webserver is the main user interface of the application, deployed on its own. The Dagster Daemon is 1-n services running configured to handle particular jobs. In this case, we’ll set up exactly 1.\nThe Dagster Webserver and Dagster Daemon need to communicate between each other using a shared volume + PostgreSQL (this tripped me up for quite a while, honestly)\nThe Dagster Daemon will indicate it’s running my sharing log files in the shared volume location. The Dagster Web Server will know the daemons are running based on there being files dropped there. Make sense so far?\nDagster Codespaces are independently deployable pipeline code repositories that you can coordinate by leveraging Dagster Webserver. You will need to configure your workspace.yaml files to indicate this (not clear in the documentation, clearer in the github)\nDagster.yaml will also need to be configured according to the github reference which was also not clear from the documentation page.\nDirectory Structure /opendatastack data/ dagsterCode/ .env dagster.yaml docker-compose.yaml Dockerfile_code_location_1 Dockerfile_dagster workspace.yaml Dockerfile_dagster This comes right from the official documentation, essentially this is creating a dagster image for you to re-use in your docker-compose. It’s a minimal setup with all the configuration coming form workspace.yaml and dagster.yaml. This become increasingly obvious later.\nFROM python:3.10-slim RUN pip install \\ dagster \\ dagster-graphql \\ dagster-webserver \\ dagster-postgres \\ dagster-docker # Set $DAGSTER_HOME and copy dagster.yaml and workspace.yaml there ENV DAGSTER_HOME=/opt/dagster/dagster_home/ RUN mkdir -p $DAGSTER_HOME COPY dagster.yaml workspace.yaml $DAGSTER_HOME WORKDIR $DAGSTER_HOME Dagster WebServer, Daemons, and PostgreSQL Next, we’re going to use basically the same docker-compose file from the official documentation above, but I want to get it set up very minimally to begin. I’m taking you down this path instead of the ‘straight in’ version I went with that had me scratching my head for a while trying to figure out what was going on.\nFor the webserver and daemon services to run, we need to set up only 3 of the services to start from the example docker-compose.\nservices: docker_example_postgresql: image: postgres:11 container_name: docker_example_postgresql environment: POSTGRES_USER: ${POSTGRES_USER} POSTGRES_PASSWORD: ${POSTGRES_PASS} POSTGRES_DB: ${POSTGRES_DB} volumes: # this is a change from the official docs. I want to persist my postgres data in a known volume - ./data/postgres:/var/lib/postgresql/data networks: - docker_example_network healthcheck: test: ['CMD-SHELL', 'pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}'] interval: 10s timeout: 8s retries: 5 docker_example_webserver: build: context: . dockerfile: ./Dockerfile_dagster entrypoint: - dagster-webserver - -h - '0.0.0.0' - -p - '3000' - -w - workspace.yaml container_name: docker_example_webserver expose: - '3000' ports: - '3000:3000' environment: DAGSTER_POSTGRES_USER: ${POSTGRES_USER} DAGSTER_POSTGRES_PASSWORD: ${POSTGRES_PASS} DAGSTER_POSTGRES_DB: ${POSTGRES_DB} volumes: - /var/run/docker.sock:/var/run/docker.sock - /tmp/io_manager_storage:/tmp/io_manager_storage networks: - docker_example_network depends_on: docker_example_postgresql: condition: service_healthy docker_example_daemon: build: context: . dockerfile: ./Dockerfile_dagster entrypoint: - dagster-daemon - run container_name: docker_example_daemon restart: on-failure environment: DAGSTER_POSTGRES_USER: ${POSTGRES_USER} DAGSTER_POSTGRES_PASSWORD: ${POSTGRES_PASS} DAGSTER_POSTGRES_DB: ${POSTGRES_DB} volumes: - /var/run/docker.sock:/var/run/docker.sock - /tmp/io_manager_storage:/tmp/io_manager_storage networks: - docker_example_network depends_on: docker_example_postgresql: condition: service_healthy networks: docker_example_network: driver: bridge name: docker_example_network As a good practice, never hardcode your credentials into your docker files. In the previous blog post I introduced the usage of .env files with docker compose, so go ahead and update your secrets in that .env file. They map to the ${variable_name} in the docker file.\nMINIO_USER=minio MINIO_PASS=minio123 POSTGRES_USER=postgres_user POSTGRES_PASS=pgpassword POSTGRES_DB=postgres Also, these are terrible passwords. Don’t use these passwords for real. This setup configures the Dagster Webserver, Dagster Daemon, and PostgreSQL to be used with our setup. There is a shared volume mapped to your local machine (/tmp/io_manager_storage) where the webserver and daemon can communicate with each other. Later, I might find a better way to handle this but for now, it’s mapping to a shared volume on my local machine.\nNext, according to the documentation, you need to include a dagster.yaml. You can find a full version of it at the github location above, or the snippet below:\nscheduler: module: dagster.core.scheduler class: DagsterDaemonScheduler run_coordinator: module: dagster.core.run_coordinator class: QueuedRunCoordinator config: max_concurrent_runs: 5 tag_concurrency_limits: - key: \"operation\" value: \"example\" limit: 5 run_launcher: module: dagster_docker class: DockerRunLauncher config: env_vars: - DAGSTER_POSTGRES_USER - DAGSTER_POSTGRES_PASSWORD - DAGSTER_POSTGRES_DB network: docker_example_network container_kwargs: volumes: # Make docker client accessible to any launched containers as well - /var/run/docker.sock:/var/run/docker.sock - /tmp/io_manager_storage:/tmp/io_manager_storage run_storage: module: dagster_postgres.run_storage class: PostgresRunStorage config: postgres_db: hostname: docker_example_postgresql username: env: DAGSTER_POSTGRES_USER password: env: DAGSTER_POSTGRES_PASSWORD db_name: env: DAGSTER_POSTGRES_DB port: 5432 schedule_storage: module: dagster_postgres.schedule_storage class: PostgresScheduleStorage config: postgres_db: hostname: docker_example_postgresql username: env: DAGSTER_POSTGRES_USER password: env: DAGSTER_POSTGRES_PASSWORD db_name: env: DAGSTER_POSTGRES_DB port: 5432 event_log_storage: module: dagster_postgres.event_log class: PostgresEventLogStorage config: postgres_db: hostname: docker_example_postgresql username: env: DAGSTER_POSTGRES_USER password: env: DAGSTER_POSTGRES_PASSWORD db_name: env: DAGSTER_POSTGRES_DB port: 5432 Next, a very minimal workspace.yaml which we will completely replace in a few minutes …\nload_from: - python_file: my_file.py Then docker compose up and wait …\nNOTE this is probably going to give you an error in the dagster UI - but don’t worry, it’s an expected error.\nHead over to http://localhost:3000 and voila! Dagster is running and our code location is, as expected, not loading! Because it can’t be found\nBecause this file doesn’t exist…\nAnywhere…\nSo onto the next section\nDagster Code Locations This is where I got confused for a while. Dagster Code Locations. Why do they need to be a container? Why indeed!\nIt’s because they’re separating out projects to make deployment easier. Your core functionality is running as a platform, then your code is running and integrated to the orchestration platform, leaving you free to have multiple teams running multiple projects and leveraging the same platform!\nSo what are we going to do next? Let’s write an extremely minimal Dag!\nRefer back to my preferred organization code to be in the folder called dagsterCode/demo, for now. I’m going to include the definitions.py from the github docker example linked above for this example just to show that things can sort of work! At dagsterCode/demo/definitions.py copy/paste the following:\nimport dagster as dg @dg.asset( op_tags={\"operation\": \"example\"}, partitions_def=dg.DailyPartitionsDefinition(\"2025-01-01\"), ) def example_asset(context: dg.AssetExecutionContext): context.log.info(context.partition_key) partitioned_asset_job = dg.define_asset_job(\"partitioned_job\", selection=[example_asset]) defs = dg.Definitions(assets=[example_asset], jobs=[partitioned_asset_job]) It doesn’t do a lot, it defines an asset called example_asset, configures it to have partitions that are of the daily variety starting from 2025-01-01. It then logs the partition key. That’s it. That’s all. Let’s make it work now!\nIn the dockerfile called Dockerfile_code_location_1 let’s get setup:\nFROM python:3.10-slim RUN pip install \\ dagster \\ dagster-postgres \\ dagster-docker # Add code location code WORKDIR /opt/dagster/app COPY dagsterCode/demo /opt/dagster/app # Run dagster code server on port 4000 EXPOSE 4000 # CMD allows this to be overridden from run launchers or executors to execute runs and steps CMD [\"dagster\", \"code-server\", \"start\", \"-h\", \"0.0.0.0\", \"-p\", \"4000\", \"-f\", \"definitions.py\"] Next let’s update our docker_compose to use this dockerfile!\nservices: # ... \u003c- Means I'm ommitting stuff for brevity. Just make changes in the services. # new service docker_example_user_code: build: context: . dockerfile: ./Dockerfile_code_location_1 container_name: docker_example_user_code image: docker_example_user_code_image restart: always environment: DAGSTER_POSTGRES_USER: ${POSTGRES_USER} DAGSTER_POSTGRES_PASSWORD: ${POSTGRES_PASS} DAGSTER_POSTGRES_DB: ${POSTGRES_DB} DAGSTER_CURRENT_IMAGE: 'docker_example_user_code_image' expose: - '4000' ports: - '4000:4000' networks: - docker_example_network # ... docker_example_webserver: # ...Only update depends_on here depends_on: docker_example_postgresql: condition: service_healthy docker_example_user_code: condition: service_started # ... docker_example_daemon: # ... Only update depends_on here depends_on: docker_example_postgresql: condition: service_healthy docker_example_user_code: condition: service_started We created a new container called docker_example_user_code and informed both the webserver and the daemon that they need this to successfully run before we they are allowed to boot up.\nNow we make changes to our workspace.yaml again - which will instruct Dagster webserver and daemon to connect to the GRPC server hosted at the internal docker hosted location called docker_example_user_code\nload_from: - grpc_server: host: docker_example_user_code port: 4000 location_name: demo Now.. docker compose up --build \u003c- Build instructs the system to rebuild the docker containers previously built locally (Dockerfile_dagster and Dockerfile_code_location_1 as we’ve updated the workspace.yaml file that’ll be loaded in)\nNext, I say a small prayer…\nThat little ‘Loaded’ means everything worked great!\nCheck the daemons link to make sure all your daemons are running: Then Navigate to assets and click example_asset and click materialize and choose how you want to tackle it. You could just do the latest, or select a date range to populate, or instruct it to backfill only failed and missing partitions within selection. Regardless, it’s just going to log out dates anyways.\nOnce it’s done, you can click into it by pressing the little green pill and look at the output - it’s going to show you the date you ran it for (I ran it for 2025-04-01)\nThere you have it! Dagster webserver is up and running! We have a good foundation to work with to start building our orchestration pipelines!\nWe’re missing one item though, our dockerfile is missing the minio service we created in part 1. For continuity, I’m going to add it in the dockerfile and paste the results below. We’ll now have Minio AND our Dagster Stack running on our local docker setup.\nservices: # ... omitted for brevity minio: image: quay.io/minio/minio command: server --console-address \":9001\" /data volumes: - ./data/minio:/data expose: - \"9000\" - \"9001\" ports: - \"9000:9000\" - \"9001:9001\" environment: MINIO_ROOT_USER: ${MINIO_USER} MINIO_ROOT_PASSWORD: ${MINIO_PASS} healthcheck: test: [ \"CMD\", \"mc\", \"ready\", \"local\" ] interval: 5s timeout: 5s retries: 5 networks: - docker_example_network # ... That’s it!\nIn the next blog post I’m going to talk about how to create a non-trivial dagster project, extract some data with some partitions, develop locally using dagster dev and finally publish it to my fancy new dagster project!\n","wordCount":"1772","inLanguage":"en","datePublished":"2025-04-01T00:00:00-06:00","dateModified":"2025-04-01T00:00:00-06:00","author":{"@type":"Person","name":"James D Hughes"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.jimdhughes.com/posts/2025/open-data-stack-p2/"},"publisher":{"@type":"Organization","name":"James Hughes","logo":{"@type":"ImageObject","url":"https://blog.jimdhughes.com/favicon.ico"}}}</script></head><body id="
  top"><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.jimdhughes.com/ accesskey=h title="James Hughes (Alt + H)">James Hughes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Designing an Open Data Stack - Part 2</h1><div class=post-description>Designing an Open Data Stack - Part 2</div><div class=post-meta><span title='2025-04-01 00:00:00 -0600 -0600'>April 1, 2025</span>&nbsp;·&nbsp;James D Hughes</div></header><div class=post-content><h1 id=dagster>Dagster<a hidden class=anchor aria-hidden=true href=#dagster>#</a></h1><p>As with most initiatives in technology&mldr; It seems that my first plan is never my purest plan.
Setting up Dagster in Docker was <em>confusing</em> for me. Honestly, I almost gave up the blog series dream as I just didn&rsquo;t have a lot of time to sit down and troubleshoot.
HOWEVER</p><p>Here we are, to continue the good fight. I picked myself up by my shoelaces and got to work getting this thing up and running. For that reason, I&rsquo;m probably going to have to break blog part 2 into a couple of parts to really get the point across.</p><p>The official docs for setting up Dagster with docker-compose can be found here: <a href=https://docs.dagster.io/guides/deploy/deployment-options/docker>https://docs.dagster.io/guides/deploy/deployment-options/docker</a>
The documentation leaves something to be desired, however.</p><p>The full example that exists on Github is located here: <a href=https://github.com/dagster-io/dagster/tree/master/examples/deploy_docker>https://github.com/dagster-io/dagster/tree/master/examples/deploy_docker</a></p><p>With all good troubleshooting scenarios, this is what I ended up turning to to figure out why I couldn&rsquo;t get my stuff up and running. So I&rsquo;m going to drag you through my epic journey of setting up Dagster w/ Docker compose, and the re-working of my previous <code>docker-compose.yaml</code> file that only contained my minio services.</p><p>After poking around for a while, I understand the Dagster Architecture to look a little like this:</p><pre class=mermaid>
  ---
title: Dagster Architecture
---
flowchart LR
  A[Dagster Webserver]
  B[Dagster Daemon]
  C[Daemon Workers 1..n]
  D[Dagster Code Locations]
  DB[(PostgreSQL)]
  DB1[(Dagster Volume)]

  A--GRPC---D
  A----DB
  B----DB
  C----DB
  B---C
  A--fs---DB1
  B--fs---DB1
</pre><p>Where the Dagster Webserver is the main user interface of the application, deployed on its own.
The Dagster Daemon is 1-n services running configured to handle particular jobs. In this case, we&rsquo;ll set up exactly 1.</p><p>The Dagster Webserver and Dagster Daemon need to communicate between each other using a shared volume + PostgreSQL (this tripped me up for quite a while, honestly)</p><p>The Dagster Daemon will indicate it&rsquo;s running my sharing log files in the shared volume location. The Dagster Web Server will know the daemons are running based on there being files dropped there. Make sense so far?</p><p>Dagster Codespaces are <em>independently deployable</em> pipeline code repositories that you can coordinate by leveraging Dagster Webserver. You will need to configure your <code>workspace.yaml</code> files to indicate this (not clear in the documentation, clearer in the github)</p><p><code>Dagster.yaml</code> will also need to be configured according to the github reference which was also not clear from the documentation page.</p><h1 id=directory-structure>Directory Structure<a hidden class=anchor aria-hidden=true href=#directory-structure>#</a></h1><pre tabindex=0><code>/opendatastack
  data/
  dagsterCode/
    
  .env
  dagster.yaml
  docker-compose.yaml
  Dockerfile_code_location_1
  Dockerfile_dagster
  workspace.yaml
</code></pre><h2 id=dockerfile_dagster>Dockerfile_dagster<a hidden class=anchor aria-hidden=true href=#dockerfile_dagster>#</a></h2><p>This comes right from the official documentation, essentially this is creating a dagster image for you to re-use in your docker-compose. It&rsquo;s a minimal setup with all the configuration coming form <code>workspace.yaml</code> and <code>dagster.yaml</code>. This become increasingly obvious later.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> python:3.10-slim</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip install <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    dagster <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    dagster-graphql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    dagster-webserver <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    dagster-postgres <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    dagster-docker<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Set $DAGSTER_HOME and copy dagster.yaml and workspace.yaml there</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> DAGSTER_HOME<span style=color:#f92672>=</span>/opt/dagster/dagster_home/<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir -p $DAGSTER_HOME<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> dagster.yaml workspace.yaml $DAGSTER_HOME<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> $DAGSTER_HOME</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=dagster-webserver-daemons-and-postgresql>Dagster WebServer, Daemons, and PostgreSQL<a hidden class=anchor aria-hidden=true href=#dagster-webserver-daemons-and-postgresql>#</a></h2><p>Next, we&rsquo;re going to use <strong>basically</strong> the same <code>docker-compose</code> file from the official documentation above, but I want to get it set up very minimally to begin. I&rsquo;m taking you down this path instead of the &lsquo;straight in&rsquo; version I went with that had me scratching my head for a while trying to figure out what was going on.</p><p>For the webserver and daemon services to run, we need to set up only 3 of the services to start from the example <code>docker-compose</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span>services:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  docker_example_postgresql:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    image: postgres:11<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    container_name: docker_example_postgresql<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    environment:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      POSTGRES_USER: <span style=color:#e6db74>${</span>POSTGRES_USER<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      POSTGRES_PASSWORD: <span style=color:#e6db74>${</span>POSTGRES_PASS<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      POSTGRES_DB: <span style=color:#e6db74>${</span>POSTGRES_DB<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    volumes:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      <span style=color:#75715e># this is a change from the official docs. I want to persist my postgres data in a known volume</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - ./data/postgres:/var/lib/postgresql/data<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    networks:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - docker_example_network<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    healthcheck:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      test: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;CMD-SHELL&#39;</span>, <span style=color:#e6db74>&#39;pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}&#39;</span><span style=color:#f92672>]</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      interval: 10s<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      timeout: 8s<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      retries: <span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  docker_example_webserver:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    build:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      context: .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      dockerfile: ./Dockerfile_dagster<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    entrypoint:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - dagster-webserver<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - -h<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#39;0.0.0.0&#39;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - -p<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#39;3000&#39;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - -w<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - workspace.yaml<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    container_name: docker_example_webserver<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    expose:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#39;3000&#39;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    ports:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#39;3000:3000&#39;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    environment:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_POSTGRES_USER: <span style=color:#e6db74>${</span>POSTGRES_USER<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_POSTGRES_PASSWORD: <span style=color:#e6db74>${</span>POSTGRES_PASS<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_POSTGRES_DB: <span style=color:#e6db74>${</span>POSTGRES_DB<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    volumes:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - /var/run/docker.sock:/var/run/docker.sock<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - /tmp/io_manager_storage:/tmp/io_manager_storage<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    networks:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - docker_example_network<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    depends_on:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      docker_example_postgresql:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        condition: service_healthy<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  docker_example_daemon:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    build:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      context: .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      dockerfile: ./Dockerfile_dagster<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    entrypoint:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - dagster-daemon<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - run<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    container_name: docker_example_daemon<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    restart: on-failure<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    environment:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_POSTGRES_USER: <span style=color:#e6db74>${</span>POSTGRES_USER<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_POSTGRES_PASSWORD: <span style=color:#e6db74>${</span>POSTGRES_PASS<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_POSTGRES_DB: <span style=color:#e6db74>${</span>POSTGRES_DB<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    volumes: <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - /var/run/docker.sock:/var/run/docker.sock<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - /tmp/io_manager_storage:/tmp/io_manager_storage<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    networks:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - docker_example_network<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    depends_on:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      docker_example_postgresql:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        condition: service_healthy<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>networks:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  docker_example_network:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    driver: bridge<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    name: docker_example_network<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>As a good practice, never hardcode your credentials into your docker files. In the previous blog post I introduced the usage of <code>.env</code> files with docker compose, so go ahead and update your secrets in that <code>.env</code> file. They map to the <code>${variable_name}</code> in the docker file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>MINIO_USER<span style=color:#f92672>=</span>minio
</span></span><span style=display:flex><span>MINIO_PASS<span style=color:#f92672>=</span>minio123
</span></span><span style=display:flex><span>POSTGRES_USER<span style=color:#f92672>=</span>postgres_user
</span></span><span style=display:flex><span>POSTGRES_PASS<span style=color:#f92672>=</span>pgpassword
</span></span><span style=display:flex><span>POSTGRES_DB<span style=color:#f92672>=</span>postgres
</span></span></code></pre></div><p>Also, these are terrible passwords. Don&rsquo;t use these passwords for real. This setup configures the Dagster Webserver, Dagster Daemon, and PostgreSQL to be used with our setup. There is a shared volume mapped to your local machine (<code>/tmp/io_manager_storage</code>) where the webserver and daemon can communicate with each other. Later, I might find a better way to handle this but for now, it&rsquo;s mapping to a shared volume on my local machine.</p><p>Next, according to the documentation, you need to include a <code>dagster.yaml</code>. You can find a full version of it at the github location above, or the snippet below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scheduler</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>module</span>: <span style=color:#ae81ff>dagster.core.scheduler</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>class</span>: <span style=color:#ae81ff>DagsterDaemonScheduler</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>run_coordinator</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>module</span>: <span style=color:#ae81ff>dagster.core.run_coordinator</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>class</span>: <span style=color:#ae81ff>QueuedRunCoordinator</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>max_concurrent_runs</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tag_concurrency_limits</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>key</span>: <span style=color:#e6db74>&#34;operation&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;example&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>limit</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>run_launcher</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>module</span>: <span style=color:#ae81ff>dagster_docker</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>class</span>: <span style=color:#ae81ff>DockerRunLauncher</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>env_vars</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DAGSTER_POSTGRES_USER</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DAGSTER_POSTGRES_PASSWORD</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DAGSTER_POSTGRES_DB</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>network</span>: <span style=color:#ae81ff>docker_example_network</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_kwargs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>: <span style=color:#75715e># Make docker client accessible to any launched containers as well</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>/var/run/docker.sock:/var/run/docker.sock</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>/tmp/io_manager_storage:/tmp/io_manager_storage</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>run_storage</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>module</span>: <span style=color:#ae81ff>dagster_postgres.run_storage</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>class</span>: <span style=color:#ae81ff>PostgresRunStorage</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>postgres_db</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>docker_example_postgresql</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>username</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>: <span style=color:#ae81ff>DAGSTER_POSTGRES_USER</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>password</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>: <span style=color:#ae81ff>DAGSTER_POSTGRES_PASSWORD</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>db_name</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>: <span style=color:#ae81ff>DAGSTER_POSTGRES_DB</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>schedule_storage</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>module</span>: <span style=color:#ae81ff>dagster_postgres.schedule_storage</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>class</span>: <span style=color:#ae81ff>PostgresScheduleStorage</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>postgres_db</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>docker_example_postgresql</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>username</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>: <span style=color:#ae81ff>DAGSTER_POSTGRES_USER</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>password</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>: <span style=color:#ae81ff>DAGSTER_POSTGRES_PASSWORD</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>db_name</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>: <span style=color:#ae81ff>DAGSTER_POSTGRES_DB</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>event_log_storage</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>module</span>: <span style=color:#ae81ff>dagster_postgres.event_log</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>class</span>: <span style=color:#ae81ff>PostgresEventLogStorage</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>postgres_db</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>docker_example_postgresql</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>username</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>: <span style=color:#ae81ff>DAGSTER_POSTGRES_USER</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>password</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>: <span style=color:#ae81ff>DAGSTER_POSTGRES_PASSWORD</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>db_name</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>: <span style=color:#ae81ff>DAGSTER_POSTGRES_DB</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>5432</span>
</span></span></code></pre></div><p>Next, a very minimal <code>workspace.yaml</code> which we will completely replace in a few minutes &mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>load_from</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>python_file</span>: <span style=color:#ae81ff>my_file.py</span>
</span></span></code></pre></div><p>Then <code>docker compose up</code> and wait &mldr;</p><p><strong>NOTE</strong> this is probably going to give you an error in the dagster UI - but don&rsquo;t worry, it&rsquo;s an expected error.</p><p>Head over to http://localhost:3000 and voila! Dagster is running and our code location is, as expected, not loading!
<img alt="Good Error" loading=lazy src=img/good_error.png></p><p>Because it can&rsquo;t be found</p><p>Because this file doesn&rsquo;t exist&mldr;</p><p>Anywhere&mldr;</p><p>So onto the next section</p><h2 id=dagster-code-locations>Dagster Code Locations<a hidden class=anchor aria-hidden=true href=#dagster-code-locations>#</a></h2><p>This is where I got confused for a while. Dagster Code Locations. Why do they need to be a container? Why indeed!</p><p>It&rsquo;s because they&rsquo;re separating out projects to make deployment easier. Your core functionality is running as a platform, then your code is running and integrated to the orchestration platform, leaving you free to have multiple teams running multiple projects and leveraging the same platform!</p><p>So what are we going to do next?
Let&rsquo;s write an extremely minimal Dag!</p><p>Refer back to my preferred organization code to be in the folder called <code>dagsterCode/demo</code>, for now. I&rsquo;m going to include the <code>definitions.py</code> from the github docker example linked above for this example just to show that things can sort of work!
At <code>dagsterCode/demo/definitions.py</code> copy/paste the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> dagster <span style=color:#66d9ef>as</span> dg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@dg.asset</span>(
</span></span><span style=display:flex><span>    op_tags<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;operation&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>},
</span></span><span style=display:flex><span>    partitions_def<span style=color:#f92672>=</span>dg<span style=color:#f92672>.</span>DailyPartitionsDefinition(<span style=color:#e6db74>&#34;2025-01-01&#34;</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>example_asset</span>(context: dg<span style=color:#f92672>.</span>AssetExecutionContext):
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>log<span style=color:#f92672>.</span>info(context<span style=color:#f92672>.</span>partition_key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>partitioned_asset_job <span style=color:#f92672>=</span> dg<span style=color:#f92672>.</span>define_asset_job(<span style=color:#e6db74>&#34;partitioned_job&#34;</span>, selection<span style=color:#f92672>=</span>[example_asset])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>defs <span style=color:#f92672>=</span> dg<span style=color:#f92672>.</span>Definitions(assets<span style=color:#f92672>=</span>[example_asset], jobs<span style=color:#f92672>=</span>[partitioned_asset_job])
</span></span></code></pre></div><p>It doesn&rsquo;t do a lot, it defines an asset called <code>example_asset</code>, configures it to have partitions that are of the daily variety starting from <code>2025-01-01</code>. It then logs the partition key.
That&rsquo;s it. That&rsquo;s all. Let&rsquo;s make it work now!</p><p>In the dockerfile called <code>Dockerfile_code_location_1</code> let&rsquo;s get setup:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> python:3.10-slim</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip install <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    dagster <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    dagster-postgres <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    dagster-docker<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Add code location code</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /opt/dagster/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> dagsterCode/demo /opt/dagster/app<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Run dagster code server on port 4000</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 4000</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># CMD allows this to be overridden from run launchers or executors to execute runs and steps</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;dagster&#34;</span>, <span style=color:#e6db74>&#34;code-server&#34;</span>, <span style=color:#e6db74>&#34;start&#34;</span>, <span style=color:#e6db74>&#34;-h&#34;</span>, <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>, <span style=color:#e6db74>&#34;-p&#34;</span>, <span style=color:#e6db74>&#34;4000&#34;</span>, <span style=color:#e6db74>&#34;-f&#34;</span>, <span style=color:#e6db74>&#34;definitions.py&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Next let&rsquo;s update our <code>docker_compose</code> to use this dockerfile!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span>services:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e># ... &lt;- Means I&#39;m ommitting stuff for brevity. Just make changes in the services. </span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e># new service</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  docker_example_user_code:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    build:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      context: .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      dockerfile: ./Dockerfile_code_location_1<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    container_name: docker_example_user_code<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    image: docker_example_user_code_image<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    restart: always<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    environment:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_POSTGRES_USER: <span style=color:#e6db74>${</span>POSTGRES_USER<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_POSTGRES_PASSWORD: <span style=color:#e6db74>${</span>POSTGRES_PASS<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_POSTGRES_DB: <span style=color:#e6db74>${</span>POSTGRES_DB<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      DAGSTER_CURRENT_IMAGE: <span style=color:#e6db74>&#39;docker_example_user_code_image&#39;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    expose:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#39;4000&#39;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    ports:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#39;4000:4000&#39;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    networks:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - docker_example_network<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e># ...</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  docker_example_webserver:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#75715e># ...Only update depends_on here </span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    depends_on:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      docker_example_postgresql:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        condition: service_healthy<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      docker_example_user_code:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        condition: service_started<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e># ...</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  docker_example_daemon:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#75715e># ... Only update depends_on here</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    depends_on:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      docker_example_postgresql:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        condition: service_healthy<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      docker_example_user_code:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        condition: service_started<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>We created a new container called docker_example_user_code and informed both the webserver and the daemon that they need this to successfully run before we they are allowed to boot up.</p><p>Now we make changes to our <code>workspace.yaml</code> again - which will instruct Dagster webserver and daemon to connect to the GRPC server hosted at the internal docker hosted location called <code>docker_example_user_code</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>load_from</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>grpc_server</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>host</span>: <span style=color:#ae81ff>docker_example_user_code</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>4000</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>location_name</span>: <span style=color:#ae81ff>demo </span>
</span></span></code></pre></div><p>Now.. <code>docker compose up --build</code> &lt;- Build instructs the system to rebuild the docker containers previously built locally (<code>Dockerfile_dagster</code> and <code>Dockerfile_code_location_1</code> as we&rsquo;ve updated the <code>workspace.yaml</code> file that&rsquo;ll be loaded in)</p><p>Next, I say a small prayer&mldr;</p><p><img alt="Great Success!" loading=lazy src=img/success.png></p><p>That little &lsquo;Loaded&rsquo; means everything worked great!</p><p>Check the <code>daemons</code> link to make sure all your daemons are running:
<img alt=Daemons loading=lazy src=img/daemons.png></p><p>Then Navigate to <code>assets</code> and click <code>example_asset</code> and click <code>materialize</code> and choose how you want to tackle it. You could just do the latest, or select a date range to populate, or instruct it to backfill only failed and missing partitions within selection. Regardless, it&rsquo;s just going to log out dates anyways.</p><p>Once it&rsquo;s done, you can click into it by pressing the little green pill and look at the output - it&rsquo;s going to show you the date you ran it for (I ran it for 2025-04-01)</p><p><img alt="Materialize Logs" loading=lazy src=img/materialize_log.png></p><p>There you have it!
Dagster webserver is up and running! We have a good foundation to work with to start building our orchestration pipelines!</p><p>We&rsquo;re missing one item though, our dockerfile is missing the minio service we created in part 1. For continuity, I&rsquo;m going to add it in the dockerfile and paste the results below. We&rsquo;ll now have Minio AND our Dagster Stack running on our local docker setup.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span>services:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e># ... omitted for brevity</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  minio:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    image: quay.io/minio/minio<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    command: server --console-address <span style=color:#e6db74>&#34;:9001&#34;</span> /data<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    volumes:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - ./data/minio:/data<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    expose:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#34;9000&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#34;9001&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    ports:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#34;9000:9000&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#34;9001:9001&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    environment:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      MINIO_ROOT_USER: <span style=color:#e6db74>${</span>MINIO_USER<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      MINIO_ROOT_PASSWORD: <span style=color:#e6db74>${</span>MINIO_PASS<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    healthcheck:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      test: <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;CMD&#34;</span>, <span style=color:#e6db74>&#34;mc&#34;</span>, <span style=color:#e6db74>&#34;ready&#34;</span>, <span style=color:#e6db74>&#34;local&#34;</span> <span style=color:#f92672>]</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      interval: 5s<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      timeout: 5s<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      retries: <span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    networks:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - docker_example_network<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e># ...</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>That&rsquo;s it!</p><p>In the next blog post I&rsquo;m going to talk about how to create a non-trivial dagster project, extract some data with some partitions, develop locally using <code>dagster dev</code> and finally publish it to my fancy new <code>dagster</code> project!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.jimdhughes.com/tags/data/>Data</a></li><li><a href=https://blog.jimdhughes.com/tags/open-source/>Open-Source</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.jimdhughes.com/>James Hughes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    var config = {
      startOnLoad: true,
      theme: 'dark',
      align: 'center',
    };
    mermaid.initialize(config);
  </script></body></html>