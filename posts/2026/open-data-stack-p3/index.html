<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Designing an Open Data Stack - Part 3: The Bronze Layer | James Hughes</title>
<meta name=keywords content="data,open-source"><meta name=description content="Designing an Open Data Stack - Part 3: The Bronze Layer"><meta name=author content="James D Hughes"><link rel=canonical href=https://blog.jimdhughes.com/posts/2026/open-data-stack-p3/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.jimdhughes.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.jimdhughes.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.jimdhughes.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.jimdhughes.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.jimdhughes.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.jimdhughes.com/posts/2026/open-data-stack-p3/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-0ET0VYDXCL"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0ET0VYDXCL")</script><meta property="og:url" content="https://blog.jimdhughes.com/posts/2026/open-data-stack-p3/"><meta property="og:site_name" content="James Hughes"><meta property="og:title" content="Designing an Open Data Stack - Part 3: The Bronze Layer"><meta property="og:description" content="Designing an Open Data Stack - Part 3: The Bronze Layer"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-17T00:00:00-06:00"><meta property="article:modified_time" content="2026-01-17T00:00:00-06:00"><meta property="article:tag" content="Data"><meta property="article:tag" content="Open-Source"><meta name=twitter:card content="summary"><meta name=twitter:title content="Designing an Open Data Stack - Part 3: The Bronze Layer"><meta name=twitter:description content="Designing an Open Data Stack - Part 3: The Bronze Layer"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Designing an Open Data Stack - Part 3: The Bronze Layer","item":"https://blog.jimdhughes.com/posts/2026/open-data-stack-p3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Designing an Open Data Stack - Part 3: The Bronze Layer","name":"Designing an Open Data Stack - Part 3: The Bronze Layer","description":"Designing an Open Data Stack - Part 3: The Bronze Layer","keywords":["data","open-source"],"articleBody":"An Open Data Stack Part 3 Part 3: The Bronze Layer Previous Parts Part 1 Part 2 In this part of the series, I’m going to focus on setting just the bronze layer of my data infrastructure. I drink from the kool-aid of the medallion architecture so I’ll keep this post in line with that sort of an idea.\nThe Bronze layer is the ‘rawest’ form of our data pipeline. It is typically an exact representation of your production data just dumped into a storage account or some commodity layer for fast, cheap, and efficient storage. This layer is optimized for reading and writing single files and is not really an exciting part of your data stack.\nSo for this phase of the tutorial, we’re going to use the Dagster instance we’ve set up in the previous parts and start stitching some concepts together. We’re going to use Dagster to connect to an API and write data directly to our Minio storage bucket.\nOrganizing our S3 Containers We’re going to need to do a few things to our minio setup to enable connectivity from Dagster. We could do this via the UI but given the recent changes to Minio by it’s maintainers, we can’t even use the AI to set this up anymore. So their paywall actually encourages good design of our open source data stack :)\nFirst, we need to create environment variables for our docker-compose for a MINIO_ACCESS_KEY and MINIO_SECRET_KEY. These can be randomly generated strings.\n... # Minio Setup MINIO_ACCESS_KEY=\"ajsdlkfajslkasjdoifau\" MINIO_SECRET_KEY=\"asdjkhfasdkfhasduihakjh\" MINIO_USER=minio MINIO_PASS=minio123 MINIO_ENDPOINT_URL=\"http://minio:9000\" ... Then we use the Minio MC (minio client) to set up the access keys and create the bronze bucket. Add a new service to your docker-compose like below:\nservices: ... minio-setup: image: minio/mc depends_on: minio: condition: service_healthy entrypoint: \u003e /bin/sh -c \" echo 'Waiting for MinIO to be ready...'; sleep 5; /usr/bin/mc alias set myminio http://minio:9000 ${MINIO_USER} ${MINIO_PASS}; /usr/bin/mc mb myminio/bronze --ignore-existing; /usr/bin/mc admin user add myminio ${MINIO_ACCESS_KEY} ${MINIO_SECRET_KEY}; /usr/bin/mc admin policy attach myminio readwrite --user ${MINIO_ACCESS_KEY}; exit 0; \" networks: - docker_example_network ... Now when you restart your stack with docker compose up --build your going to have a access key and secret key set up in Minio and you’ll see a new bronze bucket if you access the minio UI at localhost:9000\nDagster Code I’m going to create a brand new project called nasaproject because… I’m going to connect to Nasa’s api and play with some of their data. After much deliberation, my interest in NEO (near earth objects) and my interest in surfacing how close we are to obliteration at any given minute has won my curiousity. I think this would be a really cool thing to dashboard so that’s where we’re going to start!\nFirst, if you don’t have an API key from NASA, go get yourself one from here: https://api.nasa.gov. You could also use the DEMO_KEY but you’re going to get throttled very quickly.\nNext, you’re going to want to add that api key to your .env file.\n# NASA Setup NASA_API_KEY=\"DEMO_KEY\" Next you’re going to want to make sure that you have a python environment ready to go.\nuv venv venv source ./.venv/source/activate Now, we code! First we’ll scaffold the project\nmkdir nasaproject cd nasaproject uv init uv add dagster mkdir src touch src/definitions,py We’ll start with a barebones definitions,py\nfrom dagster import Definitions defs = Definitions( assets=[], resources={}, ) Next, we start creating our resources.\nFor this part of the tutorial, we’ll start organizing our code a bit better.\nmkdir defs touch defs/assets.py touch defs/resources.py Assets is where we define our Dagster assets and Resources is where we’re going to define our APIs and services for interacting with our stack. To begin, let’s create an s3 compatible storage broker for Minio!\nimport boto3 from dagster import ConfigurableResource, EnvVar import json from pydantic import Field from typing import Any class MinIOResource(ConfigurableResource): \"\"\"Resource for interacting with MinIO (S3-compatible object storage).\"\"\" endpoint_url: str = Field( description=\"MinIO endpoint URL\" ) access_key: str = Field( description=\"MinIO access key\" ) secret_key: str = Field( description=\"MinIO secret key\" ) region_name: str = Field( default=\"us-east-1\", description=\"AWS region name (required even for MinIO)\" ) def get_client(self): \"\"\"Get an S3 client configured for MinIO.\"\"\" return boto3.client( 's3', endpoint_url=self.endpoint_url, aws_access_key_id=self.access_key, aws_secret_access_key=self.secret_key, region_name=self.region_name, ) def get_resource(self): \"\"\"Get an S3 resource configured for MinIO.\"\"\" return boto3.resource( 's3', endpoint_url=self.endpoint_url, aws_access_key_id=self.access_key, aws_secret_access_key=self.secret_key, region_name=self.region_name, ) def write_json(self, bucket: str, key: str, data: Any) -\u003e None: \"\"\"Write JSON data to MinIO.\"\"\" s3_client = self.get_client() json_data = json.dumps(data, indent=2) s3_client.put_object( Bucket=bucket, Key=key, Body=json_data.encode('utf-8'), ContentType='application/json' ) # Instantiate the resource with environment variables minio_resource = MinIOResource( endpoint_url=EnvVar(\"MINIO_ENDPOINT_URL\"), access_key=EnvVar(\"MINIO_ACCESS_KEY\"), secret_key=EnvVar(\"MINIO_SECRET_KEY\"), ) You’ll notice we have to add another package here in boto3 - which is a library that supports interactions with S3.\nuv add boto3 Then back in your definitions.py you’re going to add the resources to the resources part of your defs object.\nfrom dagster import Definitions from defs.resources import minio_resource defs = Definitions( assets=[], resources={\"minio\": minio_resource}, ) Next we need to wire up our API. We’re going to do this by declaring a generic API handler, then extend it for the NASA API. Ready?\n... class APIClientResource(ConfigurableResource): base_url: str = Field( description=\"Base URL for the API\" ) api_key: Optional[str] = Field( default=None, description=\"API key for authentication (if using API key auth)\" ) username: Optional[str] = Field( default=None, description=\"Username for authentication (if using username/password)\" ) password: Optional[str] = Field( default=None, description=\"Password for authentication\" ) timeout: int = Field( default=30, description=\"Request timeout in seconds\" ) def __init__(self, **data): super().__init__(**data) self._session = None self._token = None self._token_expires_at = None def _get_session(self) -\u003e requests.Session: \"\"\"Get or create a requests session.\"\"\" if self._session is None: self._session = requests.Session() # Set default headers self._session.headers.update({ 'User-Agent': 'Dagster-API-Client/1.0', 'Content-Type': 'application/json' }) return self._session def _authenticate(self) -\u003e str: \"\"\" Perform authentication and return access token. Override this method for specific API authentication flows. \"\"\" if self.api_key: # Simple API key auth return self.api_key if self.username and self.password: # Username/password auth - example for OAuth2 or similar session = self._get_session() response = session.post( f\"{self.base_url}/auth/token\", json={ \"username\": self.username, \"password\": self.password }, timeout=self.timeout ) response.raise_for_status() data = response.json() # Store token and expiration self._token = data.get('access_token') expires_in = data.get('expires_in', 3600) # Default 1 hour self._token_expires_at = datetime.now() + timedelta(seconds=expires_in) return self._token return None def _ensure_authenticated(self): \"\"\"Ensure we have a valid token.\"\"\" if self._token is None or (self._token_expires_at and datetime.now() \u003e= self._token_expires_at): token = self._authenticate() if token: session = self._get_session() if self.api_key: # API key in header session.headers.update({'X-API-Key': token}) else: # Bearer token session.headers.update({'Authorization': f'Bearer {token}'}) def get(self, endpoint: str, params: Optional[Dict[str, Any]] = None) -\u003e Dict[str, Any]: \"\"\" Make a GET request to the API. Args: endpoint: API endpoint (will be appended to base_url) params: Query parameters Returns: JSON response as dictionary \"\"\" self._ensure_authenticated() session = self._get_session() url = f\"{self.base_url.rstrip('/')}/{endpoint.lstrip('/')}\" response = session.get(url, params=params, timeout=self.timeout) response.raise_for_status() return response.json() def post(self, endpoint: str, data: Optional[Dict[str, Any]] = None) -\u003e Dict[str, Any]: \"\"\" Make a POST request to the API. Args: endpoint: API endpoint data: Request body data Returns: JSON response as dictionary \"\"\" self._ensure_authenticated() session = self._get_session() url = f\"{self.base_url.rstrip('/')}/{endpoint.lstrip('/')}\" response = session.post(url, json=data, timeout=self.timeout) response.raise_for_status() return response.json() def close(self): \"\"\"Close the session.\"\"\" if self._session: self._session.close() self._session = None class NASANeoWsAPIResource(APIClientResource): \"\"\" NASA NeoWs (Near Earth Object Web Service) API client. Provides access to near earth asteroid information. Get your API key from: https://api.nasa.gov/ \"\"\" def __init__(self, **data): # Set default base_url for NASA API if 'base_url' not in data: data['base_url'] = \"https://api.nasa.gov/neo/rest/v1\" super().__init__(**data) def get(self, endpoint: str, params: Optional[Dict[str, Any]] = None) -\u003e Dict[str, Any]: \"\"\" Make a GET request to NASA API with api_key in query params. \"\"\" session = self._get_session() # Add api_key to params if params is None: params = {} params['api_key'] = self.api_key or 'DEMO_KEY' url = f\"{self.base_url.rstrip('/')}/{endpoint.lstrip('/')}\" response = session.get(url, params=params, timeout=self.timeout) response.raise_for_status() return response.json() def get_feed(self, start_date: str, end_date: str) -\u003e Dict[str, Any]: params = { 'start_date': start_date, 'end_date': end_date } return self.get('feed', params=params) # Instantiate NASA NeoWs resource nasa_neows_api = NASANeoWsAPIResource( api_key=EnvVar(\"NASA_API_KEY\") # Falls back to DEMO_KEY if not set ) Now we can import the resources in our definitions.py file\nfrom dagster import Definitions from defs.resources import minio_resource, nasa_neows_api defs = Definitions( assets=[], resources={\"minio\": minio_resource, \"nasa_neows_api\": nasa_neows_api}, ) Next, we’ll create our first asset! We’re going to load the NEO’s every day. For brevity, we’re going ot just shove everything into an assets.py file, but there’s something to be said about reorganizing your partition strategies into other files. First, we’re going to create our partitions bucket. Partitions are really about how you expect your data to be organized in it’s raw form. For the NEOs api, it reports NEOs by Date, so it’s reasonable that we assume partitions in a daily manner. If your data changes once per month (or you only need to refresh it once per month), you could make them monthly! It’s really up to you.\nimport dagster as dg from datetime import datetime from defs.resources import NASANeoWsAPIResource, MinIOResource # Define daily partitions starting from Jan 1, 2026 daily_partitions = dg.DailyPartitionsDefinition(start_date=\"2026-01-01\") Onto the asset definition - We’re going to write an aseet that, during it’s execution, calls to the API for the partition’s date (very important so you can re-run old partitions for idempotency) and then write it to our Minio storage account based on our partition strategy (year / month / day)\n... @dg.asset( partitions_def=daily_partitions, group_name=\"bronze\", metadata={ \"source\": \"nasa_neos_api\", \"entity\": \"near_earth_objects\", \"description\": \"Near Earth asteroids approaching Earth for a specific day\" } ) def bronze_nasa_neos( context: dg.AssetExecutionContext, nasa_neows_api: NASANeoWsAPIResource, minio: MinIOResource ) -\u003e dict: \"\"\" Fetch near earth object feed from NASA NeoWs API for a specific partition date. Returns asteroids approaching Earth on the partition date. \"\"\" # Get the partition date partition_date = context.partition_key context.log.info(f\"Fetching NEO feed for {partition_date}...\") # Fetch data for the specific date data = nasa_neows_api.get_feed( start_date=partition_date, end_date=partition_date ) # Extract objects for this date near_earth_objects = data.get('near_earth_objects', {}).get(partition_date, []) # Count potentially hazardous asteroids hazardous_count = sum(1 for obj in near_earth_objects if obj.get('is_potentially_hazardous_asteroid')) context.log.info(f\"Found {len(near_earth_objects)} near earth objects on {partition_date}\") context.log.info(f\"{hazardous_count} are potentially hazardous\") # Prepare result result = { \"partition_date\": partition_date, \"element_count\": len(near_earth_objects), \"potentially_hazardous\": hazardous_count, \"data\": near_earth_objects } # Write to MinIO bronze layer # Parse partition date for timestamp try: context.log.info(\"About to write to MinIO...\") partition_dt = datetime.strptime(partition_date, \"%Y-%m-%d\") context.log.info(f\"Parsed partition date: {partition_dt}\") bucket=\"bronze\" key=f\"nasa_neows_api/{partition_dt.strftime('%Y/%m/%d')}/{partition_dt.strftime('%H%M%S')}.json\" minio.write_json( bucket=bucket, key=key, data=near_earth_objects, ) context.log.info(f\"Wrote data to MinIO: s3://bronze/{key}\") except Exception as e: context.log.error(f\"Failed to write to MinIO: {type(e).__name__}: {str(e)}\") import traceback context.log.error(traceback.format_exc()) return result We’ll update our definitions.py again to include our assets\nfrom dagster import Definitions from defs.assets import bronze_nasa_neos from defs.resources import minio_resource, nasa_neows_api defs = Definitions( assets=[bronze_nasa_neos], resources={\"minio\": minio_resource, \"nasa_neows_api\": nasa_neows_api}, ) Now to make this all show up in our previous Docker setup, we need to make sure to add the grpc_server to the workspace,yaml file identified in our previous part\nload_from: - grpc_server: host: docker_nasa_user_code port: 4000 location_name: nasaproject Now, if the coding gods are with us, running docker compose up --build will rebuild our stack and we’re going to see the new project set up in Dagster! Once it’s done, go to localhostL:3000 and go to deployments, click nasaproject, assets, bronze, and you will see our asset there!\nClick into the asset and press the materialize button in the top right - to test, just run it for the latest partition and press launch 1 run. Click on the little dialog that pops up in the bottom-right to see the results\nSuccess! You can go to your minio instance, select your brozne bucket, and click into nasa_neows_api/2026/01/18 or whatever your partition is that you ran, and you’ll see that we have a json file called 000000.json that is the output of our pipeline!\nWe’ve successfully implemented one asset in Dagster! Now, I wouldn’t recommend any big data analysis off of this one file, so that’s where we’re going to leave it for now. But in the next part, we’re going to start moving the bronze data to silver and eventually to gold so we can build some neat dashboards!\nBonus! You can create schedules and jobs for the partition if you’re interested. I’m going to show you how to do it, though in my particular use case, I won’t be leaving my dev machine on all the time so the schedule is not likely to be exciting, though I do believe it is resilient and will ‘kick off’ the next time your environment spins up, which could be cool!\nIn assets.py, at the bottom, add the following lines to create a schedule, then a job for that schedule that’s aligned with the partition configuration\n... # Define the asset job neos_partitions_job = dg.define_asset_job(\"partitioned_job\", selection=[bronze_nasa_neos]) # This schedule will run daily asset_partitioned_schedule = dg.build_schedule_from_partitioned_job( neos_partitions_job, ) And finally, add it to your definitions.py\nfrom dagster import Definitions from defs.assets import bronze_nasa_neos, asset_partitioned_schedule from defs.resources import minio_resource, nasa_neows_api defs = Definitions( assets=[bronze_nasa_neos], resources={\"minio\": minio_resource, \"nasa_neows_api\": nasa_neows_api}, schedules=[asset_partitioned_schedule], ) Restart your environment with docker compose up --build and navigate to the new navigation items in your side menu! Make sure to turn the schedule on, as it is off by default.\nAnd that’s it! Hopefully I’ll get to Part #4 in less than a year’s time :)\n","wordCount":"2192","inLanguage":"en","datePublished":"2026-01-17T00:00:00-06:00","dateModified":"2026-01-17T00:00:00-06:00","author":{"@type":"Person","name":"James D Hughes"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.jimdhughes.com/posts/2026/open-data-stack-p3/"},"publisher":{"@type":"Organization","name":"James Hughes","logo":{"@type":"ImageObject","url":"https://blog.jimdhughes.com/favicon.ico"}}}</script></head><body id="
  top"><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.jimdhughes.com/ accesskey=h title="James Hughes (Alt + H)">James Hughes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Designing an Open Data Stack - Part 3: The Bronze Layer</h1><div class=post-description>Designing an Open Data Stack - Part 3: The Bronze Layer</div><div class=post-meta><span title='2026-01-17 00:00:00 -0600 -0600'>January 17, 2026</span>&nbsp;·&nbsp;James D Hughes</div></header><div class=post-content><h1 id=an-open-data-stack-part-3>An Open Data Stack Part 3<a hidden class=anchor aria-hidden=true href=#an-open-data-stack-part-3>#</a></h1><h2 id=part-3-the-bronze-layer>Part 3: The Bronze Layer<a hidden class=anchor aria-hidden=true href=#part-3-the-bronze-layer>#</a></h2><h3 id=previous-parts>Previous Parts<a hidden class=anchor aria-hidden=true href=#previous-parts>#</a></h3><ul><li><a href=../../2025/open-data-stack-p1/>Part 1</a></li><li><a href=../../2025/open-data-stack-p2/>Part 2</a></li></ul><p>In this part of the series, I&rsquo;m going to focus on setting just the bronze layer of my data infrastructure. I drink from the kool-aid of the medallion architecture so I&rsquo;ll keep this post in line with that sort of an idea.</p><p>The Bronze layer is the &lsquo;rawest&rsquo; form of our data pipeline. It is typically an exact representation of your production data just dumped into a storage account or some commodity layer for fast, cheap, and efficient storage. This layer is optimized for reading and writing single files and is not really an exciting part of your data stack.</p><p>So for this phase of the tutorial, we&rsquo;re going to use the Dagster instance we&rsquo;ve set up in the previous parts and start stitching some concepts together. We&rsquo;re going to use Dagster to connect to an API and write data directly to our Minio storage bucket.</p><h2 id=organizing-our-s3-containers>Organizing our S3 Containers<a hidden class=anchor aria-hidden=true href=#organizing-our-s3-containers>#</a></h2><p>We&rsquo;re going to need to do a few things to our minio setup to enable connectivity from Dagster. We could do this via the UI but given the recent changes to Minio by it&rsquo;s maintainers, we can&rsquo;t even use the AI to set this up anymore. So their paywall actually encourages good design of our open source data stack :)</p><p>First, we need to create environment variables for our docker-compose for a <code>MINIO_ACCESS_KEY</code> and <code>MINIO_SECRET_KEY</code>. These can be randomly generated strings.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#75715e># Minio Setup</span>
</span></span><span style=display:flex><span>MINIO_ACCESS_KEY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ajsdlkfajslkasjdoifau&#34;</span>
</span></span><span style=display:flex><span>MINIO_SECRET_KEY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;asdjkhfasdkfhasduihakjh&#34;</span>
</span></span><span style=display:flex><span>MINIO_USER<span style=color:#f92672>=</span>minio
</span></span><span style=display:flex><span>MINIO_PASS<span style=color:#f92672>=</span>minio123
</span></span><span style=display:flex><span>MINIO_ENDPOINT_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://minio:9000&#34;</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Then we use the Minio MC (minio client) to set up the access keys and create the bronze bucket. Add a new service to your docker-compose like below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>minio-setup</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>minio/mc</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>minio</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>condition</span>: <span style=color:#ae81ff>service_healthy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>entrypoint</span>: &gt;<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      /bin/sh -c &#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      echo &#39;Waiting for MinIO to be ready...&#39;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      sleep 5;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      /usr/bin/mc alias set myminio http://minio:9000 ${MINIO_USER} ${MINIO_PASS};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      /usr/bin/mc mb myminio/bronze --ignore-existing;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      /usr/bin/mc admin user add myminio ${MINIO_ACCESS_KEY} ${MINIO_SECRET_KEY};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      /usr/bin/mc admin policy attach myminio readwrite --user ${MINIO_ACCESS_KEY};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      exit 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>docker_example_network</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span></code></pre></div><p>Now when you restart your stack with <code>docker compose up --build</code> your going to have a access key and secret key set up in Minio and you&rsquo;ll see a new <code>bronze</code> bucket if you access the minio UI at <code>localhost:9000</code></p><h2 id=dagster-code>Dagster Code<a hidden class=anchor aria-hidden=true href=#dagster-code>#</a></h2><p>I&rsquo;m going to create a brand new project called <code>nasaproject</code> because&mldr; I&rsquo;m going to connect to Nasa&rsquo;s api and play with some of their data. After much deliberation, my interest in NEO (<strong>n</strong>ear <strong>e</strong>arth <strong>o</strong>bjects) and my interest in surfacing how close we are to obliteration at any given minute has won my curiousity. I think this would be a really cool thing to dashboard so that&rsquo;s where we&rsquo;re going to start!</p><p>First, if you don&rsquo;t have an API key from NASA, go get yourself one from here: <a href=https://api.nasa.gov>https://api.nasa.gov</a>. You could also use the <code>DEMO_KEY</code> but you&rsquo;re going to get throttled very quickly.</p><p>Next, you&rsquo;re going to want to add that api key to your <code>.env</code> file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># NASA Setup</span>
</span></span><span style=display:flex><span>NASA_API_KEY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;DEMO_KEY&#34;</span>
</span></span></code></pre></div><p>Next you&rsquo;re going to want to make sure that you have a python environment ready to go.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uv venv venv
</span></span><span style=display:flex><span>source ./.venv/source/activate
</span></span></code></pre></div><p>Now, we code! First we&rsquo;ll scaffold the project</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir nasaproject
</span></span><span style=display:flex><span>cd nasaproject
</span></span><span style=display:flex><span>uv init
</span></span><span style=display:flex><span>uv add dagster
</span></span><span style=display:flex><span>mkdir src
</span></span><span style=display:flex><span>touch src/definitions,py
</span></span></code></pre></div><p>We&rsquo;ll start with a barebones definitions,py</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> dagster <span style=color:#f92672>import</span> Definitions
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>defs <span style=color:#f92672>=</span> Definitions(
</span></span><span style=display:flex><span>    assets<span style=color:#f92672>=</span>[],
</span></span><span style=display:flex><span>    resources<span style=color:#f92672>=</span>{},
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>Next, we start creating our resources.</p><p>For this part of the tutorial, we&rsquo;ll start organizing our code a bit better.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir defs
</span></span><span style=display:flex><span>touch defs/assets.py
</span></span><span style=display:flex><span>touch defs/resources.py
</span></span></code></pre></div><p>Assets is where we define our Dagster assets and Resources is where we&rsquo;re going to define our APIs and services for interacting with our stack. To begin, let&rsquo;s create an s3 compatible storage broker for Minio!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> boto3
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> dagster <span style=color:#f92672>import</span> ConfigurableResource, EnvVar
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pydantic <span style=color:#f92672>import</span> Field
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MinIOResource</span>(ConfigurableResource):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Resource for interacting with MinIO (S3-compatible object storage).&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    endpoint_url: str <span style=color:#f92672>=</span> Field(
</span></span><span style=display:flex><span>        description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MinIO endpoint URL&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    access_key: str <span style=color:#f92672>=</span> Field(
</span></span><span style=display:flex><span>        description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MinIO access key&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    secret_key: str <span style=color:#f92672>=</span> Field(
</span></span><span style=display:flex><span>        description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MinIO secret key&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    region_name: str <span style=color:#f92672>=</span> Field(
</span></span><span style=display:flex><span>        default<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;us-east-1&#34;</span>,
</span></span><span style=display:flex><span>        description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;AWS region name (required even for MinIO)&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_client</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Get an S3 client configured for MinIO.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> boto3<span style=color:#f92672>.</span>client(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;s3&#39;</span>,
</span></span><span style=display:flex><span>            endpoint_url<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>endpoint_url,
</span></span><span style=display:flex><span>            aws_access_key_id<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>access_key,
</span></span><span style=display:flex><span>            aws_secret_access_key<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>secret_key,
</span></span><span style=display:flex><span>            region_name<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>region_name,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_resource</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Get an S3 resource configured for MinIO.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> boto3<span style=color:#f92672>.</span>resource(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;s3&#39;</span>,
</span></span><span style=display:flex><span>            endpoint_url<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>endpoint_url,
</span></span><span style=display:flex><span>            aws_access_key_id<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>access_key,
</span></span><span style=display:flex><span>            aws_secret_access_key<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>secret_key,
</span></span><span style=display:flex><span>            region_name<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>region_name,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write_json</span>(self, bucket: str, key: str, data: Any) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Write JSON data to MinIO.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        s3_client <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>get_client()
</span></span><span style=display:flex><span>        json_data <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>dumps(data, indent<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        s3_client<span style=color:#f92672>.</span>put_object(
</span></span><span style=display:flex><span>            Bucket<span style=color:#f92672>=</span>bucket,
</span></span><span style=display:flex><span>            Key<span style=color:#f92672>=</span>key,
</span></span><span style=display:flex><span>            Body<span style=color:#f92672>=</span>json_data<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;utf-8&#39;</span>),
</span></span><span style=display:flex><span>            ContentType<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;application/json&#39;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Instantiate the resource with environment variables</span>
</span></span><span style=display:flex><span>minio_resource <span style=color:#f92672>=</span> MinIOResource(
</span></span><span style=display:flex><span>    endpoint_url<span style=color:#f92672>=</span>EnvVar(<span style=color:#e6db74>&#34;MINIO_ENDPOINT_URL&#34;</span>),
</span></span><span style=display:flex><span>    access_key<span style=color:#f92672>=</span>EnvVar(<span style=color:#e6db74>&#34;MINIO_ACCESS_KEY&#34;</span>),
</span></span><span style=display:flex><span>    secret_key<span style=color:#f92672>=</span>EnvVar(<span style=color:#e6db74>&#34;MINIO_SECRET_KEY&#34;</span>),
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>You&rsquo;ll notice we have to add another package here in <code>boto3</code> - which is a library that supports interactions with S3.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uv add boto3
</span></span></code></pre></div><p>Then back in your <code>definitions.py</code> you&rsquo;re going to add the resources to the <code>resources</code> part of your <code>defs</code> object.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> dagster <span style=color:#f92672>import</span> Definitions
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> defs.resources <span style=color:#f92672>import</span> minio_resource
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>defs <span style=color:#f92672>=</span> Definitions(
</span></span><span style=display:flex><span>    assets<span style=color:#f92672>=</span>[],
</span></span><span style=display:flex><span>    resources<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;minio&#34;</span>: minio_resource},
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>Next we need to wire up our API. We&rsquo;re going to do this by declaring a generic API handler, then extend it for the NASA API. Ready?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>APIClientResource</span>(ConfigurableResource):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    base_url: str <span style=color:#f92672>=</span> Field(
</span></span><span style=display:flex><span>        description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Base URL for the API&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    api_key: Optional[str] <span style=color:#f92672>=</span> Field(
</span></span><span style=display:flex><span>        default<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>,
</span></span><span style=display:flex><span>        description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;API key for authentication (if using API key auth)&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    username: Optional[str] <span style=color:#f92672>=</span> Field(
</span></span><span style=display:flex><span>        default<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>,
</span></span><span style=display:flex><span>        description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Username for authentication (if using username/password)&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    password: Optional[str] <span style=color:#f92672>=</span> Field(
</span></span><span style=display:flex><span>        default<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>,
</span></span><span style=display:flex><span>        description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Password for authentication&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    timeout: int <span style=color:#f92672>=</span> Field(
</span></span><span style=display:flex><span>        default<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>,
</span></span><span style=display:flex><span>        description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Request timeout in seconds&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>**</span>data):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__(<span style=color:#f92672>**</span>data)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_session <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_token <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_token_expires_at <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_get_session</span>(self) <span style=color:#f92672>-&gt;</span> requests<span style=color:#f92672>.</span>Session:
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Get or create a requests session.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>_session <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_session <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>Session()
</span></span><span style=display:flex><span>            <span style=color:#75715e># Set default headers</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_session<span style=color:#f92672>.</span>headers<span style=color:#f92672>.</span>update({
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;User-Agent&#39;</span>: <span style=color:#e6db74>&#39;Dagster-API-Client/1.0&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;Content-Type&#39;</span>: <span style=color:#e6db74>&#39;application/json&#39;</span>
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_session
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_authenticate</span>(self) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Perform authentication and return access token.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Override this method for specific API authentication flows.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>api_key:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Simple API key auth</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>api_key
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>username <span style=color:#f92672>and</span> self<span style=color:#f92672>.</span>password:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Username/password auth - example for OAuth2 or similar</span>
</span></span><span style=display:flex><span>            session <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_get_session()
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>post(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>base_url<span style=color:#e6db74>}</span><span style=color:#e6db74>/auth/token&#34;</span>,
</span></span><span style=display:flex><span>                json<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;username&#34;</span>: self<span style=color:#f92672>.</span>username,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;password&#34;</span>: self<span style=color:#f92672>.</span>password
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                timeout<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>timeout
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            response<span style=color:#f92672>.</span>raise_for_status()
</span></span><span style=display:flex><span>            data <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Store token and expiration</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_token <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;access_token&#39;</span>)
</span></span><span style=display:flex><span>            expires_in <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;expires_in&#39;</span>, <span style=color:#ae81ff>3600</span>)  <span style=color:#75715e># Default 1 hour</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_token_expires_at <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>now() <span style=color:#f92672>+</span> timedelta(seconds<span style=color:#f92672>=</span>expires_in)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_token
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_ensure_authenticated</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Ensure we have a valid token.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>_token <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>or</span> (self<span style=color:#f92672>.</span>_token_expires_at <span style=color:#f92672>and</span> datetime<span style=color:#f92672>.</span>now() <span style=color:#f92672>&gt;=</span> self<span style=color:#f92672>.</span>_token_expires_at):
</span></span><span style=display:flex><span>            token <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_authenticate()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> token:
</span></span><span style=display:flex><span>                session <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_get_session()
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>api_key:
</span></span><span style=display:flex><span>                    <span style=color:#75715e># API key in header</span>
</span></span><span style=display:flex><span>                    session<span style=color:#f92672>.</span>headers<span style=color:#f92672>.</span>update({<span style=color:#e6db74>&#39;X-API-Key&#39;</span>: token})
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                    <span style=color:#75715e># Bearer token</span>
</span></span><span style=display:flex><span>                    session<span style=color:#f92672>.</span>headers<span style=color:#f92672>.</span>update({<span style=color:#e6db74>&#39;Authorization&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Bearer </span><span style=color:#e6db74>{</span>token<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>})
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get</span>(self, endpoint: str, params: Optional[Dict[str, Any]] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>) <span style=color:#f92672>-&gt;</span> Dict[str, Any]:
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Make a GET request to the API.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            endpoint: API endpoint (will be appended to base_url)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            params: Query parameters
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            JSON response as dictionary
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_ensure_authenticated()
</span></span><span style=display:flex><span>        session <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_get_session()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        url <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>base_url<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>&#39;/&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{</span>endpoint<span style=color:#f92672>.</span>lstrip(<span style=color:#e6db74>&#39;/&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(url, params<span style=color:#f92672>=</span>params, timeout<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>timeout)
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span>raise_for_status()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>post</span>(self, endpoint: str, data: Optional[Dict[str, Any]] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>) <span style=color:#f92672>-&gt;</span> Dict[str, Any]:
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Make a POST request to the API.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            endpoint: API endpoint
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            data: Request body data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            JSON response as dictionary
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_ensure_authenticated()
</span></span><span style=display:flex><span>        session <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_get_session()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        url <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>base_url<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>&#39;/&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{</span>endpoint<span style=color:#f92672>.</span>lstrip(<span style=color:#e6db74>&#39;/&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>post(url, json<span style=color:#f92672>=</span>data, timeout<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>timeout)
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span>raise_for_status()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>close</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Close the session.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>_session:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_session<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_session <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NASANeoWsAPIResource</span>(APIClientResource):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    NASA NeoWs (Near Earth Object Web Service) API client.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Provides access to near earth asteroid information.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Get your API key from: https://api.nasa.gov/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, <span style=color:#f92672>**</span>data):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Set default base_url for NASA API</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;base_url&#39;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> data:
</span></span><span style=display:flex><span>            data[<span style=color:#e6db74>&#39;base_url&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://api.nasa.gov/neo/rest/v1&#34;</span>
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__(<span style=color:#f92672>**</span>data)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get</span>(self, endpoint: str, params: Optional[Dict[str, Any]] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>) <span style=color:#f92672>-&gt;</span> Dict[str, Any]:
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Make a GET request to NASA API with api_key in query params.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        session <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_get_session()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add api_key to params</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> params <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            params <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        params[<span style=color:#e6db74>&#39;api_key&#39;</span>] <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>api_key <span style=color:#f92672>or</span> <span style=color:#e6db74>&#39;DEMO_KEY&#39;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        url <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>base_url<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>&#39;/&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{</span>endpoint<span style=color:#f92672>.</span>lstrip(<span style=color:#e6db74>&#39;/&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(url, params<span style=color:#f92672>=</span>params, timeout<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>timeout)
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span>raise_for_status()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_feed</span>(self, start_date: str, end_date: str) <span style=color:#f92672>-&gt;</span> Dict[str, Any]:
</span></span><span style=display:flex><span>        params <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;start_date&#39;</span>: start_date,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;end_date&#39;</span>: end_date
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;feed&#39;</span>, params<span style=color:#f92672>=</span>params)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Instantiate NASA NeoWs resource</span>
</span></span><span style=display:flex><span>nasa_neows_api <span style=color:#f92672>=</span> NASANeoWsAPIResource(
</span></span><span style=display:flex><span>    api_key<span style=color:#f92672>=</span>EnvVar(<span style=color:#e6db74>&#34;NASA_API_KEY&#34;</span>)  <span style=color:#75715e># Falls back to DEMO_KEY if not set</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>Now we can import the resources in our <code>definitions.py</code> file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> dagster <span style=color:#f92672>import</span> Definitions
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> defs.resources <span style=color:#f92672>import</span> minio_resource, nasa_neows_api
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>defs <span style=color:#f92672>=</span> Definitions(
</span></span><span style=display:flex><span>    assets<span style=color:#f92672>=</span>[],
</span></span><span style=display:flex><span>    resources<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;minio&#34;</span>: minio_resource, <span style=color:#e6db74>&#34;nasa_neows_api&#34;</span>: nasa_neows_api},
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>Next, we&rsquo;ll create our first asset! We&rsquo;re going to load the NEO&rsquo;s every day. For brevity, we&rsquo;re going ot just shove everything into an <code>assets.py</code> file, but there&rsquo;s something to be said about reorganizing your partition strategies into other files. First, we&rsquo;re going to create our partitions bucket. Partitions are really about how you expect your data to be organized in it&rsquo;s raw form. For the NEOs api, it reports NEOs by Date, so it&rsquo;s reasonable that we assume partitions in a daily manner. If your data changes once per month (or you only need to refresh it once per month), you could make them monthly! It&rsquo;s really up to you.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> dagster <span style=color:#66d9ef>as</span> dg
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> defs.resources <span style=color:#f92672>import</span> NASANeoWsAPIResource, MinIOResource
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define daily partitions starting from Jan 1, 2026</span>
</span></span><span style=display:flex><span>daily_partitions <span style=color:#f92672>=</span> dg<span style=color:#f92672>.</span>DailyPartitionsDefinition(start_date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2026-01-01&#34;</span>)
</span></span></code></pre></div><p>Onto the asset definition - We&rsquo;re going to write an aseet that, during it&rsquo;s execution, calls to the API for the partition&rsquo;s date (very important so you can re-run old partitions for idempotency) and then write it to our Minio storage account based on our partition strategy (year / month / day)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@dg.asset</span>(
</span></span><span style=display:flex><span>    partitions_def<span style=color:#f92672>=</span>daily_partitions,
</span></span><span style=display:flex><span>    group_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bronze&#34;</span>,
</span></span><span style=display:flex><span>    metadata<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;nasa_neos_api&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;entity&#34;</span>: <span style=color:#e6db74>&#34;near_earth_objects&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Near Earth asteroids approaching Earth for a specific day&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>bronze_nasa_neos</span>(
</span></span><span style=display:flex><span>    context: dg<span style=color:#f92672>.</span>AssetExecutionContext, 
</span></span><span style=display:flex><span>    nasa_neows_api: NASANeoWsAPIResource,
</span></span><span style=display:flex><span>    minio: MinIOResource
</span></span><span style=display:flex><span>) <span style=color:#f92672>-&gt;</span> dict:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Fetch near earth object feed from NASA NeoWs API for a specific partition date.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns asteroids approaching Earth on the partition date.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Get the partition date</span>
</span></span><span style=display:flex><span>    partition_date <span style=color:#f92672>=</span> context<span style=color:#f92672>.</span>partition_key
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Fetching NEO feed for </span><span style=color:#e6db74>{</span>partition_date<span style=color:#e6db74>}</span><span style=color:#e6db74>...&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Fetch data for the specific date</span>
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> nasa_neows_api<span style=color:#f92672>.</span>get_feed(
</span></span><span style=display:flex><span>        start_date<span style=color:#f92672>=</span>partition_date,
</span></span><span style=display:flex><span>        end_date<span style=color:#f92672>=</span>partition_date
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Extract objects for this date</span>
</span></span><span style=display:flex><span>    near_earth_objects <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;near_earth_objects&#39;</span>, {})<span style=color:#f92672>.</span>get(partition_date, [])
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Count potentially hazardous asteroids</span>
</span></span><span style=display:flex><span>    hazardous_count <span style=color:#f92672>=</span> sum(<span style=color:#ae81ff>1</span> <span style=color:#66d9ef>for</span> obj <span style=color:#f92672>in</span> near_earth_objects <span style=color:#66d9ef>if</span> obj<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;is_potentially_hazardous_asteroid&#39;</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Found </span><span style=color:#e6db74>{</span>len(near_earth_objects)<span style=color:#e6db74>}</span><span style=color:#e6db74> near earth objects on </span><span style=color:#e6db74>{</span>partition_date<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>hazardous_count<span style=color:#e6db74>}</span><span style=color:#e6db74> are potentially hazardous&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Prepare result</span>
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;partition_date&#34;</span>: partition_date,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;element_count&#34;</span>: len(near_earth_objects),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;potentially_hazardous&#34;</span>: hazardous_count,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;data&#34;</span>: near_earth_objects
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Write to MinIO bronze layer</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Parse partition date for timestamp</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        context<span style=color:#f92672>.</span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;About to write to MinIO...&#34;</span>)
</span></span><span style=display:flex><span>        partition_dt <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(partition_date, <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        context<span style=color:#f92672>.</span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Parsed partition date: </span><span style=color:#e6db74>{</span>partition_dt<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        bucket<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bronze&#34;</span>
</span></span><span style=display:flex><span>        key<span style=color:#f92672>=</span><span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;nasa_neows_api/</span><span style=color:#e6db74>{</span>partition_dt<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#39;%Y/%m/</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{</span>partition_dt<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#39;%H%M%S&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>.json&#34;</span>
</span></span><span style=display:flex><span>        minio<span style=color:#f92672>.</span>write_json(
</span></span><span style=display:flex><span>            bucket<span style=color:#f92672>=</span>bucket,
</span></span><span style=display:flex><span>            key<span style=color:#f92672>=</span>key,
</span></span><span style=display:flex><span>            data<span style=color:#f92672>=</span>near_earth_objects,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        context<span style=color:#f92672>.</span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Wrote data to MinIO: s3://bronze/</span><span style=color:#e6db74>{</span>key<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        context<span style=color:#f92672>.</span>log<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Failed to write to MinIO: </span><span style=color:#e6db74>{</span>type(e)<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>str(e)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#f92672>import</span> traceback
</span></span><span style=display:flex><span>        context<span style=color:#f92672>.</span>log<span style=color:#f92672>.</span>error(traceback<span style=color:#f92672>.</span>format_exc())
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> result
</span></span></code></pre></div><p>We&rsquo;ll update our <code>definitions.py</code> again to include our assets</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> dagster <span style=color:#f92672>import</span> Definitions
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> defs.assets <span style=color:#f92672>import</span> bronze_nasa_neos
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> defs.resources <span style=color:#f92672>import</span> minio_resource, nasa_neows_api
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>defs <span style=color:#f92672>=</span> Definitions(
</span></span><span style=display:flex><span>    assets<span style=color:#f92672>=</span>[bronze_nasa_neos],
</span></span><span style=display:flex><span>    resources<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;minio&#34;</span>: minio_resource, <span style=color:#e6db74>&#34;nasa_neows_api&#34;</span>: nasa_neows_api},
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>Now to make this all show up in our previous Docker setup, we need to make sure to add the grpc_server to the <code>workspace,yaml</code> file identified in our previous part</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>load_from</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>grpc_server</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>host</span>: <span style=color:#ae81ff>docker_nasa_user_code</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>4000</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>location_name</span>: <span style=color:#ae81ff>nasaproject</span>
</span></span></code></pre></div><p>Now, if the coding gods are with us, running <code>docker compose up --build</code> will rebuild our stack and we&rsquo;re going to see the new project set up in Dagster! Once it&rsquo;s done, go to <code>localhostL:3000</code> and go to deployments, click <code>nasaproject</code>, <code>assets</code>, <code>bronze</code>, and you will see our asset there!</p><p><img alt="Dagster Deployment Information" loading=lazy src=./img/dagster_deployment.png></p><p>Click into the asset and press the <code>materialize</code> button in the top right - to test, just run it for the <code>latest</code> partition and press <code>launch 1 run</code>. Click on the little dialog that pops up in the bottom-right to see the results</p><p><img alt="Dagster Run Info" loading=lazy src=./img/dagster_run.png></p><p>Success! You can go to your minio instance, select your brozne bucket, and click into <code>nasa_neows_api/2026/01/18</code> or whatever your partition is that you ran, and you&rsquo;ll see that we have a json file called <code>000000.json</code> that is the output of our pipeline!</p><p>We&rsquo;ve successfully implemented one asset in Dagster! Now, I wouldn&rsquo;t recommend any big data analysis off of this one file, so that&rsquo;s where we&rsquo;re going to leave it for now. But in the next part, we&rsquo;re going to start moving the bronze data to silver and eventually to gold so we can build some neat dashboards!</p><h2 id=bonus>Bonus!<a hidden class=anchor aria-hidden=true href=#bonus>#</a></h2><p>You can create schedules and jobs for the partition if you&rsquo;re interested. I&rsquo;m going to show you how to do it, though in my particular use case, I won&rsquo;t be leaving my dev machine on all the time so the schedule is not likely to be exciting, though I do believe it is resilient and will &lsquo;kick off&rsquo; the next time your environment spins up, which could be cool!</p><p>In <code>assets.py</code>, at the bottom, add the following lines to create a schedule, then a job for that schedule that&rsquo;s aligned with the partition configuration</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the asset job</span>
</span></span><span style=display:flex><span>neos_partitions_job <span style=color:#f92672>=</span> dg<span style=color:#f92672>.</span>define_asset_job(<span style=color:#e6db74>&#34;partitioned_job&#34;</span>, selection<span style=color:#f92672>=</span>[bronze_nasa_neos])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># This schedule will run daily</span>
</span></span><span style=display:flex><span>asset_partitioned_schedule <span style=color:#f92672>=</span> dg<span style=color:#f92672>.</span>build_schedule_from_partitioned_job(
</span></span><span style=display:flex><span>    neos_partitions_job,
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>And finally, add it to your <code>definitions.py</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> dagster <span style=color:#f92672>import</span> Definitions
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> defs.assets <span style=color:#f92672>import</span> bronze_nasa_neos, asset_partitioned_schedule
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> defs.resources <span style=color:#f92672>import</span> minio_resource, nasa_neows_api
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>defs <span style=color:#f92672>=</span> Definitions(
</span></span><span style=display:flex><span>    assets<span style=color:#f92672>=</span>[bronze_nasa_neos],
</span></span><span style=display:flex><span>    resources<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;minio&#34;</span>: minio_resource, <span style=color:#e6db74>&#34;nasa_neows_api&#34;</span>: nasa_neows_api},
</span></span><span style=display:flex><span>    schedules<span style=color:#f92672>=</span>[asset_partitioned_schedule],
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>Restart your environment with <code>docker compose up --build</code> and navigate to the new navigation items in your side menu! Make sure to turn the schedule on, as it is off by default.</p><p><img alt="Dagster Schedule for Partition" loading=lazy src=./img/dagster_schedule.png></p><p>And that&rsquo;s it! Hopefully I&rsquo;ll get to Part #4 in less than a year&rsquo;s time :)</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.jimdhughes.com/tags/data/>Data</a></li><li><a href=https://blog.jimdhughes.com/tags/open-source/>Open-Source</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://blog.jimdhughes.com/>James Hughes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>