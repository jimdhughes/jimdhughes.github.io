<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.64.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>IndexedDB + React for Offline Storage&nbsp;&ndash;&nbsp;James Hughes</title><link rel=stylesheet href=/css/core.min.99d761621eb15531f47d6f109c742c4d2f97f9c10fed380e3da27af7676a27a1fb5968bfbd3207717f11d40ad1d68b92.css integrity=sha384-mddhYh6xVTH0fW8QnHQsTS+X+cEP7TgOPaJ692dqJ6H7WWi/vTIHcX8R1ArR1ouS><meta name=twitter:card content="summary"><meta name=twitter:title content="IndexedDB + React for Offline Storage"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">James Hughes</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories/>Categories</a><a class="nav item" href=/tags/>Tags</a><a class="nav item" href></a><a class="nav item" href></a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">IndexedDB + React for Offline Storage</h1><p class="article date">Wednesday, January 9, 2019</p></section><article class="article markdown-body"><p>Offline data is annoying.</p><p>I&rsquo;m used to storing data in localstorage which is okay&mldr; sometimes. When you have a small amount of data to store such as user settings or persisting filters between views then this is a decent enough solution. I was working on a project recently that had a wild requirement appear where we needed to store upwards of 10k items offline. Needless to say, this put performance problems in our application.</p><p>This was primarily because of the time it took to serialize and deserialize (stringify and parse) the payload to be used. We were using some observables to watch our collection and any time there was a change, we persisted the whole collection to localstorage - sounds not bad right? For typical usage (a thousand items or so) it was just fine. When we had upwards of 10k items in our collection - we started experiencing lag. Approximately 1.5-3 seconds worth of lag each time we changed an item in the collection. Needless to say, this was unacceptable.</p><p>We started researching different usages of IndexedDB. The team was pretty comfortable using localstorage and structured our data to use key/value stores in that way. We didn&rsquo;t <em>really</em> understand the true power of IndexedDB as an awesomex data store in the browser.</p><p>So - I&rsquo;m going to walk you through my PoC to show the awesome performance gains we would realize by using IndexedDB in our app to it&rsquo;s fullest. As usual, the code is available on my <a href=https://github.com/jimdhughes/react-indexeddb-demo target=_blank>Github</a></p><p>We&rsquo;ll start it off using create-react-app. (I ejected the app before putting it in my GitHub because reasons) I&rsquo;m not going to show you how to do that. There&rsquo;s loads of getting started tutorials for that.</p><p><code>create-react-app my-app</code></p><p>First thing I&rsquo;m going to do, the meat and potatoes of this post, is to install the <code>idb</code> package which wraps the IndexedDB API with promises - making life so much easier.</p><p><code>npm install --save idb</code></p><p>Then I&rsquo;m going to make a service in <code>src/services/DBService.js</code>. In this, I&rsquo;m going to make sure to set some constants for setting up my database and versioning it, and for demo purposes we&rsquo;re going to set up some predictable placeholder data for the purposes of showcasing the awesome IndexedDB functionality.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>//src/services/DBService.js
</span><span class=c1></span><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>idb</span> <span class=nx>from</span> <span class=s1>&#39;idb&#39;</span><span class=p>;</span>

<span class=kr>const</span> <span class=nx>DATABASE_NAME</span> <span class=o>=</span> <span class=s1>&#39;SERVICE_ORDERS&#39;</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>DATABASE_VERSION</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>idb</span><span class=p>.</span><span class=k>default</span><span class=p>;</span>

<span class=kr>export</span> <span class=kr>const</span> <span class=nx>BUCKETS</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Bucket01&#39;</span><span class=p>,</span> <span class=s1>&#39;Bucket02&#39;</span><span class=p>]</span>
<span class=kr>export</span> <span class=kr>const</span> <span class=nx>BUSINESS_UNITS</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;BU1&#39;</span><span class=p>,</span> <span class=s1>&#39;BU2&#39;</span><span class=p>,</span> <span class=s1>&#39;BU3&#39;</span><span class=p>,</span> <span class=s1>&#39;BU4&#39;</span><span class=p>,</span> <span class=s1>&#39;BU5&#39;</span><span class=p>]</span>
<span class=kr>export</span> <span class=kr>const</span> <span class=nx>STATUS</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;In Progress&#39;</span><span class=p>,</span> <span class=s1>&#39;Completed&#39;</span><span class=p>,</span> <span class=s1>&#39;Pending&#39;</span><span class=p>]</span>
</code></pre></div><p>Next we declare the promise for creating the database. You can read the docs on how to work this <a href=https://developers.google.com/web/ilt/pwa/working-with-indexeddb target=_blank>here</a> and <a href=https://developers.google.com/web/ilt/pwa/lab-indexeddb target=_blank>here</a> [] but I&rsquo;m not going to go into the nuts and bolts of indexed db here.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=p>...</span>

<span class=cm>/**
</span><span class=cm> * Initialize the IndexedDB.
</span><span class=cm> * see https://developers.google.com/web/ilt/pwa/lab-indexeddb
</span><span class=cm> * for information as to why we use switch w/o breaks for migrations.
</span><span class=cm> * add do the database version and add a switch case each time you need to
</span><span class=cm> * change migrations
</span><span class=cm> */</span>
<span class=kr>const</span> <span class=nx>dbPromise</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=nx>DATABASE_NAME</span><span class=p>,</span> <span class=nx>DATABASE_VERSION</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>upgradeDb</span><span class=p>)</span> <span class=p>{</span>
  <span class=cm>/* tslint:disable */</span>
  <span class=k>switch</span> <span class=p>(</span><span class=nx>upgradeDb</span><span class=p>.</span><span class=nx>oldVersion</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>case</span> <span class=mi>0</span><span class=o>:</span>
    <span class=c1>// a placeholder case so that the switch block will
</span><span class=c1></span>    <span class=c1>// execute when the database is first created
</span><span class=c1></span>    <span class=c1>// (oldVersion is 0)
</span><span class=c1></span>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
      <span class=nx>upgradeDb</span><span class=p>.</span><span class=nx>createObjectStore</span><span class=p>(</span><span class=s1>&#39;ServiceOrders&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>keyPath</span><span class=o>:</span> <span class=s1>&#39;id&#39;</span> <span class=p>}</span><span class=p>)</span><span class=p>;</span>
      <span class=kr>const</span> <span class=nx>tx</span> <span class=o>=</span> <span class=nx>upgradeDb</span><span class=p>.</span><span class=nx>transaction</span><span class=p>.</span><span class=nx>objectStore</span><span class=p>(</span><span class=s1>&#39;ServiceOrders&#39;</span><span class=p>,</span> <span class=s1>&#39;readwrite&#39;</span><span class=p>)</span>
      <span class=nx>tx</span><span class=p>.</span><span class=nx>createIndex</span><span class=p>(</span><span class=s1>&#39;Bucket&#39;</span><span class=p>,</span> <span class=s1>&#39;bucket&#39;</span><span class=p>)</span>
      <span class=nx>tx</span><span class=p>.</span><span class=nx>createIndex</span><span class=p>(</span><span class=s1>&#39;businessUnit&#39;</span><span class=p>,</span> <span class=s1>&#39;businessUnit&#39;</span><span class=p>)</span>
      <span class=nx>tx</span><span class=p>.</span><span class=nx>createIndex</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>)</span>
      <span class=nx>tx</span><span class=p>.</span><span class=nx>createIndex</span><span class=p>(</span><span class=s1>&#39;BucketBusinessUnitStatus&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;bucket&#39;</span><span class=p>,</span> <span class=s1>&#39;businessUnit&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>]</span><span class=p>)</span>
      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>100000</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>tx</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=p>{</span>
          <span class=nx>id</span><span class=o>:</span> <span class=nx>i</span><span class=p>,</span>
          <span class=nx>bucket</span><span class=o>:</span> <span class=nx>BUCKETS</span><span class=p>[</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>(</span><span class=p>)</span> <span class=o>*</span> <span class=nx>BUCKETS</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span><span class=p>]</span><span class=p>,</span>
          <span class=nx>businessUnit</span><span class=o>:</span> <span class=nx>BUSINESS_UNITS</span><span class=p>[</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>(</span><span class=p>)</span> <span class=o>*</span> <span class=nx>BUSINESS_UNITS</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span><span class=p>]</span><span class=p>,</span>
          <span class=nx>status</span><span class=o>:</span> <span class=nx>STATUS</span><span class=p>[</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>(</span><span class=p>)</span> <span class=o>*</span> <span class=nx>STATUS</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span><span class=p>]</span>
        <span class=p>}</span><span class=p>)</span><span class=p>;</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span><span class=p>)</span><span class=p>;</span>
</code></pre></div><p>Long story short -this piece of code initializes our database if it doesn&rsquo;t exist (and at it&rsquo;s current version) and we create an object store, throw on some indexes, and then fake in 100k records (I went a bit overboard just to show how slick it is). Finally we can make a class and expose some simple CRUD functions with awful error handling.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>idb</span> <span class=nx>from</span> <span class=s1>&#39;idb&#39;</span><span class=p>;</span>

<span class=kr>const</span> <span class=nx>DATABASE_NAME</span> <span class=o>=</span> <span class=s1>&#39;SERVICE_ORDERS&#39;</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>DATABASE_VERSION</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>idb</span><span class=p>.</span><span class=k>default</span><span class=p>;</span>

<span class=kr>export</span> <span class=kr>const</span> <span class=nx>BUCKETS</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Bucket01&#39;</span><span class=p>,</span> <span class=s1>&#39;Bucket02&#39;</span><span class=p>]</span>
<span class=kr>export</span> <span class=kr>const</span> <span class=nx>BUSINESS_UNITS</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;BU1&#39;</span><span class=p>,</span> <span class=s1>&#39;BU2&#39;</span><span class=p>,</span> <span class=s1>&#39;BU3&#39;</span><span class=p>,</span> <span class=s1>&#39;BU4&#39;</span><span class=p>,</span> <span class=s1>&#39;BU5&#39;</span><span class=p>]</span>
<span class=kr>export</span> <span class=kr>const</span> <span class=nx>STATUS</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;In Progress&#39;</span><span class=p>,</span> <span class=s1>&#39;Completed&#39;</span><span class=p>,</span> <span class=s1>&#39;Pending&#39;</span><span class=p>]</span>
<span class=cm>/**
</span><span class=cm> * Initialize the IndexedDB.
</span><span class=cm> * see https://developers.google.com/web/ilt/pwa/lab-indexeddb
</span><span class=cm> * for information as to why we use switch w/o breaks for migrations.
</span><span class=cm> * add do the database version and add a switch case each time you need to
</span><span class=cm> * change migrations
</span><span class=cm> */</span>
<span class=kr>const</span> <span class=nx>dbPromise</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=nx>DATABASE_NAME</span><span class=p>,</span> <span class=nx>DATABASE_VERSION</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>upgradeDb</span><span class=p>)</span> <span class=p>{</span>
  <span class=cm>/* tslint:disable */</span>
  <span class=k>switch</span> <span class=p>(</span><span class=nx>upgradeDb</span><span class=p>.</span><span class=nx>oldVersion</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>case</span> <span class=mi>0</span><span class=o>:</span>
    <span class=c1>// a placeholder case so that the switch block will
</span><span class=c1></span>    <span class=c1>// execute when the database is first created
</span><span class=c1></span>    <span class=c1>// (oldVersion is 0)
</span><span class=c1></span>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
      <span class=nx>upgradeDb</span><span class=p>.</span><span class=nx>createObjectStore</span><span class=p>(</span><span class=s1>&#39;ServiceOrders&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>keyPath</span><span class=o>:</span> <span class=s1>&#39;id&#39;</span> <span class=p>}</span><span class=p>)</span><span class=p>;</span>
      <span class=kr>const</span> <span class=nx>tx</span> <span class=o>=</span> <span class=nx>upgradeDb</span><span class=p>.</span><span class=nx>transaction</span><span class=p>.</span><span class=nx>objectStore</span><span class=p>(</span><span class=s1>&#39;ServiceOrders&#39;</span><span class=p>,</span> <span class=s1>&#39;readwrite&#39;</span><span class=p>)</span>
      <span class=nx>tx</span><span class=p>.</span><span class=nx>createIndex</span><span class=p>(</span><span class=s1>&#39;Bucket&#39;</span><span class=p>,</span> <span class=s1>&#39;bucket&#39;</span><span class=p>)</span>
      <span class=nx>tx</span><span class=p>.</span><span class=nx>createIndex</span><span class=p>(</span><span class=s1>&#39;businessUnit&#39;</span><span class=p>,</span> <span class=s1>&#39;businessUnit&#39;</span><span class=p>)</span>
      <span class=nx>tx</span><span class=p>.</span><span class=nx>createIndex</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>)</span>
      <span class=nx>tx</span><span class=p>.</span><span class=nx>createIndex</span><span class=p>(</span><span class=s1>&#39;BucketBusinessUnitStatus&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;bucket&#39;</span><span class=p>,</span> <span class=s1>&#39;businessUnit&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>]</span><span class=p>)</span>
      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>100000</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>tx</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=p>{</span>
          <span class=nx>id</span><span class=o>:</span> <span class=nx>i</span><span class=p>,</span>
          <span class=nx>bucket</span><span class=o>:</span> <span class=nx>BUCKETS</span><span class=p>[</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>(</span><span class=p>)</span> <span class=o>*</span> <span class=nx>BUCKETS</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span><span class=p>]</span><span class=p>,</span>
          <span class=nx>businessUnit</span><span class=o>:</span> <span class=nx>BUSINESS_UNITS</span><span class=p>[</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>(</span><span class=p>)</span> <span class=o>*</span> <span class=nx>BUSINESS_UNITS</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span><span class=p>]</span><span class=p>,</span>
          <span class=nx>status</span><span class=o>:</span> <span class=nx>STATUS</span><span class=p>[</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>(</span><span class=p>)</span> <span class=o>*</span> <span class=nx>STATUS</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span><span class=p>]</span>
        <span class=p>}</span><span class=p>)</span><span class=p>;</span>
      <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span><span class=p>)</span><span class=p>;</span>

<span class=kr>class</span> <span class=nx>DBService</span> <span class=p>{</span>

  <span class=nx>get</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>,</span> <span class=nx>key</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>dbPromise</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>db</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>transaction</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>)</span><span class=p>.</span><span class=nx>objectStore</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>)</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>key</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span><span class=p>)</span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// Do something?
</span><span class=c1></span>    <span class=p>}</span><span class=p>)</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=nx>getAll</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>,</span> <span class=nx>indexName</span><span class=p>,</span> <span class=nx>index</span> <span class=o>=</span> <span class=p>[</span><span class=p>]</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>dbPromise</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>db</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>transaction</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>)</span><span class=p>.</span><span class=nx>objectStore</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>)</span><span class=p>.</span><span class=nx>index</span><span class=p>(</span><span class=nx>indexName</span><span class=p>)</span><span class=p>.</span><span class=nx>getAll</span><span class=p>(</span><span class=nx>index</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span><span class=p>)</span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// Do something?
</span><span class=c1></span>    <span class=p>}</span><span class=p>)</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=nx>put</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>,</span> <span class=nx>object</span><span class=p>,</span> <span class=nx>key</span> <span class=o>=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>dbPromise</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>db</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>key</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>transaction</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>,</span> <span class=s1>&#39;readwrite&#39;</span><span class=p>)</span><span class=p>.</span><span class=nx>objectStore</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>)</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>object</span><span class=p>,</span> <span class=nx>key</span><span class=p>)</span><span class=p>;</span>
      <span class=p>}</span>
      <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>transaction</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>,</span> <span class=s1>&#39;readwrite&#39;</span><span class=p>)</span><span class=p>.</span><span class=nx>objectStore</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>)</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>object</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span><span class=p>)</span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// Do something?
</span><span class=c1></span>    <span class=p>}</span><span class=p>)</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=k>delete</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>,</span> <span class=nx>key</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>dbPromise</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>db</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>transaction</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>,</span> <span class=s1>&#39;readwrite&#39;</span><span class=p>)</span><span class=p>.</span><span class=nx>objectStore</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>)</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>key</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span><span class=p>)</span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// Do something?
</span><span class=c1></span>    <span class=p>}</span><span class=p>)</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=nx>deleteAll</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>dbPromise</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>db</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>transaction</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>,</span> <span class=s1>&#39;readwrite&#39;</span><span class=p>)</span><span class=p>.</span><span class=nx>objectStore</span><span class=p>(</span><span class=nx>tablespace</span><span class=p>)</span><span class=p>.</span><span class=nx>clear</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span><span class=p>)</span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// Do something?
</span><span class=c1></span>    <span class=p>}</span><span class=p>)</span><span class=p>;</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=kr>const</span> <span class=nx>Service</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DBService</span><span class=p>(</span><span class=p>)</span>
</code></pre></div><p>Most of this is pretty straight forward. get, getAll, put, delete, deleteAll. There&rsquo;s not much else to say here!</p><p>I suppose we should load up our service and run it then! We&rsquo;ll set up a generic component for browsing and set up <code>react-router-dom</code> since it&rsquo;s super useful and <code>@material-ui</code> because it&rsquo;s pretty.</p><p><code>npm install --save react-router-dom @material-ui/core @material-ui/icons</code></p><p>Replace your <code>src/index.js</code> with the following:</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>//src/index.js
</span><span class=c1></span><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=nx>ReactDOM</span> <span class=nx>from</span> <span class=s1>&#39;react-dom&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>BrowserRouter</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span>
<span class=kr>import</span> <span class=s1>&#39;./index.css&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s1>&#39;./App&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>serviceWorker</span> <span class=nx>from</span> <span class=s1>&#39;./serviceWorker&#39;</span><span class=p>;</span>

<span class=nx>ReactDOM</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span>
  <span class=o>&lt;</span><span class=nx>BrowserRouter</span><span class=o>&gt;</span>
    <span class=o>&lt;</span><span class=nx>App</span> <span class=o>/</span><span class=o>&gt;</span>
  <span class=o>&lt;</span><span class=err>/</span><span class=err>B</span><span class=err>r</span><span class=err>o</span><span class=err>w</span><span class=err>s</span><span class=err>e</span><span class=err>r</span><span class=err>R</span><span class=err>o</span><span class=err>u</span><span class=err>t</span><span class=err>e</span><span class=err>r</span><span class=err>&gt;</span><span class=err>,</span><span class=err> </span><span class=err>d</span><span class=err>o</span><span class=err>c</span><span class=err>u</span><span class=err>m</span><span class=err>e</span><span class=err>n</span><span class=err>t</span><span class=err>.</span><span class=err>g</span><span class=err>e</span><span class=err>t</span><span class=err>E</span><span class=err>l</span><span class=err>e</span><span class=err>m</span><span class=err>e</span><span class=err>n</span><span class=err>t</span><span class=err>B</span><span class=err>y</span><span class=err>I</span><span class=err>d</span><span class=err>(</span><span class=err>&#39;</span><span class=err>r</span><span class=err>o</span><span class=err>o</span><span class=err>t</span><span class=err>&#39;</span><span class=err>)</span><span class=err>)</span><span class=err>;</span>

<span class=c1>// If you want your app to work offline and load faster, you can change
</span><span class=c1></span><span class=c1>// unregister() to register() below. Note this comes with some pitfalls.
</span><span class=c1></span><span class=c1>// Learn more about service workers: http://bit.ly/CRA-PWA
</span><span class=c1></span><span class=nx>serviceWorker</span><span class=p>.</span><span class=nx>unregister</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
</code></pre></div><p>Then create a new component for displaying our data in a <code>ServiceOrderList</code> component</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>// src/components/service-orders/service-order-list.js
</span><span class=c1></span><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>Service</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;../../services/DBService&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>Link</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>CircularProgress</span><span class=p>,</span> <span class=nx>Table</span><span class=p>,</span> <span class=nx>TableHead</span><span class=p>,</span> <span class=nx>TableCell</span><span class=p>,</span> <span class=nx>TableRow</span><span class=p>,</span> <span class=nx>TableBody</span><span class=p>,</span> <span class=nx>AppBar</span><span class=p>,</span> <span class=nx>Toolbar</span><span class=p>,</span> <span class=nx>Typography</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@material-ui/core&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=s1>&#39;./service-orders-list.css&#39;</span><span class=p>;</span>

<span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>ServiceOrdersListComponent</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
  <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
    <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=p>{</span>
      <span class=nx>bucket</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>match</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>bucket</span><span class=p>,</span>
      <span class=nx>businessUnit</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>match</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>businessUnit</span><span class=p>,</span>
      <span class=nx>status</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>match</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span>
      <span class=nx>isLoading</span><span class=o>:</span> <span class=kc>true</span>
    <span class=p>}</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>_getOrders</span><span class=p>(</span><span class=p>)</span>
  <span class=p>}</span>

  <span class=nx>_getOrders</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>bucket</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>businessUnit</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>status</span><span class=p>]</span>
    <span class=nx>Service</span><span class=p>.</span><span class=nx>getAll</span><span class=p>(</span><span class=s1>&#39;ServiceOrders&#39;</span><span class=p>,</span> <span class=s1>&#39;BucketBusinessUnitStatus&#39;</span><span class=p>,</span> <span class=nx>idx</span><span class=p>)</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>orders</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>(</span><span class=p>{</span> <span class=nx>orders</span><span class=o>:</span> <span class=nx>orders</span><span class=p>,</span> <span class=nx>isLoading</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}</span><span class=p>)</span>
    <span class=p>}</span><span class=p>)</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=nx>render</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>let</span> <span class=p>{</span> <span class=nx>bucket</span><span class=p>,</span> <span class=nx>businessUnit</span><span class=p>,</span> <span class=nx>status</span><span class=p>,</span> <span class=nx>isLoading</span> <span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span>
    <span class=kd>let</span> <span class=p>{</span> <span class=nx>orders</span> <span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span>
    <span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
      <span class=o>&lt;</span><span class=nx>AppBar</span> <span class=nx>position</span><span class=o>=</span><span class=s2>&#34;static&#34;</span><span class=o>&gt;</span>
        <span class=o>&lt;</span><span class=nx>Toolbar</span><span class=o>&gt;</span>
          <span class=o>&lt;</span><span class=nx>Typography</span> <span class=nx>variant</span><span class=o>=</span><span class=s2>&#34;h6&#34;</span><span class=o>&gt;</span>
            <span class=p>{</span><span class=nx>bucket</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>businessUnit</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>status</span><span class=p>}</span>
          <span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>y</span><span class=err>p</span><span class=err>o</span><span class=err>g</span><span class=err>r</span><span class=err>a</span><span class=err>p</span><span class=err>h</span><span class=err>y</span><span class=err>&gt;</span>
        <span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>o</span><span class=err>o</span><span class=err>l</span><span class=err>b</span><span class=err>a</span><span class=err>r</span><span class=err>&gt;</span>
      <span class=o>&lt;</span><span class=err>/</span><span class=err>A</span><span class=err>p</span><span class=err>p</span><span class=err>B</span><span class=err>a</span><span class=err>r</span><span class=err>&gt;</span>

      <span class=p>{</span><span class=nx>orders</span> <span class=o>&amp;&amp;</span> <span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=nx>Viewing</span> <span class=p>{</span><span class=nx>orders</span><span class=p>.</span><span class=nx>length</span><span class=p>}</span> <span class=nx>orders</span><span class=o>&lt;</span><span class=err>/</span><span class=err>p</span><span class=err>&gt;</span><span class=err>}</span>
      <span class=p>{</span><span class=nx>isLoading</span> <span class=o>&amp;&amp;</span> <span class=o>&lt;</span><span class=nx>CircularProgress</span> <span class=o>/</span><span class=o>&gt;</span><span class=p>}</span>
      <span class=p>{</span>
        <span class=o>!</span><span class=nx>isLoading</span> <span class=o>&amp;&amp;</span> <span class=o>&lt;</span><span class=nx>Table</span><span class=o>&gt;</span>
          <span class=o>&lt;</span><span class=nx>TableHead</span><span class=o>&gt;</span>
            <span class=o>&lt;</span><span class=nx>TableRow</span><span class=o>&gt;</span>
              <span class=o>&lt;</span><span class=nx>TableCell</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;sticky-header&#34;</span><span class=o>&gt;</span><span class=nx>ID</span><span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>C</span><span class=err>e</span><span class=err>l</span><span class=err>l</span><span class=err>&gt;</span>
              <span class=o>&lt;</span><span class=nx>TableCell</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;sticky-header&#34;</span><span class=o>&gt;</span><span class=nx>Bucket</span><span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>C</span><span class=err>e</span><span class=err>l</span><span class=err>l</span><span class=err>&gt;</span>
              <span class=o>&lt;</span><span class=nx>TableCell</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;sticky-header&#34;</span><span class=o>&gt;</span><span class=nx>Business</span> <span class=nx>Unit</span><span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>C</span><span class=err>e</span><span class=err>l</span><span class=err>l</span><span class=err>&gt;</span>
              <span class=o>&lt;</span><span class=nx>TableCell</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;sticky-header&#34;</span><span class=o>&gt;</span><span class=nx>Status</span><span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>C</span><span class=err>e</span><span class=err>l</span><span class=err>l</span><span class=err>&gt;</span>
            <span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>R</span><span class=err>o</span><span class=err>w</span><span class=err>&gt;</span>
          <span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>H</span><span class=err>e</span><span class=err>a</span><span class=err>d</span><span class=err>&gt;</span>
          <span class=o>&lt;</span><span class=nx>TableBody</span> <span class=nx>style</span><span class=o>=</span><span class=p>{</span><span class=p>{</span> <span class=nx>overflowY</span><span class=o>:</span> <span class=s1>&#39;scroll&#39;</span> <span class=p>}</span><span class=p>}</span><span class=o>&gt;</span>
            <span class=p>{</span><span class=nx>orders</span> <span class=o>&amp;&amp;</span> <span class=nx>orders</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>o</span> <span class=p>=&gt;</span> <span class=o>&lt;</span><span class=nx>TableRow</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>o</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
              <span class=o>&lt;</span><span class=nx>TableCell</span><span class=o>&gt;</span>
                <span class=o>&lt;</span><span class=nx>Link</span> <span class=nx>to</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;/serviceOrders/&#39;</span> <span class=o>+</span> <span class=nx>o</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>o</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/</span><span class=err>L</span><span class=err>i</span><span class=err>n</span><span class=err>k</span><span class=err>&gt;</span><span class=err>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>C</span><span class=err>e</span><span class=err>l</span><span class=err>l</span><span class=err>&gt;</span>
              <span class=o>&lt;</span><span class=nx>TableCell</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>o</span><span class=p>.</span><span class=nx>bucket</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>C</span><span class=err>e</span><span class=err>l</span><span class=err>l</span><span class=err>&gt;</span>
              <span class=o>&lt;</span><span class=nx>TableCell</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>o</span><span class=p>.</span><span class=nx>businessUnit</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>C</span><span class=err>e</span><span class=err>l</span><span class=err>l</span><span class=err>&gt;</span>
              <span class=o>&lt;</span><span class=nx>TableCell</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>o</span><span class=p>.</span><span class=nx>status</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>C</span><span class=err>e</span><span class=err>l</span><span class=err>l</span><span class=err>&gt;</span>
            <span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>R</span><span class=err>o</span><span class=err>w</span><span class=err>&gt;</span><span class=err>)</span><span class=err>}</span>
          <span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>B</span><span class=err>o</span><span class=err>d</span><span class=err>y</span><span class=err>&gt;</span>
        <span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>a</span><span class=err>b</span><span class=err>l</span><span class=err>e</span><span class=err>&gt;</span>
      <span class=p>}</span>
    <span class=o>&lt;</span><span class=err>/</span><span class=err>d</span><span class=err>i</span><span class=err>v</span><span class=err> </span><span class=err>&gt;</span><span class=err>;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>I had a .css file in there too:</p><div class=highlight><pre class=chroma><code class=language-css data-lang=css><span class=o>/</span><span class=o>/</span> <span class=nt>src</span><span class=o>/</span><span class=nt>components</span><span class=o>/</span><span class=nt>service-orders</span><span class=o>/</span><span class=nt>service-orders-list</span><span class=p>.</span><span class=nc>css</span>
<span class=p>.</span><span class=nc>sticky-header</span><span class=p>{</span>
  <span class=k>position</span><span class=p>:</span><span class=kc>sticky</span><span class=p>;</span>
  <span class=k>position</span><span class=p>:</span><span class=kp>-webkit-</span><span class=kc>sticky</span><span class=p>;</span>
  <span class=k>background-color</span><span class=p>:</span><span class=mh>#fff</span><span class=p>;</span>
  <span class=k>top</span><span class=p>:</span><span class=mi>0</span><span class=p>;</span>
  <span class=k>text-align</span><span class=p>:</span><span class=kc>left</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>A <code>HomeComponent</code> to help us navigate:</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>//src/components/home/home-component.js
</span><span class=c1></span><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>Link</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>BUCKETS</span><span class=p>,</span> <span class=nx>BUSINESS_UNITS</span><span class=p>,</span> <span class=nx>STATUS</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;../../services/DBService&#39;</span><span class=p>;</span>

<span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>HomeComponent</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
  <span class=nx>render</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>let</span> <span class=nx>refs</span> <span class=o>=</span> <span class=p>[</span><span class=p>]</span>
    <span class=nx>BUCKETS</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>bu</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=nx>BUSINESS_UNITS</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>b</span> <span class=p>=&gt;</span> <span class=p>{</span>
        <span class=nx>STATUS</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>s</span> <span class=p>=&gt;</span> <span class=p>{</span>
          <span class=kd>let</span> <span class=nx>path</span> <span class=o>=</span> <span class=s2>&#34;/serviceOrders/bucket/&#34;</span> <span class=o>+</span> <span class=nx>bu</span> <span class=o>+</span> <span class=s2>&#34;/businessUnit/&#34;</span> <span class=o>+</span> <span class=nx>b</span> <span class=o>+</span> <span class=s2>&#34;/status/&#34;</span> <span class=o>+</span> <span class=nx>s</span>
          <span class=nx>refs</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=o>&lt;</span><span class=nx>Link</span> <span class=nx>to</span><span class=o>=</span><span class=p>{</span><span class=nx>path</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>path</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/</span><span class=err>L</span><span class=err>i</span><span class=err>n</span><span class=err>k</span><span class=err>&gt;</span><span class=err>)</span>
        <span class=p>}</span><span class=p>)</span>
      <span class=p>}</span><span class=p>)</span>
    <span class=p>}</span><span class=p>)</span>
    <span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
      <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>Some</span> <span class=nx>Routes</span><span class=o>&lt;</span><span class=err>/</span><span class=err>h</span><span class=err>3</span><span class=err>&gt;</span>
      <span class=p>{</span><span class=nx>refs</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=o>&lt;</span><span class=nx>li</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>r</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/</span><span class=err>l</span><span class=err>i</span><span class=err>&gt;</span><span class=err>)</span><span class=err>}</span>
    <span class=o>&lt;</span><span class=err>/</span><span class=err>d</span><span class=err>i</span><span class=err>v</span><span class=err>&gt;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>A <code>ServiceOrderDetail</code> component for more fun:</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>//src/components/service-orders/service-order-detail.js
</span><span class=c1></span><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>Service</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;../../services/DBService&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>AppBar</span><span class=p>,</span> <span class=nx>Toolbar</span><span class=p>,</span> <span class=nx>Typography</span><span class=p>,</span> <span class=nx>IconButton</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@material-ui/core&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=nx>KeyboardArrowLeftIcon</span> <span class=nx>from</span> <span class=s1>&#39;@material-ui/icons/KeyboardArrowLeft&#39;</span><span class=p>;</span>

<span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>ServiceOrderDetailComponent</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
  <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
    <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nb>parseInt</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>match</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>)</span> <span class=p>}</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>_getOrder</span><span class=p>(</span><span class=p>)</span>
  <span class=p>}</span>

  <span class=nx>_getOrder</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>Service</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;ServiceOrders&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>id</span><span class=p>)</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>o</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>(</span><span class=p>{</span> <span class=nx>order</span><span class=o>:</span> <span class=nx>o</span> <span class=p>}</span><span class=p>)</span>
    <span class=p>}</span><span class=p>)</span>
  <span class=p>}</span>

  <span class=nx>_goBack</span> <span class=o>=</span> <span class=p>(</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>history</span><span class=p>.</span><span class=nx>goBack</span><span class=p>(</span><span class=p>)</span>
  <span class=p>}</span>

  <span class=nx>render</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=p>{</span> <span class=nx>order</span> <span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>;</span>
    <span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
      <span class=o>&lt;</span><span class=nx>AppBar</span> <span class=nx>position</span><span class=o>=</span><span class=s2>&#34;static&#34;</span><span class=o>&gt;</span>
        <span class=o>&lt;</span><span class=nx>Toolbar</span><span class=o>&gt;</span>
          <span class=o>&lt;</span><span class=nx>IconButton</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>_goBack</span><span class=p>}</span><span class=o>&gt;</span>
            <span class=o>&lt;</span><span class=nx>KeyboardArrowLeftIcon</span> <span class=o>/</span><span class=o>&gt;</span>
          <span class=o>&lt;</span><span class=err>/</span><span class=err>I</span><span class=err>c</span><span class=err>o</span><span class=err>n</span><span class=err>B</span><span class=err>u</span><span class=err>t</span><span class=err>t</span><span class=err>o</span><span class=err>n</span><span class=err>&gt;</span>
          <span class=o>&lt;</span><span class=nx>Typography</span> <span class=nx>variant</span><span class=o>=</span><span class=s2>&#34;h6&#34;</span><span class=o>&gt;</span>
            <span class=nx>Order</span> <span class=nx>Details</span>
          <span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>y</span><span class=err>p</span><span class=err>o</span><span class=err>g</span><span class=err>r</span><span class=err>a</span><span class=err>p</span><span class=err>h</span><span class=err>y</span><span class=err>&gt;</span>
        <span class=o>&lt;</span><span class=err>/</span><span class=err>T</span><span class=err>o</span><span class=err>o</span><span class=err>l</span><span class=err>b</span><span class=err>a</span><span class=err>r</span><span class=err>&gt;</span>
      <span class=o>&lt;</span><span class=err>/</span><span class=err>A</span><span class=err>p</span><span class=err>p</span><span class=err>B</span><span class=err>a</span><span class=err>r</span><span class=err>&gt;</span>
      <span class=o>&lt;</span><span class=nx>pre</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>order</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/</span><span class=err>p</span><span class=err>r</span><span class=err>e</span><span class=err>&gt;</span>
    <span class=o>&lt;</span><span class=err>/</span><span class=err>d</span><span class=err>i</span><span class=err>v</span><span class=err>&gt;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>A <code>NotFound</code> component for handling routing <code>NotFound</code> issues</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>//src/components/errors/not-found.js
</span><span class=c1></span><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>

<span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>NotFoundComponent</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
    <span class=nx>render</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Not</span> <span class=nx>Found</span><span class=o>!</span><span class=o>&lt;</span><span class=err>/</span><span class=err>h</span><span class=err>1</span><span class=err>&gt;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>Finally in src/App.js</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>Component</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=s1>&#39;./App.css&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>Route</span><span class=p>,</span> <span class=nx>Switch</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-router-dom&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=nx>ServiceOrdersListComponent</span> <span class=nx>from</span> <span class=s1>&#39;./components/service-orders/service-orders-list&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=nx>HomeComponent</span> <span class=nx>from</span> <span class=s1>&#39;./components/home/home-component&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=nx>ServiceOrderDetailComponent</span> <span class=nx>from</span> <span class=s1>&#39;./components/service-orders/service-order-detail&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=nx>NotFoundComponent</span> <span class=nx>from</span> <span class=s1>&#39;./components/errors/not-found&#39;</span><span class=p>;</span>
<span class=kr>class</span> <span class=nx>App</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
  <span class=nx>render</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=p>(</span>
      <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
        <span class=o>&lt;</span><span class=nx>Switch</span><span class=o>&gt;</span>
          <span class=o>&lt;</span><span class=nx>Route</span> <span class=nx>exact</span> <span class=nx>path</span><span class=o>=</span><span class=s2>&#34;/&#34;</span> <span class=nx>component</span><span class=o>=</span><span class=p>{</span><span class=nx>HomeComponent</span><span class=p>}</span> <span class=o>/</span><span class=o>&gt;</span>
          <span class=o>&lt;</span><span class=nx>Route</span> <span class=nx>path</span><span class=o>=</span><span class=s2>&#34;/serviceOrders/bucket/:bucket/businessUnit/:businessUnit/status/:status&#34;</span> <span class=nx>component</span><span class=o>=</span><span class=p>{</span><span class=nx>ServiceOrdersListComponent</span><span class=p>}</span> <span class=o>/</span><span class=o>&gt;</span>
          <span class=o>&lt;</span><span class=nx>Route</span> <span class=nx>exact</span> <span class=nx>path</span><span class=o>=</span><span class=s2>&#34;/serviceOrders/:id&#34;</span> <span class=nx>component</span><span class=o>=</span><span class=p>{</span><span class=nx>ServiceOrderDetailComponent</span><span class=p>}</span> <span class=o>/</span><span class=o>&gt;</span>
          <span class=o>&lt;</span><span class=nx>Route</span> <span class=nx>component</span><span class=o>=</span><span class=p>{</span><span class=nx>NotFoundComponent</span><span class=p>}</span> <span class=o>/</span><span class=o>&gt;</span>
        <span class=o>&lt;</span><span class=err>/</span><span class=err>S</span><span class=err>w</span><span class=err>i</span><span class=err>t</span><span class=err>c</span><span class=err>h</span><span class=err>&gt;</span>
      <span class=o>&lt;</span><span class=err>/</span><span class=err>d</span><span class=err>i</span><span class=err>v</span><span class=err> </span><span class=err>&gt;</span>

    <span class=p>)</span><span class=p>;</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>App</span><span class=p>;</span>
</code></pre></div><p>Go ahead and start up the app now. The first load of your route will take a little bit as the database gets seeded, but you will see how quickly it loads (and renders) 3k records (on average per bucket)</p><p>The list is neat, but if you look in your devtools under application and IndexedDB you can see our table of data and all the different indexes we created to help us in our application!</p><span class=image-container><span class=link><a href=/content/images/2019/01/Screen-Shot-2019-01-08-at-10.19.49-PM.png target=_blank><img class=img src=/content/images/2019/01/Screen-Shot-2019-01-08-at-10.19.49-PM.png alt="IndexedDB Table with Indexes"></a></span><span class=caption><p>IndexedDB Table with Indexes</p></span></span><p>By default our keyPath (and thusly main table) is indexed by id. We built some single key indexes and one compound key index which makes our data access a breeze! We can use this compound index to filter our data down by each of our keys, but in that specific order. For instance, we search for a specific Bucket first:</p><span class=image-container><span class=link><a href=/content/images/2019/01/Screen-Shot-2019-01-08-at-10.22.17-PM.png target=_blank><img class=img src=/content/images/2019/01/Screen-Shot-2019-01-08-at-10.22.17-PM.png alt="Browse by Bucket02 first"></a></span><span class=caption><p>Browse by Bucket02 first</p></span></span><p>Then we browse by a specific business unit as well:</p><span class=image-container><span class=link><a href=/content/images/2019/01/Screen-Shot-2019-01-08-at-10.22.36-PM.png target=_blank><img class=img src=/content/images/2019/01/Screen-Shot-2019-01-08-at-10.22.36-PM.png alt="Browsing byBucket and Business Unit"></a></span><span class=caption><p>Browsing byBucket and Business Unit</p></span></span><p>Pretty neat, hey? Having this functionality provides us with some significant gains over a naive key-value store. These include:</p><ol><li>We are now able to reduce our API&rsquo;s need to understand how our data will be organized on the client. We can just toss down all the orders and then query it like a regular old database client side.</li><li>Our client code is simplified as we won&rsquo;t need to do any map-reducing on big collections - the browser&rsquo;s API handles it for us.</li><li>When we want to update a record, we can serialize and deserialize a single record instead of the entire collection. Atomic updates are good updates.</li></ol><p>This refactor is still being considered for the project as it&rsquo;s a fair bit of work to introduce a sweeping change such as this. However hopefully you read this before you got started on your projects and you have a new idea to try out before making a decision for your offline storage :)</p><p>Some other optimizations that would be good to do include paginating the data so that you&rsquo;re not rendering all 3k items on every load. I figure that&rsquo;s outside the scope of this indexed db discussion though.</p><p>Enjoi :)</p></article><section class="article labels"><a class=category href=/categories/reactjs/>ReactJS</a><a class=category href=/categories/database/>Database</a><a class=category href=/categories/offline-storage/>Offline Storage</a><a class=category href=/categories/indexeddb/>IndexedDB</a><a class=category href=/categories/idb/>idb</a><a class=category href=/categories/javascript/>JavaScript</a><a class=tag href=/tags/reactjs/>ReactJS</a><a class=tag href=/tags/database/>Database</a><a class=tag href=/tags/offline-storage/>Offline Storage</a><a class=tag href=/tags/indexeddb/>IndexedDB</a><a class=tag href=/tags/idb/>idb</a><a class=tag href=/tags/javascript/>JavaScript</a></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/2019/benchmarking-a-pi-calculation-for-fun/><span class="iconfont icon-article"></span>Benchmarking a pi calculation for fun</a></p><p><a class=link href=/posts/2018/brainteasers-theyre-important/><span class="iconfont icon-article"></span>Brainteasers - they're important!</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>2020 James Hughes.</p><p class=powerby><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-61647183-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>