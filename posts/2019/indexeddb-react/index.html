<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>IndexedDB + React for Offline Storage | James Hughes</title>
<meta name=keywords content="frontend,indexdb,react"><meta name=description content="Building an app with React, IndexedDB, and a ridiculous amount of seed data"><meta name=author content="James D Hughes"><link rel=canonical href=https://blog.jimdhughes.com/posts/2019/indexeddb-react/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.jimdhughes.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.jimdhughes.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.jimdhughes.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.jimdhughes.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.jimdhughes.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.jimdhughes.com/posts/2019/indexeddb-react/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-0ET0VYDXCL"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0ET0VYDXCL")</script><meta property="og:url" content="https://blog.jimdhughes.com/posts/2019/indexeddb-react/"><meta property="og:site_name" content="James Hughes"><meta property="og:title" content="IndexedDB + React for Offline Storage"><meta property="og:description" content="Building an app with React, IndexedDB, and a ridiculous amount of seed data"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-01-09T13:07:23+00:00"><meta property="article:modified_time" content="2019-01-09T13:07:23+00:00"><meta property="article:tag" content="Frontend"><meta property="article:tag" content="Indexdb"><meta property="article:tag" content="React"><meta name=twitter:card content="summary"><meta name=twitter:title content="IndexedDB + React for Offline Storage"><meta name=twitter:description content="Building an app with React, IndexedDB, and a ridiculous amount of seed data"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"IndexedDB + React for Offline Storage","item":"https://blog.jimdhughes.com/posts/2019/indexeddb-react/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"IndexedDB + React for Offline Storage","name":"IndexedDB \u002b React for Offline Storage","description":"Building an app with React, IndexedDB, and a ridiculous amount of seed data","keywords":["frontend","indexdb","react"],"articleBody":"Offline data is annoying.\nI’m used to storing data in localstorage which is okay… sometimes. When you have a small amount of data to store such as user settings or persisting filters between views then this is a decent enough solution. I was working on a project recently that had a wild requirement appear where we needed to store upwards of 10k items offline. Needless to say, this put performance problems in our application.\nThis was primarily because of the time it took to serialize and deserialize (stringify and parse) the payload to be used. We were using some observables to watch our collection and any time there was a change, we persisted the whole collection to localstorage - sounds not bad right? For typical usage (a thousand items or so) it was just fine. When we had upwards of 10k items in our collection - we started experiencing lag. Approximately 1.5-3 seconds worth of lag each time we changed an item in the collection. Needless to say, this was unacceptable.\nWe started researching different usages of IndexedDB. The team was pretty comfortable using localstorage and structured our data to use key/value stores in that way. We didn’t really understand the true power of IndexedDB as an awesomex data store in the browser.\nSo - I’m going to walk you through my PoC to show the awesome performance gains we would realize by using IndexedDB in our app to it’s fullest. As usual, the code is available on my Github\nWe’ll start it off using create-react-app. (I ejected the app before putting it in my GitHub because reasons) I’m not going to show you how to do that. There’s loads of getting started tutorials for that.\ncreate-react-app my-app\nFirst thing I’m going to do, the meat and potatoes of this post, is to install the idb package which wraps the IndexedDB API with promises - making life so much easier.\nnpm install --save idb\nThen I’m going to make a service in src/services/DBService.js. In this, I’m going to make sure to set some constants for setting up my database and versioning it, and for demo purposes we’re going to set up some predictable placeholder data for the purposes of showcasing the awesome IndexedDB functionality.\n//src/services/DBService.js import * as idb from 'idb'; const DATABASE_NAME = 'SERVICE_ORDERS'; const DATABASE_VERSION = 2; const db = idb.default; export const BUCKETS = ['Bucket01', 'Bucket02'] export const BUSINESS_UNITS = ['BU1', 'BU2', 'BU3', 'BU4', 'BU5'] export const STATUS = ['In Progress', 'Completed', 'Pending'] Next we declare the promise for creating the database. You can read the docs on how to work this here and here [] but I’m not going to go into the nuts and bolts of indexed db here.\n... /** * Initialize the IndexedDB. * see https://developers.google.com/web/ilt/pwa/lab-indexeddb * for information as to why we use switch w/o breaks for migrations. * add do the database version and add a switch case each time you need to * change migrations */ const dbPromise = db.open(DATABASE_NAME, DATABASE_VERSION, function (upgradeDb) { /* tslint:disable */ switch (upgradeDb.oldVersion) { case 0: // a placeholder case so that the switch block will // execute when the database is first created // (oldVersion is 0) case 1: upgradeDb.createObjectStore('ServiceOrders', { keyPath: 'id' }); const tx = upgradeDb.transaction.objectStore('ServiceOrders', 'readwrite') tx.createIndex('Bucket', 'bucket') tx.createIndex('businessUnit', 'businessUnit') tx.createIndex('status', 'status') tx.createIndex('BucketBusinessUnitStatus', ['bucket', 'businessUnit', 'status']) for (let i = 0; i \u003c 100000; i++) { tx.put({ id: i, bucket: BUCKETS[Math.floor(Math.random() * BUCKETS.length)], businessUnit: BUSINESS_UNITS[Math.floor(Math.random() * BUSINESS_UNITS.length)], status: STATUS[Math.floor(Math.random() * STATUS.length)] }); } } }); Long story short -this piece of code initializes our database if it doesn’t exist (and at it’s current version) and we create an object store, throw on some indexes, and then fake in 100k records (I went a bit overboard just to show how slick it is). Finally we can make a class and expose some simple CRUD functions with awful error handling.\nimport * as idb from 'idb'; const DATABASE_NAME = 'SERVICE_ORDERS'; const DATABASE_VERSION = 2; const db = idb.default; export const BUCKETS = ['Bucket01', 'Bucket02'] export const BUSINESS_UNITS = ['BU1', 'BU2', 'BU3', 'BU4', 'BU5'] export const STATUS = ['In Progress', 'Completed', 'Pending'] /** * Initialize the IndexedDB. * see https://developers.google.com/web/ilt/pwa/lab-indexeddb * for information as to why we use switch w/o breaks for migrations. * add do the database version and add a switch case each time you need to * change migrations */ const dbPromise = db.open(DATABASE_NAME, DATABASE_VERSION, function (upgradeDb) { /* tslint:disable */ switch (upgradeDb.oldVersion) { case 0: // a placeholder case so that the switch block will // execute when the database is first created // (oldVersion is 0) case 1: upgradeDb.createObjectStore('ServiceOrders', { keyPath: 'id' }); const tx = upgradeDb.transaction.objectStore('ServiceOrders', 'readwrite') tx.createIndex('Bucket', 'bucket') tx.createIndex('businessUnit', 'businessUnit') tx.createIndex('status', 'status') tx.createIndex('BucketBusinessUnitStatus', ['bucket', 'businessUnit', 'status']) for (let i = 0; i \u003c 100000; i++) { tx.put({ id: i, bucket: BUCKETS[Math.floor(Math.random() * BUCKETS.length)], businessUnit: BUSINESS_UNITS[Math.floor(Math.random() * BUSINESS_UNITS.length)], status: STATUS[Math.floor(Math.random() * STATUS.length)] }); } } }); class DBService { get(tablespace, key) { return dbPromise.then(db =\u003e { return db.transaction(tablespace).objectStore(tablespace).get(key); }).catch(error =\u003e { // Do something? }); } getAll(tablespace, indexName, index = []) { return dbPromise.then(db =\u003e { return db.transaction(tablespace).objectStore(tablespace).index(indexName).getAll(index); }).catch(error =\u003e { // Do something? }); } put(tablespace, object, key = null) { return dbPromise.then(db =\u003e { if (key) { return db.transaction(tablespace, 'readwrite').objectStore(tablespace).put(object, key); } return db.transaction(tablespace, 'readwrite').objectStore(tablespace).put(object); }).catch(error =\u003e { // Do something? }); } delete(tablespace, key) { return dbPromise.then(db =\u003e { return db.transaction(tablespace, 'readwrite').objectStore(tablespace).delete(key); }).catch(error =\u003e { // Do something? }); } deleteAll(tablespace) { return dbPromise.then(db =\u003e { return db.transaction(tablespace, 'readwrite').objectStore(tablespace).clear(); }).catch(error =\u003e { // Do something? }); } } export const Service = new DBService() Most of this is pretty straight forward. get, getAll, put, delete, deleteAll. There’s not much else to say here!\nI suppose we should load up our service and run it then! We’ll set up a generic component for browsing and set up react-router-dom since it’s super useful and @material-ui because it’s pretty.\nnpm install --save react-router-dom @material-ui/core @material-ui/icons\nReplace your src/index.js with the following:\n//src/index.js import React from 'react'; import ReactDOM from 'react-dom'; import { BrowserRouter } from 'react-router-dom' import './index.css'; import App from './App'; import * as serviceWorker from './serviceWorker'; ReactDOM.render( \u003cBrowserRouter\u003e \u003cApp /\u003e \u003c/BrowserRouter\u003e, document.getElementById('root')); // If you want your app to work offline and load faster, you can change // unregister() to register() below. Note this comes with some pitfalls. // Learn more about service workers: http://bit.ly/CRA-PWA serviceWorker.unregister(); Then create a new component for displaying our data in a ServiceOrderList component\n// src/components/service-orders/service-order-list.js import * as React from 'react'; import { Service } from '../../services/DBService'; import { Link } from 'react-router-dom'; import { CircularProgress, Table, TableHead, TableCell, TableRow, TableBody, AppBar, Toolbar, Typography } from '@material-ui/core'; import './service-orders-list.css'; export default class ServiceOrdersListComponent extends React.Component { constructor(props) { super(props) this.state = { bucket: this.props.match.params.bucket, businessUnit: this.props.match.params.businessUnit, status: this.props.match.params.status, isLoading: true } this._getOrders() } _getOrders() { let idx = [this.state.bucket, this.state.businessUnit, this.state.status] Service.getAll('ServiceOrders', 'BucketBusinessUnitStatus', idx).then(orders =\u003e { this.setState({ orders: orders, isLoading: false }) }); } render() { let { bucket, businessUnit, status, isLoading } = this.state let { orders } = this.state return \u003cdiv\u003e \u003cAppBar position=\"static\"\u003e \u003cToolbar\u003e \u003cTypography variant=\"h6\"\u003e {bucket} - {businessUnit} - {status} \u003c/Typography\u003e \u003c/Toolbar\u003e \u003c/AppBar\u003e {orders \u0026\u0026 \u003cp\u003eViewing {orders.length} orders\u003c/p\u003e} {isLoading \u0026\u0026 \u003cCircularProgress /\u003e} { !isLoading \u0026\u0026 \u003cTable\u003e \u003cTableHead\u003e \u003cTableRow\u003e \u003cTableCell className=\"sticky-header\"\u003eID\u003c/TableCell\u003e \u003cTableCell className=\"sticky-header\"\u003eBucket\u003c/TableCell\u003e \u003cTableCell className=\"sticky-header\"\u003eBusiness Unit\u003c/TableCell\u003e \u003cTableCell className=\"sticky-header\"\u003eStatus\u003c/TableCell\u003e \u003c/TableRow\u003e \u003c/TableHead\u003e \u003cTableBody style={{ overflowY: 'scroll' }}\u003e {orders \u0026\u0026 orders.map(o =\u003e \u003cTableRow key={o.id}\u003e \u003cTableCell\u003e \u003cLink to={'/serviceOrders/' + o.id}\u003e{o.id}\u003c/Link\u003e \u003cTableCell\u003e{o.bucket}\u003c/TableCell\u003e \u003cTableCell\u003e{o.businessUnit}\u003c/TableCell\u003e \u003cTableCell\u003e{o.status}\u003c/TableCell\u003e \u003c/TableRow\u003e)} \u003c/TableBody\u003e \u003c/Table\u003e } \u003c/div \u003e; } } I had a .css file in there too:\n// src/components/service-orders/service-orders-list.css .sticky-header{ position:sticky; position:-webkit-sticky; background-color:#fff; top:0; text-align:left; } A HomeComponent to help us navigate:\n//src/components/home/home-component.js import * as React from 'react'; import { Link } from 'react-router-dom'; import { BUCKETS, BUSINESS_UNITS, STATUS } from '../../services/DBService'; export default class HomeComponent extends React.Component { render() { let refs = [] BUCKETS.forEach(bu =\u003e { BUSINESS_UNITS.forEach(b =\u003e { STATUS.forEach(s =\u003e { let path = \"/serviceOrders/bucket/\" + bu + \"/businessUnit/\" + b + \"/status/\" + s refs.push(\u003cLink to={path}\u003e{path}\u003c/Link\u003e) }) }) }) return \u003cdiv\u003e \u003ch3\u003eSome Routes\u003c/h3\u003e {refs.map((r, i) =\u003e \u003cli key={i}\u003e{r}\u003c/li\u003e)} \u003c/div\u003e } } A ServiceOrderDetail component for more fun:\n//src/components/service-orders/service-order-detail.js import * as React from 'react'; import { Service } from '../../services/DBService'; import { AppBar, Toolbar, Typography, IconButton } from '@material-ui/core'; import KeyboardArrowLeftIcon from '@material-ui/icons/KeyboardArrowLeft'; export default class ServiceOrderDetailComponent extends React.Component { constructor(props) { super(props) this.state = { id: parseInt(this.props.match.params.id) } this._getOrder() } _getOrder() { Service.get('ServiceOrders', this.state.id).then(o =\u003e { this.setState({ order: o }) }) } _goBack = () =\u003e { this.props.history.goBack() } render() { const { order } = this.state; return \u003cdiv\u003e \u003cAppBar position=\"static\"\u003e \u003cToolbar\u003e \u003cIconButton onClick={this._goBack}\u003e \u003cKeyboardArrowLeftIcon /\u003e \u003c/IconButton\u003e \u003cTypography variant=\"h6\"\u003e Order Details \u003c/Typography\u003e \u003c/Toolbar\u003e \u003c/AppBar\u003e \u003cpre\u003e{JSON.stringify(order, null, 2)}\u003c/pre\u003e \u003c/div\u003e } } A NotFound component for handling routing NotFound issues\n//src/components/errors/not-found.js import * as React from 'react'; export default class NotFoundComponent extends React.Component { render() { return \u003ch1\u003eNot Found!\u003c/h1\u003e } } Finally in src/App.js\nimport React, { Component } from 'react'; import './App.css'; import { Route, Switch } from 'react-router-dom'; import ServiceOrdersListComponent from './components/service-orders/service-orders-list'; import HomeComponent from './components/home/home-component'; import ServiceOrderDetailComponent from './components/service-orders/service-order-detail'; import NotFoundComponent from './components/errors/not-found'; class App extends Component { render() { return ( \u003cdiv\u003e \u003cSwitch\u003e \u003cRoute exact path=\"/\" component={HomeComponent} /\u003e \u003cRoute path=\"/serviceOrders/bucket/:bucket/businessUnit/:businessUnit/status/:status\" component={ServiceOrdersListComponent} /\u003e \u003cRoute exact path=\"/serviceOrders/:id\" component={ServiceOrderDetailComponent} /\u003e \u003cRoute component={NotFoundComponent} /\u003e \u003c/Switch\u003e \u003c/div \u003e ); } } export default App; Go ahead and start up the app now. The first load of your route will take a little bit as the database gets seeded, but you will see how quickly it loads (and renders) 3k records (on average per bucket)\nThe list is neat, but if you look in your devtools under application and IndexedDB you can see our table of data and all the different indexes we created to help us in our application!\nIndexedDB Table with Indexes\nBy default our keyPath (and thusly main table) is indexed by id. We built some single key indexes and one compound key index which makes our data access a breeze! We can use this compound index to filter our data down by each of our keys, but in that specific order. For instance, we search for a specific Bucket first:\nBrowse by Bucket02 first\nThen we browse by a specific business unit as well:\nBrowsing byBucket and Business Unit\nPretty neat, hey? Having this functionality provides us with some significant gains over a naive key-value store. These include:\nWe are now able to reduce our API’s need to understand how our data will be organized on the client. We can just toss down all the orders and then query it like a regular old database client side. Our client code is simplified as we won’t need to do any map-reducing on big collections - the browser’s API handles it for us. When we want to update a record, we can serialize and deserialize a single record instead of the entire collection. Atomic updates are good updates. This refactor is still being considered for the project as it’s a fair bit of work to introduce a sweeping change such as this. However hopefully you read this before you got started on your projects and you have a new idea to try out before making a decision for your offline storage :)\nSome other optimizations that would be good to do include paginating the data so that you’re not rendering all 3k items on every load. I figure that’s outside the scope of this indexed db discussion though.\nEnjoi :)\n","wordCount":"1895","inLanguage":"en","datePublished":"2019-01-09T13:07:23Z","dateModified":"2019-01-09T13:07:23Z","author":{"@type":"Person","name":"James D Hughes"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.jimdhughes.com/posts/2019/indexeddb-react/"},"publisher":{"@type":"Organization","name":"James Hughes","logo":{"@type":"ImageObject","url":"https://blog.jimdhughes.com/favicon.ico"}}}</script></head><body id="
  top"><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.jimdhughes.com/ accesskey=h title="James Hughes (Alt + H)">James Hughes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">IndexedDB + React for Offline Storage</h1><div class=post-description>Building an app with React, IndexedDB, and a ridiculous amount of seed data</div><div class=post-meta><span title='2019-01-09 13:07:23 +0000 UTC'>January 9, 2019</span>&nbsp;·&nbsp;James D Hughes</div></header><div class=post-content><p>Offline data is annoying.</p><p>I&rsquo;m used to storing data in localstorage which is okay&mldr; sometimes. When you have a small amount of data to store such as user settings or persisting filters between views then this is a decent enough solution. I was working on a project recently that had a wild requirement appear where we needed to store upwards of 10k items offline. Needless to say, this put performance problems in our application.</p><p>This was primarily because of the time it took to serialize and deserialize (stringify and parse) the payload to be used. We were using some observables to watch our collection and any time there was a change, we persisted the whole collection to localstorage - sounds not bad right? For typical usage (a thousand items or so) it was just fine. When we had upwards of 10k items in our collection - we started experiencing lag. Approximately 1.5-3 seconds worth of lag each time we changed an item in the collection. Needless to say, this was unacceptable.</p><p>We started researching different usages of IndexedDB. The team was pretty comfortable using localstorage and structured our data to use key/value stores in that way. We didn&rsquo;t <em>really</em> understand the true power of IndexedDB as an awesomex data store in the browser.</p><p>So - I&rsquo;m going to walk you through my PoC to show the awesome performance gains we would realize by using IndexedDB in our app to it&rsquo;s fullest. As usual, the code is available on my <a href=https://github.com/jimdhughes/react-indexeddb-demo>Github</a></p><p>We&rsquo;ll start it off using create-react-app. (I ejected the app before putting it in my GitHub because reasons) I&rsquo;m not going to show you how to do that. There&rsquo;s loads of getting started tutorials for that.</p><p><code>create-react-app my-app</code></p><p>First thing I&rsquo;m going to do, the meat and potatoes of this post, is to install the <code>idb</code> package which wraps the IndexedDB API with promises - making life so much easier.</p><p><code>npm install --save idb</code></p><p>Then I&rsquo;m going to make a service in <code>src/services/DBService.js</code>. In this, I&rsquo;m going to make sure to set some constants for setting up my database and versioning it, and for demo purposes we&rsquo;re going to set up some predictable placeholder data for the purposes of showcasing the awesome IndexedDB functionality.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//src/services/DBService.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>idb</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;idb&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>DATABASE_NAME</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SERVICE_ORDERS&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>DATABASE_VERSION</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>idb</span>.<span style=color:#66d9ef>default</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BUCKETS</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Bucket01&#39;</span>, <span style=color:#e6db74>&#39;Bucket02&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BUSINESS_UNITS</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;BU1&#39;</span>, <span style=color:#e6db74>&#39;BU2&#39;</span>, <span style=color:#e6db74>&#39;BU3&#39;</span>, <span style=color:#e6db74>&#39;BU4&#39;</span>, <span style=color:#e6db74>&#39;BU5&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>STATUS</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;In Progress&#39;</span>, <span style=color:#e6db74>&#39;Completed&#39;</span>, <span style=color:#e6db74>&#39;Pending&#39;</span>]
</span></span></code></pre></div><p>Next we declare the promise for creating the database. You can read the docs on how to work this <a href=https://developers.google.com/web/ilt/pwa/working-with-indexeddb>here</a> and <a href=https://developers.google.com/web/ilt/pwa/lab-indexeddb>here</a> [] but I&rsquo;m not going to go into the nuts and bolts of indexed db here.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Initialize the IndexedDB.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * see https://developers.google.com/web/ilt/pwa/lab-indexeddb
</span></span></span><span style=display:flex><span><span style=color:#75715e> * for information as to why we use switch w/o breaks for migrations.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * add do the database version and add a switch case each time you need to
</span></span></span><span style=display:flex><span><span style=color:#75715e> * change migrations
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dbPromise</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>DATABASE_NAME</span>, <span style=color:#a6e22e>DATABASE_VERSION</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>upgradeDb</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>/* tslint:disable */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>upgradeDb</span>.<span style=color:#a6e22e>oldVersion</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// a placeholder case so that the switch block will
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// execute when the database is first created
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// (oldVersion is 0)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>upgradeDb</span>.<span style=color:#a6e22e>createObjectStore</span>(<span style=color:#e6db74>&#39;ServiceOrders&#39;</span>, { <span style=color:#a6e22e>keyPath</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;id&#39;</span> });
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>upgradeDb</span>.<span style=color:#a6e22e>transaction</span>.<span style=color:#a6e22e>objectStore</span>(<span style=color:#e6db74>&#39;ServiceOrders&#39;</span>, <span style=color:#e6db74>&#39;readwrite&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>createIndex</span>(<span style=color:#e6db74>&#39;Bucket&#39;</span>, <span style=color:#e6db74>&#39;bucket&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>createIndex</span>(<span style=color:#e6db74>&#39;businessUnit&#39;</span>, <span style=color:#e6db74>&#39;businessUnit&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>createIndex</span>(<span style=color:#e6db74>&#39;status&#39;</span>, <span style=color:#e6db74>&#39;status&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>createIndex</span>(<span style=color:#e6db74>&#39;BucketBusinessUnitStatus&#39;</span>, [<span style=color:#e6db74>&#39;bucket&#39;</span>, <span style=color:#e6db74>&#39;businessUnit&#39;</span>, <span style=color:#e6db74>&#39;status&#39;</span>])
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100000</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>put</span>({
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>i</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>bucket</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>BUCKETS</span>[Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>BUCKETS</span>.<span style=color:#a6e22e>length</span>)],
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>businessUnit</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>BUSINESS_UNITS</span>[Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>BUSINESS_UNITS</span>.<span style=color:#a6e22e>length</span>)],
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>STATUS</span>[Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>STATUS</span>.<span style=color:#a6e22e>length</span>)]
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Long story short -this piece of code initializes our database if it doesn&rsquo;t exist (and at it&rsquo;s current version) and we create an object store, throw on some indexes, and then fake in 100k records (I went a bit overboard just to show how slick it is). Finally we can make a class and expose some simple CRUD functions with awful error handling.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>idb</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;idb&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>DATABASE_NAME</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SERVICE_ORDERS&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>DATABASE_VERSION</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>idb</span>.<span style=color:#66d9ef>default</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BUCKETS</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Bucket01&#39;</span>, <span style=color:#e6db74>&#39;Bucket02&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BUSINESS_UNITS</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;BU1&#39;</span>, <span style=color:#e6db74>&#39;BU2&#39;</span>, <span style=color:#e6db74>&#39;BU3&#39;</span>, <span style=color:#e6db74>&#39;BU4&#39;</span>, <span style=color:#e6db74>&#39;BU5&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>STATUS</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;In Progress&#39;</span>, <span style=color:#e6db74>&#39;Completed&#39;</span>, <span style=color:#e6db74>&#39;Pending&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Initialize the IndexedDB.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * see https://developers.google.com/web/ilt/pwa/lab-indexeddb
</span></span></span><span style=display:flex><span><span style=color:#75715e> * for information as to why we use switch w/o breaks for migrations.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * add do the database version and add a switch case each time you need to
</span></span></span><span style=display:flex><span><span style=color:#75715e> * change migrations
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dbPromise</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>DATABASE_NAME</span>, <span style=color:#a6e22e>DATABASE_VERSION</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>upgradeDb</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>/* tslint:disable */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>upgradeDb</span>.<span style=color:#a6e22e>oldVersion</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// a placeholder case so that the switch block will
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// execute when the database is first created
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// (oldVersion is 0)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>upgradeDb</span>.<span style=color:#a6e22e>createObjectStore</span>(<span style=color:#e6db74>&#39;ServiceOrders&#39;</span>, { <span style=color:#a6e22e>keyPath</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;id&#39;</span> });
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>upgradeDb</span>.<span style=color:#a6e22e>transaction</span>.<span style=color:#a6e22e>objectStore</span>(<span style=color:#e6db74>&#39;ServiceOrders&#39;</span>, <span style=color:#e6db74>&#39;readwrite&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>createIndex</span>(<span style=color:#e6db74>&#39;Bucket&#39;</span>, <span style=color:#e6db74>&#39;bucket&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>createIndex</span>(<span style=color:#e6db74>&#39;businessUnit&#39;</span>, <span style=color:#e6db74>&#39;businessUnit&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>createIndex</span>(<span style=color:#e6db74>&#39;status&#39;</span>, <span style=color:#e6db74>&#39;status&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>createIndex</span>(<span style=color:#e6db74>&#39;BucketBusinessUnitStatus&#39;</span>, [<span style=color:#e6db74>&#39;bucket&#39;</span>, <span style=color:#e6db74>&#39;businessUnit&#39;</span>, <span style=color:#e6db74>&#39;status&#39;</span>])
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100000</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>put</span>({
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>i</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>bucket</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>BUCKETS</span>[Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>BUCKETS</span>.<span style=color:#a6e22e>length</span>)],
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>businessUnit</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>BUSINESS_UNITS</span>[Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>BUSINESS_UNITS</span>.<span style=color:#a6e22e>length</span>)],
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>STATUS</span>[Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>STATUS</span>.<span style=color:#a6e22e>length</span>)]
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DBService</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>tablespace</span>, <span style=color:#a6e22e>key</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dbPromise</span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>db</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>transaction</span>(<span style=color:#a6e22e>tablespace</span>).<span style=color:#a6e22e>objectStore</span>(<span style=color:#a6e22e>tablespace</span>).<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>    }).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Do something?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>getAll</span>(<span style=color:#a6e22e>tablespace</span>, <span style=color:#a6e22e>indexName</span>, <span style=color:#a6e22e>index</span> <span style=color:#f92672>=</span> []) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dbPromise</span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>db</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>transaction</span>(<span style=color:#a6e22e>tablespace</span>).<span style=color:#a6e22e>objectStore</span>(<span style=color:#a6e22e>tablespace</span>).<span style=color:#a6e22e>index</span>(<span style=color:#a6e22e>indexName</span>).<span style=color:#a6e22e>getAll</span>(<span style=color:#a6e22e>index</span>);
</span></span><span style=display:flex><span>    }).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Do something?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>tablespace</span>, <span style=color:#a6e22e>object</span>, <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dbPromise</span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>db</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>transaction</span>(<span style=color:#a6e22e>tablespace</span>, <span style=color:#e6db74>&#39;readwrite&#39;</span>).<span style=color:#a6e22e>objectStore</span>(<span style=color:#a6e22e>tablespace</span>).<span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>object</span>, <span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>transaction</span>(<span style=color:#a6e22e>tablespace</span>, <span style=color:#e6db74>&#39;readwrite&#39;</span>).<span style=color:#a6e22e>objectStore</span>(<span style=color:#a6e22e>tablespace</span>).<span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>object</span>);
</span></span><span style=display:flex><span>    }).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Do something?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>delete</span>(<span style=color:#a6e22e>tablespace</span>, <span style=color:#a6e22e>key</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dbPromise</span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>db</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>transaction</span>(<span style=color:#a6e22e>tablespace</span>, <span style=color:#e6db74>&#39;readwrite&#39;</span>).<span style=color:#a6e22e>objectStore</span>(<span style=color:#a6e22e>tablespace</span>).<span style=color:#66d9ef>delete</span>(<span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>    }).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Do something?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>deleteAll</span>(<span style=color:#a6e22e>tablespace</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dbPromise</span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>db</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>transaction</span>(<span style=color:#a6e22e>tablespace</span>, <span style=color:#e6db74>&#39;readwrite&#39;</span>).<span style=color:#a6e22e>objectStore</span>(<span style=color:#a6e22e>tablespace</span>).<span style=color:#a6e22e>clear</span>();
</span></span><span style=display:flex><span>    }).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Do something?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Service</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DBService</span>()
</span></span></code></pre></div><p>Most of this is pretty straight forward. get, getAll, put, delete, deleteAll. There&rsquo;s not much else to say here!</p><p>I suppose we should load up our service and run it then! We&rsquo;ll set up a generic component for browsing and set up <code>react-router-dom</code> since it&rsquo;s super useful and <code>@material-ui</code> because it&rsquo;s pretty.</p><p><code>npm install --save react-router-dom @material-ui/core @material-ui/icons</code></p><p>Replace your <code>src/index.js</code> with the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//src/index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ReactDOM</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-dom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>BrowserRouter</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-router-dom&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;./index.css&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>App</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./App&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>serviceWorker</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./serviceWorker&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ReactDOM</span>.<span style=color:#a6e22e>render</span>(
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>BrowserRouter</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>App</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/BrowserRouter&gt;, document.getElementById(&#39;root&#39;));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// If you want your app to work offline and load faster, you can change
</span></span></span><span style=display:flex><span><span style=color:#75715e>// unregister() to register() below. Note this comes with some pitfalls.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Learn more about service workers: http://bit.ly/CRA-PWA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>serviceWorker</span>.<span style=color:#a6e22e>unregister</span>();
</span></span></code></pre></div><p>Then create a new component for displaying our data in a <code>ServiceOrderList</code> component</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// src/components/service-orders/service-order-list.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Service</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../../services/DBService&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Link</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-router-dom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>CircularProgress</span>, <span style=color:#a6e22e>Table</span>, <span style=color:#a6e22e>TableHead</span>, <span style=color:#a6e22e>TableCell</span>, <span style=color:#a6e22e>TableRow</span>, <span style=color:#a6e22e>TableBody</span>, <span style=color:#a6e22e>AppBar</span>, <span style=color:#a6e22e>Toolbar</span>, <span style=color:#a6e22e>Typography</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@material-ui/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;./service-orders-list.css&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ServiceOrdersListComponent</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>bucket</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>match</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>bucket</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>businessUnit</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>match</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>businessUnit</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>match</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>status</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>isLoading</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_getOrders</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>_getOrders</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>idx</span> <span style=color:#f92672>=</span> [<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>bucket</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>businessUnit</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>status</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Service</span>.<span style=color:#a6e22e>getAll</span>(<span style=color:#e6db74>&#39;ServiceOrders&#39;</span>, <span style=color:#e6db74>&#39;BucketBusinessUnitStatus&#39;</span>, <span style=color:#a6e22e>idx</span>).<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>orders</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({ <span style=color:#a6e22e>orders</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>orders</span>, <span style=color:#a6e22e>isLoading</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> })
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> { <span style=color:#a6e22e>bucket</span>, <span style=color:#a6e22e>businessUnit</span>, <span style=color:#a6e22e>status</span>, <span style=color:#a6e22e>isLoading</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> { <span style=color:#a6e22e>orders</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>AppBar</span> <span style=color:#a6e22e>position</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;static&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Toolbar</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Typography</span> <span style=color:#a6e22e>variant</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;h6&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            {<span style=color:#a6e22e>bucket</span>} <span style=color:#f92672>-</span> {<span style=color:#a6e22e>businessUnit</span>} <span style=color:#f92672>-</span> {<span style=color:#a6e22e>status</span>}
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Typography&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Toolbar&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/AppBar&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      {<span style=color:#a6e22e>orders</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>p</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Viewing</span> {<span style=color:#a6e22e>orders</span>.<span style=color:#a6e22e>length</span>} <span style=color:#a6e22e>orders</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/p&gt;}</span>
</span></span><span style=display:flex><span>      {<span style=color:#a6e22e>isLoading</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>CircularProgress</span> <span style=color:#f92672>/&gt;</span>}
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>!</span><span style=color:#a6e22e>isLoading</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Table</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableHead</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableRow</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableCell</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sticky-header&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>ID</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableCell&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableCell</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sticky-header&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Bucket</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableCell&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableCell</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sticky-header&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Business</span> <span style=color:#a6e22e>Unit</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableCell&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableCell</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sticky-header&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Status</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableCell&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableRow&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableHead&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableBody</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>overflowY</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;scroll&#39;</span> }}<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            {<span style=color:#a6e22e>orders</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>orders</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>o</span> =&gt; <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableRow</span> <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>id</span>}<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableCell</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Link</span> <span style=color:#a6e22e>to</span><span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;/serviceOrders/&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>id</span>}<span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>id</span>}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Link&gt;&lt;/TableCell&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableCell</span><span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>bucket</span>}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableCell&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableCell</span><span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>businessUnit</span>}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableCell&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>TableCell</span><span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>status</span>}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableCell&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableRow&gt;)}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/TableBody&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Table&gt;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div &gt;;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I had a .css file in there too:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>//</span> <span style=color:#f92672>src</span><span style=color:#f92672>/</span><span style=color:#f92672>components</span><span style=color:#f92672>/</span><span style=color:#f92672>service-orders</span><span style=color:#f92672>/</span><span style=color:#f92672>service-orders-list</span>.<span style=color:#a6e22e>css</span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>sticky-header</span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>position</span>:<span style=color:#66d9ef>sticky</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>position</span>:<span style=color:#66d9ef>-webkit-</span><span style=color:#66d9ef>sticky</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background-color</span>:<span style=color:#ae81ff>#fff</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>top</span>:<span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>text-align</span>:<span style=color:#66d9ef>left</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>A <code>HomeComponent</code> to help us navigate:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//src/components/home/home-component.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Link</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-router-dom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>BUCKETS</span>, <span style=color:#a6e22e>BUSINESS_UNITS</span>, <span style=color:#a6e22e>STATUS</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../../services/DBService&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HomeComponent</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>refs</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>BUCKETS</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>bu</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>BUSINESS_UNITS</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>b</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>STATUS</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>s</span> =&gt; {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/serviceOrders/bucket/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>bu</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/businessUnit/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/status/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>refs</span>.<span style=color:#a6e22e>push</span>(<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Link</span> <span style=color:#a6e22e>to</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>path</span>}<span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>path</span>}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Link&gt;)</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>h3</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Some</span> <span style=color:#a6e22e>Routes</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/h3&gt;</span>
</span></span><span style=display:flex><span>      {<span style=color:#a6e22e>refs</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>i</span>) =&gt; <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>li</span> <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>i</span>}<span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>r</span>}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/li&gt;)}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>A <code>ServiceOrderDetail</code> component for more fun:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//src/components/service-orders/service-order-detail.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Service</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../../services/DBService&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>AppBar</span>, <span style=color:#a6e22e>Toolbar</span>, <span style=color:#a6e22e>Typography</span>, <span style=color:#a6e22e>IconButton</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@material-ui/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>KeyboardArrowLeftIcon</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@material-ui/icons/KeyboardArrowLeft&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ServiceOrderDetailComponent</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> parseInt(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>match</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>id</span>) }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_getOrder</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>_getOrder</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Service</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;ServiceOrders&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>id</span>).<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>o</span> =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({ <span style=color:#a6e22e>order</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>o</span> })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>_goBack</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>history</span>.<span style=color:#a6e22e>goBack</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>order</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>AppBar</span> <span style=color:#a6e22e>position</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;static&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Toolbar</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>IconButton</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_goBack</span>}<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>KeyboardArrowLeftIcon</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/IconButton&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Typography</span> <span style=color:#a6e22e>variant</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;h6&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Order</span> <span style=color:#a6e22e>Details</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Typography&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Toolbar&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/AppBar&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>pre</span><span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>order</span>, <span style=color:#66d9ef>null</span>, <span style=color:#ae81ff>2</span>)}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/pre&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>A <code>NotFound</code> component for handling routing <code>NotFound</code> issues</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>//src/components/errors/not-found.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NotFoundComponent</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>h1</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Not</span> <span style=color:#a6e22e>Found</span><span style=color:#f92672>!&lt;</span><span style=color:#960050;background-color:#1e0010>/h1&gt;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Finally in src/App.js</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>React</span>, { <span style=color:#a6e22e>Component</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;./App.css&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Route</span>, <span style=color:#a6e22e>Switch</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-router-dom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ServiceOrdersListComponent</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./components/service-orders/service-orders-list&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>HomeComponent</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./components/home/home-component&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ServiceOrderDetailComponent</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./components/service-orders/service-order-detail&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>NotFoundComponent</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./components/errors/not-found&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Switch</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Route</span> <span style=color:#a6e22e>exact</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/&#34;</span> <span style=color:#a6e22e>component</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>HomeComponent</span>} <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Route</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/serviceOrders/bucket/:bucket/businessUnit/:businessUnit/status/:status&#34;</span> <span style=color:#a6e22e>component</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>ServiceOrdersListComponent</span>} <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Route</span> <span style=color:#a6e22e>exact</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/serviceOrders/:id&#34;</span> <span style=color:#a6e22e>component</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>ServiceOrderDetailComponent</span>} <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Route</span> <span style=color:#a6e22e>component</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>NotFoundComponent</span>} <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Switch&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div &gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>App</span>;
</span></span></code></pre></div><p>Go ahead and start up the app now. The first load of your route will take a little bit as the database gets seeded, but you will see how quickly it loads (and renders) 3k records (on average per bucket)</p><p>The list is neat, but if you look in your devtools under application and IndexedDB you can see our table of data and all the different indexes we created to help us in our application!</p><figure><img loading=lazy src=/content/images/2019/01/Screen-Shot-2019-01-08-at-10.19.49-PM.png alt="IndexedDB Table with Indexes"><figcaption><p>IndexedDB Table with Indexes</p></figcaption></figure><p>By default our keyPath (and thusly main table) is indexed by id. We built some single key indexes and one compound key index which makes our data access a breeze! We can use this compound index to filter our data down by each of our keys, but in that specific order. For instance, we search for a specific Bucket first:</p><figure><img loading=lazy src=/content/images/2019/01/Screen-Shot-2019-01-08-at-10.22.17-PM.png alt="Browse by Bucket02 first"><figcaption><p>Browse by Bucket02 first</p></figcaption></figure><p>Then we browse by a specific business unit as well:</p><figure><img loading=lazy src=/content/images/2019/01/Screen-Shot-2019-01-08-at-10.22.36-PM.png alt="Browsing byBucket and Business Unit"><figcaption><p>Browsing byBucket and Business Unit</p></figcaption></figure><p>Pretty neat, hey? Having this functionality provides us with some significant gains over a naive key-value store. These include:</p><ol><li>We are now able to reduce our API&rsquo;s need to understand how our data will be organized on the client. We can just toss down all the orders and then query it like a regular old database client side.</li><li>Our client code is simplified as we won&rsquo;t need to do any map-reducing on big collections - the browser&rsquo;s API handles it for us.</li><li>When we want to update a record, we can serialize and deserialize a single record instead of the entire collection. Atomic updates are good updates.</li></ol><p>This refactor is still being considered for the project as it&rsquo;s a fair bit of work to introduce a sweeping change such as this. However hopefully you read this before you got started on your projects and you have a new idea to try out before making a decision for your offline storage :)</p><p>Some other optimizations that would be good to do include paginating the data so that you&rsquo;re not rendering all 3k items on every load. I figure that&rsquo;s outside the scope of this indexed db discussion though.</p><p>Enjoi :)</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.jimdhughes.com/tags/frontend/>Frontend</a></li><li><a href=https://blog.jimdhughes.com/tags/indexdb/>Indexdb</a></li><li><a href=https://blog.jimdhughes.com/tags/react/>React</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.jimdhughes.com/>James Hughes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>