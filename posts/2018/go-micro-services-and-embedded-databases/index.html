<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Go - Micro-services and Embedded Databases [Part 1] | James Hughes</title>
<meta name=keywords content="golang"><meta name=description content="This is fun!
FYI - If you&rsquo;re looking for Part 2, it&rsquo;s here[.]

I&rsquo;ve been meaning to learn a few of the things I&rsquo;m going to go over in this post. Firstly, I want to make an actual useful application using Go. I want it to be run as a microservice with it&rsquo;s own database. Instead of putting it in a docker container, I want to just use an embedded database that the executable can use."><meta name=author content="James D Hughes"><link rel=canonical href=https://blog.jimdhughes.com/posts/2018/go-micro-services-and-embedded-databases/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.jimdhughes.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.jimdhughes.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.jimdhughes.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.jimdhughes.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.jimdhughes.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.jimdhughes.com/posts/2018/go-micro-services-and-embedded-databases/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-0ET0VYDXCL"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0ET0VYDXCL")</script><meta property="og:url" content="https://blog.jimdhughes.com/posts/2018/go-micro-services-and-embedded-databases/"><meta property="og:site_name" content="James Hughes"><meta property="og:title" content="Go - Micro-services and Embedded Databases [Part 1]"><meta property="og:description" content="This is fun!
FYI - If you’re looking for Part 2, it’s here[.]
I’ve been meaning to learn a few of the things I’m going to go over in this post. Firstly, I want to make an actual useful application using Go. I want it to be run as a microservice with it’s own database. Instead of putting it in a docker container, I want to just use an embedded database that the executable can use."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-09-19T06:30:15+00:00"><meta property="article:modified_time" content="2018-09-19T06:30:15+00:00"><meta property="article:tag" content="Golang"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go - Micro-services and Embedded Databases [Part 1]"><meta name=twitter:description content="This is fun!
FYI - If you&rsquo;re looking for Part 2, it&rsquo;s here[.]

I&rsquo;ve been meaning to learn a few of the things I&rsquo;m going to go over in this post. Firstly, I want to make an actual useful application using Go. I want it to be run as a microservice with it&rsquo;s own database. Instead of putting it in a docker container, I want to just use an embedded database that the executable can use."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Go - Micro-services and Embedded Databases [Part 1]","item":"https://blog.jimdhughes.com/posts/2018/go-micro-services-and-embedded-databases/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Go - Micro-services and Embedded Databases [Part 1]","name":"Go - Micro-services and Embedded Databases [Part 1]","description":"This is fun!\nFYI - If you\u0026rsquo;re looking for Part 2, it\u0026rsquo;s here[.]\nI\u0026rsquo;ve been meaning to learn a few of the things I\u0026rsquo;m going to go over in this post. Firstly, I want to make an actual useful application using Go. I want it to be run as a microservice with it\u0026rsquo;s own database. Instead of putting it in a docker container, I want to just use an embedded database that the executable can use.\n","keywords":["golang"],"articleBody":"This is fun!\nFYI - If you’re looking for Part 2, it’s here[.]\nI’ve been meaning to learn a few of the things I’m going to go over in this post. Firstly, I want to make an actual useful application using Go. I want it to be run as a microservice with it’s own database. Instead of putting it in a docker container, I want to just use an embedded database that the executable can use.\nWe’re going to build a user authentication and token validation app. It’ll use REST for communication (gRPC may come later) and will store users using BoltDB. The server will allow registration, logging in, will issue tokens and will validate tokens.\nThe endpoints for our app will be:\nPOST /login - Takes an email and password and attempts to log a user in\nPOST /register - Takes an email and password an attempts to create a new user\nPOST /validateToken - checks a supplied token. If it’s valid it sends back the information of the authenticated user.\nWe’re going to use a couple golang libraries that seem pretty popular. For routing, we will use gorilla/mux, for the database we will use boltdb/bolt and for password hashing we will use golang.org/x/crypto/bcrypt. Go ahead and ‘go get’ them and we’ll dive right in.\nI start every go project by making a main.go and printing a simple Hello, World! so let’s start there again\npackage main import \"fmt\" func main() { fmt.Println(\"Hello, World!\") } It’s kind of hard to figure out where to start next. I’m going to elect to start by making my model. I’m going to make a new file called model.go and it’ll look like so:\npackage main // User structure for accounts type User struct { ID string `json:\"id\"` Email string `json:\"email\"` Password string `json:\"password\"` } Since we’re going to need to encrypt and check password hashes, we may as well just attach it the the User struct. Let’s do that next.\n// ... // HashPassword sets the users password to the bcrypt hashed version of said password func (u *User) HashPassword() error { password, err := bcrypt.GenerateFromPassword([]byte(u.Password), 14) if err != nil { return err } u.Password = string(password) return nil } // CheckPassword compares a plain text password against the Hashed Password of the user func (u *User) CheckPassword(password string) error { err := bcrypt.CompareHashAndPassword([]byte(u.Password), []byte(password)) if err != nil { return err } return nil } We now have some testable code! For fun let’s write a test for the password hasing!\npackage main import ( \"testing\" ) func TestUserPassword(t *testing.T) { password := \"testpassword\" u := User{ Email: \"testEmail@domain.com\", Password: password, } u.HashPassword() if u.Password == password { // Password failed to hash t.Fail() } } func TestUserPasswordCompareCorrectPassword(t *testing.T) { password := \"testpassword\" u := User{ Email: \"testEmail@domain.com\", Password: password, } u.HashPassword() err := u.CheckPassword(password) if err != nil { t.Fatal(err) } } func TestUserPasswordCompareIncorrectPassword(t *testing.T) { password := \"testpassword\" u := User{ Email: \"testEmail@domain.com\", Password: password, } password = \"nope!\" u.HashPassword() err := u.CheckPassword(password) if err == nil { t.Fatal(err) } } Run these tests using go test. Everything should pass and now we can move on to making some actual functionality!\nNext I want to make some placeholder routes to handle the requests we want to handle. To do this, let’s make a new file called router.go\npackage main import ( \"fmt\" \"net/http\" \"github.com/gorilla/mux\" ) func NewRouter() *mux.Router { r := mux.NewRouter() r.HandleFunc(\"/login\", HandleLogin).Methods(\"POST\") r.HandleFunc(\"/register\", HandleRegistration).Methods(\"POST\") r.HandleFunc(\"/validateToken\", HandleValidateToken).Methods(\"POST\") return r } func HandleLogin(w http.ResponseWriter, r *http.Request) { w.WriteHeader(http.StatusInternalServerError) fmt.Fprintf(w, \"Not Yet Implemented\") } func HandleRegistration(w http.ResponseWriter, r *http.Request) { w.WriteHeader(http.StatusInternalServerError) fmt.Fprintf(w, \"Not Yet Implemented\") } func HandleValidateToken(w http.ResponseWriter, r *http.Request) { w.WriteHeader(http.StatusInternalServerError) fmt.Fprintf(w, \"Not Yet Implemented\") } Then we update our main.go file to initialize the router and serve up our routes that will all issue error responses!\npackage main import ( \"fmt\" \"log\" \"net/http\" ) func main() { fmt.Println(\"Hello, World!\") InitializeHttpServer() } func InitializeHttpServer() { r := NewRouter() log.Panic(http.ListenAndServe(\":8080\", r)) } I like to use postman to test my apis but you can curl it if you want. Go ahead and send some POST requests to our endpoints and you’ll get a simple 500 response with “Not Yet Implemented” as the response.\nNext we can either implement a service to handle these requests or we can implement the database interface. I’m going to elect to implement the database functionality because I’m a bit of a database nerd. BoltDB is a key/value store which is really all that we need for implementing an authentication database in a microservice. I’m not going to do anything fancy such as allowing token invalidation etc so this should be pretty simple! Let’s make a new file called db.go\npackage main import ( \"encoding/json\" \"fmt\" \"log\" \"strconv\" \"github.com/boltdb/bolt\" ) // Interface for the DB Client type IDBClient interface { Initialize(filepath string) Open() Close() CreateUser(u User) (bool, error) Login(email, password string) (string, error) CheckUserIsNew(email string) (bool, error) } // Struct to handle the DB Connection type DBClient struct { client *bolt.DB filepath string } // The DB Client for the application var DB IDBClient const ( usersBucketName string = \"Users\" ) func (db *DBClient) Open() { } func (db *DBClient) Initialize(filepath string) { } func (db *DBClient) Close() { } func (db *DBClient) CreateUser(u User) (bool, error) { return false, fmt.Errorf(\"Not Implemented\") } func (db *DBClient) Login(email, password string) (string, error) { return \"\", fmt.Errorf(\"Not Implemented\") } func (db *DBClient) CheckUserIsNew(email string) (bool, error) { return false, fmt.Errorf(\"Not Implemented\") } I’m no go pro but this is how I understand that go apps are organized. My OOP career has drilled into my head that you should always program against an interface so when they exist, I use them.\nThe DBClient is sort of like a class. We’re going to use it to store the bolt client, the location of the filepath, and then we are going to declare methods for it by using the syntax that is seen below. The var DB IDBClient line helps us to initialize the database handler and makes sure that our initialization of DBClient has all the functions as defined by the IDBClient interface. Clear as mud? Let’s do it then!\nFirst we may as well handle the easy stuff: Initialize, Open, and Close.\nfunc (db *DBClient) Initialize(filepath string) { db.filepath = filepath db.Open() defer db.Close() err := db.client.Update(func(txn *bolt.Tx) error { // Initialize Users Bucket _, err := txn.CreateBucketIfNotExists([]byte(usersBucketName)) if err != nil { return err } return nil }) if err != nil { log.Panic(err) } } func (db *DBClient) Open() { if db.filepath == \"\" { log.Fatal(\"Filepath required for Database\") } d, err := bolt.Open(db.filepath, 0600, nil) if err != nil { log.Panic(err) } db.client = d } func (db *DBClient) Close() { db.client.Close() } The Initialize function takes a filepath. This would be the same as taking in an SQL connection string in any other app. This makes it way easier for us to set up our environment for testing and for production. We can set up and tear down test databases while leaving our production an development databases alone. We then set up the buckets that our app is going to need (which is just a Users bucket for now).\nThe Open function does just that. Opens the database and applies it to it’s client parameter. The close does just what you’d expect a close function to do as well.\nWe may as well write the functional code now. We’ll start with CreateUser and CheckUserIsNew\nfunc (db *DBClient) CreateUser(u User) (bool, error) { isNew, err := db.CheckUserIsNew(u.Email) if err != nil || isNew == false { return false, err } db.Open() defer db.Close() err = db.client.Update(func(txn *bolt.Tx) error { b := txn.Bucket([]byte(usersBucketName)) id, err := b.NextSequence() if err != nil { return err } u.ID = strconv.Itoa(int(id)) u.HashPassword() userBytes, err := json.Marshal(u) if err != nil { return err } err = b.Put([]byte(u.Email), userBytes) if err != nil { return err } return nil }) if err != nil { return false, nil } return true, nil } func (db *DBClient) CheckUserIsNew(email string) (bool, error) { db.Open() defer db.Close() err := db.client.View(func(tx *bolt.Tx) error { b := tx.Bucket([]byte(usersBucketName)) userBytes := b.Get([]byte(email)) if userBytes != nil { return fmt.Errorf(\"User with email %s already exists\", email) } return nil }) if err != nil { return false, err } return true, nil } CheckUserIsNew is just a helper function to determine if our user exists in the database already or not. This is helpful as we don’t really have key constraints in the embedded database. We need to ensure that we’re not just re-registering users when a registration request comes in. The CreateUser calls this as soon as possible and if a user exists, it returns an error. The CreateUser will then return this error to the calling function.\nWe can write some tests for this now! in db_test.go let’s set up some cases\npackage main import ( \"os\" \"testing\" ) func TestMain(m *testing.M) { DB = \u0026DBClient{} DB.Initialize(\"./bolt-test.db\") retCode := m.Run() os.Remove(\"./bolt-test.db\") os.Exit(retCode) } func TestCheckUserShouldNotReturnError(t *testing.T) { email := \"test@domain.com\" isNew, err := DB.CheckUserIsNew(email) if err != nil { t.Error(\"An Error was thrown that should not have been\") } if isNew == false { t.Error(\"User shouldn't Exist but does\") } } func TestCreateUser(t *testing.T) { u := User{ Email: \"test@domain.com\", Password: \"password\", } result, err := DB.CreateUser(u) if err != nil { t.Error(err) } if result == false { t.Error(\"User not created\") } } func TestCreateUserWithSameEmailShouldFail(t *testing.T) { u := User{ Email: \"test@domain.com\", Password: \"password\", } result, err := DB.CreateUser(u) if err == nil { t.Error(err) } if result == true { t.Error(\"User not created\") } } func TestCheckUserShouldReturnError(t *testing.T) { email := \"test@domain.com\" isNew, err := DB.CheckUserIsNew(email) if isNew == true { t.Error(\"User Should Exist but doesn't\") } if err == nil { t.Error(\"Error should have been thrown\") } } We first make sure that our CheckUserExists function returns false. We then test some CreateUser functionality and then finally make sure that our CheckUserExists returns an error as the account does already exist. Follow? Sweet! Let’s move on to the Login function!\n// db.go // ... func (db *DBClient) Login(email, password string) (string, error) { db.Open() defer db.Close() err := db.client.View(func(tx *bolt.Tx) error { b := tx.Bucket([]byte(usersBucketName)) userBytes := b.Get([]byte(email)) u := User{} json.Unmarshal(userBytes, \u0026u) err := u.CheckPassword(password) if err != nil { log.Printf(\"ERROR: %s\", err) log.Printf(\"Invalid Login Attempt for User: %s\", email) return fmt.Errorf(\"Invalid Email/Password Combnation\") } return nil }) if err != nil { return \"nope\", err } return \"yep\", nil } Here we take an email and password, load up the user from the database, check if the password is the valid hash, and then return a string response. We will replace this “nope” and “yep” with a token later but for now we will just use these.\nAnd again let’s make sure that we have some test cases for Login:\n// db_test.go // ... func TestValidLogin(t *testing.T) { _, err := DB.Login(\"test@domain.com\", \"password\") if err != nil { t.Error(err) } } func TestInvalidLogin(t *testing.T) { _, err := DB.Login(\"test@domain.com\", \"wrongpassword\") if err == nil { t.Error(\"The password should have been invalid\") } } Check our code again using go test and we should pass everything.\nA Note on Tests This isn’t really TDD. This is what we call lazy testing. Typically you’d write tests to test your functionality and THEN implement the code. This allows you to come up with as many different scenarios as possible and then write resilient code. That’s outside the scope of this little learning activity but some tests are better than no tests.\nNow that we have our core functionality in controllers we need to expose it externally. We will do this by going back to our router.go file and adding some real functionality as opposed to just throwing random errors :)\nLogically, we’ll implement the registration route first:\nfunc HandleRegistration(w http.ResponseWriter, r *http.Request) { var user User decoder := json.NewDecoder(r.Body) err := decoder.Decode(\u0026user) if err != nil { WriteError(w, http.StatusBadRequest, fmt.Errorf(\"Error Decoding User\")) } success, err := DB.CreateUser(user) if err != nil { WriteError(w, http.StatusBadRequest, err) return } fmt.Fprintf(w, \"Status: %t\", success) } func WriteError(w http.ResponseWriter, statusCode int, err error) { w.WriteHeader(statusCode) fmt.Fprintf(w, err.Error()) } You’ll notice that I added a WriteError helper function since it’s easier than repeating this code over and over again. Passing the actual error through to the client is PROBABLY not a great idea in a production environment though.\nBefore we can successfully build and run this, we will need to initialize our database. In main.go we’ll add a helper function and call it before we initialize the Router.\npackage main import ( \"fmt\" \"log\" \"net/http\" ) func main() { fmt.Println(\"Hello, World!\") InitializeDatabase() InitializeHttpServer() } func InitializeHttpServer() { r := NewRouter() log.Panic(http.ListenAndServe(\":8080\", r)) } func InitializeDatabase() { DB = \u0026DBClient{} DB.Initialize(\"bolt.db\") } Now - Build it and run! go build and ./whatever-your-foldername-is if you’re on *nix or ./whatever-your-foldername-is.exe if you’re on windows! I use Postman, you can use CURL if you like, but no matter what let’s send a registration request to http://localhost:8080/register with a payload of\n{ \"email\": \"someemail@domain.com\", \"password\": \"password\" } You should get a response of: Status: true. Success! We have registered a user!\nNow we should allow this user to login. We’ll implement the HandleLogin handler next.\nfunc HandleLogin(w http.ResponseWriter, r *http.Request) { var user User decoder := json.NewDecoder(r.Body) err := decoder.Decode(\u0026user) if err != nil { WriteError(w, http.StatusBadRequest, fmt.Errorf(\"Error Decoding User\")) } status, err := DB.Login(user.Email, user.Password) if err != nil { WriteError(w, http.StatusBadRequest, err) return } fmt.Fprintf(w, status) } Buld and run again! Send a POST to http://localhost:8080/login with the payload\n{ \"email\": \"someemail@domain.com\", \"password\": \"password\" } And you should get the message: yep.\nAnyways, this post has gotten REALLY long. So check back for part 2 where we implement the token service, the tokenValidation endpoints, and make some more interesting responses that can be digested better by a calling service.\nKeep Hacking!\n","wordCount":"2331","inLanguage":"en","datePublished":"2018-09-19T06:30:15Z","dateModified":"2018-09-19T06:30:15Z","author":{"@type":"Person","name":"James D Hughes"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.jimdhughes.com/posts/2018/go-micro-services-and-embedded-databases/"},"publisher":{"@type":"Organization","name":"James Hughes","logo":{"@type":"ImageObject","url":"https://blog.jimdhughes.com/favicon.ico"}}}</script></head><body id="
  top"><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.jimdhughes.com/ accesskey=h title="James Hughes (Alt + H)">James Hughes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Go - Micro-services and Embedded Databases [Part 1]</h1><div class=post-meta><span title='2018-09-19 06:30:15 +0000 UTC'>September 19, 2018</span>&nbsp;·&nbsp;James D Hughes</div></header><div class=post-content><p>This is fun!</p><p>FYI - If you&rsquo;re looking for Part 2, it&rsquo;s <a href=https://blog.jimdhughes.com/go-micro-services-and-embedded-databases-part-2/>here</a>[.]</p><hr><p>I&rsquo;ve been meaning to learn a few of the things I&rsquo;m going to go over in this post. Firstly, I want to make an actual useful application using Go. I want it to be run as a microservice with it&rsquo;s own database. Instead of putting it in a docker container, I want to just use an embedded database that the executable can use.</p><p>We&rsquo;re going to build a user authentication and token validation app. It&rsquo;ll use REST for communication (gRPC may come later) and will store users using BoltDB. The server will allow registration, logging in, will issue tokens and will validate tokens.</p><p>The endpoints for our app will be:</p><p>POST /login - Takes an email and password and attempts to log a user in</p><p>POST /register - Takes an email and password an attempts to create a new user</p><p>POST /validateToken - checks a supplied token. If it&rsquo;s valid it sends back the information of the authenticated user.</p><p>We&rsquo;re going to use a couple golang libraries that seem pretty popular. For routing, we will use <a href=https://github.com/gorilla/mux>gorilla/mux</a>, for the database we will use <a href=https://github.com/boltdb/bolt>boltdb/bolt</a> and for password hashing we will use <a href=https://godoc.org/golang.org/x/crypto/bcrypt>golang.org/x/crypto/bcrypt</a>. Go ahead and &lsquo;go get&rsquo; them and we&rsquo;ll dive right in.</p><p>I start every go project by making a main.go and printing a simple Hello, World! so let&rsquo;s start there again</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Hello, World!&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>It&rsquo;s kind of hard to figure out where to start next. I&rsquo;m going to elect to start by making my model. I&rsquo;m going to make a new file called <code>model.go</code> and it&rsquo;ll look like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// User structure for accounts</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ID</span>       <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;id&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Email</span>    <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;email&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Password</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;password&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Since we&rsquo;re going to need to encrypt and check password hashes, we may as well just attach it the the User struct. Let&rsquo;s do that next.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// HashPassword sets the users password to the bcrypt hashed version of said password</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>u</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>) <span style=color:#a6e22e>HashPassword</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>password</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bcrypt</span>.<span style=color:#a6e22e>GenerateFromPassword</span>([]byte(<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Password</span>), <span style=color:#ae81ff>14</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Password</span> = string(<span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// CheckPassword compares a plain text password against the Hashed Password of the user</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>u</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>) <span style=color:#a6e22e>CheckPassword</span>(<span style=color:#a6e22e>password</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bcrypt</span>.<span style=color:#a6e22e>CompareHashAndPassword</span>([]byte(<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Password</span>), []byte(<span style=color:#a6e22e>password</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We now have some testable code! For fun let&rsquo;s write a test for the password hasing!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestUserPassword</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>password</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;testpassword&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>User</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Email</span>:    <span style=color:#e6db74>&#34;testEmail@domain.com&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Password</span>: <span style=color:#a6e22e>password</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>HashPassword</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Password</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>password</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Password failed to hash</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fail</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestUserPasswordCompareCorrectPassword</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>password</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;testpassword&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>User</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Email</span>:    <span style=color:#e6db74>&#34;testEmail@domain.com&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Password</span>: <span style=color:#a6e22e>password</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>HashPassword</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>CheckPassword</span>(<span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestUserPasswordCompareIncorrectPassword</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>password</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;testpassword&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>User</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Email</span>:    <span style=color:#e6db74>&#34;testEmail@domain.com&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Password</span>: <span style=color:#a6e22e>password</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>password</span> = <span style=color:#e6db74>&#34;nope!&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>HashPassword</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>CheckPassword</span>(<span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Run these tests using <code>go test</code>. Everything should pass and now we can move on to making some actual functionality!</p><p>Next I want to make some placeholder routes to handle the requests we want to handle. To do this, let&rsquo;s make a new file called <code>router.go</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/gorilla/mux&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewRouter</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>Router</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>NewRouter</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/login&#34;</span>, <span style=color:#a6e22e>HandleLogin</span>).<span style=color:#a6e22e>Methods</span>(<span style=color:#e6db74>&#34;POST&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/register&#34;</span>, <span style=color:#a6e22e>HandleRegistration</span>).<span style=color:#a6e22e>Methods</span>(<span style=color:#e6db74>&#34;POST&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/validateToken&#34;</span>, <span style=color:#a6e22e>HandleValidateToken</span>).<span style=color:#a6e22e>Methods</span>(<span style=color:#e6db74>&#34;POST&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HandleLogin</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Not Yet Implemented&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HandleRegistration</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Not Yet Implemented&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HandleValidateToken</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Not Yet Implemented&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then we update our <code>main.go</code> file to initialize the router and serve up our routes that will all issue error responses!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Hello, World!&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>InitializeHttpServer</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>InitializeHttpServer</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewRouter</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Panic</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#a6e22e>r</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I like to use postman to test my apis but you can curl it if you want. Go ahead and send some POST requests to our endpoints and you&rsquo;ll get a simple 500 response with &ldquo;Not Yet Implemented&rdquo; as the response.</p><p>Next we can either implement a service to handle these requests or we can implement the database interface. I&rsquo;m going to elect to implement the database functionality because I&rsquo;m a bit of a database nerd. BoltDB is a key/value store which is really all that we need for implementing an authentication database in a microservice. I&rsquo;m not going to do anything fancy such as allowing token invalidation etc so this should be pretty simple! Let&rsquo;s make a new file called <code>db.go</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;strconv&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/boltdb/bolt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Interface for the DB Client</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>IDBClient</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Initialize</span>(<span style=color:#a6e22e>filepath</span> <span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Open</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>u</span> <span style=color:#a6e22e>User</span>) (<span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Login</span>(<span style=color:#a6e22e>email</span>, <span style=color:#a6e22e>password</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CheckUserIsNew</span>(<span style=color:#a6e22e>email</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// Struct to handle the DB Connection</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DBClient</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>client</span>   <span style=color:#f92672>*</span><span style=color:#a6e22e>bolt</span>.<span style=color:#a6e22e>DB</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>filepath</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The DB Client for the application</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>DB</span> <span style=color:#a6e22e>IDBClient</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>usersBucketName</span> <span style=color:#66d9ef>string</span> = <span style=color:#e6db74>&#34;Users&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>Open</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>Initialize</span>(<span style=color:#a6e22e>filepath</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>Close</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>u</span> <span style=color:#a6e22e>User</span>) (<span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Not Implemented&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>Login</span>(<span style=color:#a6e22e>email</span>, <span style=color:#a6e22e>password</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Not Implemented&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>CheckUserIsNew</span>(<span style=color:#a6e22e>email</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Not Implemented&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I&rsquo;m no go pro but this is how I understand that go apps are organized. My OOP career has drilled into my head that you should always program against an interface so when they exist, I use them.</p><p>The DBClient is sort of like a class. We&rsquo;re going to use it to store the bolt client, the location of the filepath, and then we are going to declare methods for it by using the syntax that is seen below. The <code>var DB IDBClient</code> line helps us to initialize the database handler and makes sure that our initialization of DBClient has all the functions as defined by the IDBClient interface. Clear as mud? Let&rsquo;s do it then!</p><p>First we may as well handle the easy stuff: Initialize, Open, and Close.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>Initialize</span>(<span style=color:#a6e22e>filepath</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>filepath</span> = <span style=color:#a6e22e>filepath</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Open</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>txn</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bolt</span>.<span style=color:#a6e22e>Tx</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Initialize Users Bucket</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>txn</span>.<span style=color:#a6e22e>CreateBucketIfNotExists</span>([]byte(<span style=color:#a6e22e>usersBucketName</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Panic</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>Open</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>filepath</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#e6db74>&#34;Filepath required for Database&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>d</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bolt</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>filepath</span>, <span style=color:#ae81ff>0600</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Panic</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>client</span> = <span style=color:#a6e22e>d</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>Close</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The Initialize function takes a filepath. This would be the same as taking in an SQL connection string in any other app. This makes it way easier for us to set up our environment for testing and for production. We can set up and tear down test databases while leaving our production an development databases alone. We then set up the buckets that our app is going to need (which is just a <code>Users</code> bucket for now).</p><p>The Open function does just that. Opens the database and applies it to it&rsquo;s client parameter. The close does just what you&rsquo;d expect a close function to do as well.</p><p>We may as well write the functional code now. We&rsquo;ll start with <code>CreateUser</code> and <code>CheckUserIsNew</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>u</span> <span style=color:#a6e22e>User</span>) (<span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>isNew</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>CheckUserIsNew</span>(<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Email</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>isNew</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>false</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Open</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>txn</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bolt</span>.<span style=color:#a6e22e>Tx</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>b</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>txn</span>.<span style=color:#a6e22e>Bucket</span>([]byte(<span style=color:#a6e22e>usersBucketName</span>))
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>NextSequence</span>()
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>ID</span> = <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>Itoa</span>(int(<span style=color:#a6e22e>id</span>))
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>HashPassword</span>()
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>userBytes</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>u</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Put</span>([]byte(<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Email</span>), <span style=color:#a6e22e>userBytes</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>CheckUserIsNew</span>(<span style=color:#a6e22e>email</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Open</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>View</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>tx</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bolt</span>.<span style=color:#a6e22e>Tx</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>b</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>Bucket</span>([]byte(<span style=color:#a6e22e>usersBucketName</span>))
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>userBytes</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Get</span>([]byte(<span style=color:#a6e22e>email</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>userBytes</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;User with email %s already exists&#34;</span>, <span style=color:#a6e22e>email</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>CheckUserIsNew</code> is just a helper function to determine if our user exists in the database already or not. This is helpful as we don&rsquo;t really have key constraints in the embedded database. We need to ensure that we&rsquo;re not just re-registering users when a registration request comes in. The <code>CreateUser</code> calls this as soon as possible and if a user exists, it returns an error. The <code>CreateUser</code> will then return this error to the calling function.</p><p>We can write some tests for this now! in <code>db_test.go</code> let&rsquo;s set up some cases</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestMain</span>(<span style=color:#a6e22e>m</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>M</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DB</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>DBClient</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>Initialize</span>(<span style=color:#e6db74>&#34;./bolt-test.db&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>retCode</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>Run</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Remove</span>(<span style=color:#e6db74>&#34;./bolt-test.db&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#a6e22e>retCode</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestCheckUserShouldNotReturnError</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>email</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;test@domain.com&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>isNew</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>CheckUserIsNew</span>(<span style=color:#a6e22e>email</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;An Error was thrown that should not have been&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>isNew</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>false</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;User shouldn&#39;t Exist but does&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestCreateUser</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>User</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Email</span>:    <span style=color:#e6db74>&#34;test@domain.com&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Password</span>: <span style=color:#e6db74>&#34;password&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>u</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>false</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;User not created&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestCreateUserWithSameEmailShouldFail</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>User</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Email</span>:    <span style=color:#e6db74>&#34;test@domain.com&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Password</span>: <span style=color:#e6db74>&#34;password&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>u</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;User not created&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestCheckUserShouldReturnError</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>email</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;test@domain.com&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>isNew</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>CheckUserIsNew</span>(<span style=color:#a6e22e>email</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>isNew</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;User Should Exist but doesn&#39;t&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Error should have been thrown&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We first make sure that our <code>CheckUserExists</code> function returns false. We then test some <code>CreateUser</code> functionality and then finally make sure that our <code>CheckUserExists</code> returns an error as the account does already exist. Follow? Sweet! Let&rsquo;s move on to the <code>Login</code> function!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// db.go</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DBClient</span>) <span style=color:#a6e22e>Login</span>(<span style=color:#a6e22e>email</span>, <span style=color:#a6e22e>password</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Open</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>View</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>tx</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bolt</span>.<span style=color:#a6e22e>Tx</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>b</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>Bucket</span>([]byte(<span style=color:#a6e22e>usersBucketName</span>))
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>userBytes</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Get</span>([]byte(<span style=color:#a6e22e>email</span>))
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>u</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>User</span>{}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>userBytes</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>u</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>CheckPassword</span>(<span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ERROR: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Invalid Login Attempt for User: %s&#34;</span>, <span style=color:#a6e22e>email</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Invalid Email/Password Combnation&#34;</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;nope&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;yep&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here we take an email and password, load up the user from the database, check if the password is the valid hash, and then return a string response. We will replace this &ldquo;nope&rdquo; and &ldquo;yep&rdquo; with a token later but for now we will just use these.</p><p>And again let&rsquo;s make sure that we have some test cases for <code>Login</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// db_test.go</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestValidLogin</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>Login</span>(<span style=color:#e6db74>&#34;test@domain.com&#34;</span>, <span style=color:#e6db74>&#34;password&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestInvalidLogin</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>Login</span>(<span style=color:#e6db74>&#34;test@domain.com&#34;</span>, <span style=color:#e6db74>&#34;wrongpassword&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;The password should have been invalid&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Check our code again using <code>go test</code> and we should pass everything.</p><hr><h1 id=a-note-on-tests>A Note on Tests<a hidden class=anchor aria-hidden=true href=#a-note-on-tests>#</a></h1><p>This isn&rsquo;t really TDD. This is what we call lazy testing. Typically you&rsquo;d write tests to test your functionality and THEN implement the code. This allows you to come up with as many different scenarios as possible and then write resilient code. That&rsquo;s outside the scope of this little learning activity but some tests are better than no tests.</p><hr><p>Now that we have our core functionality in controllers we need to expose it externally. We will do this by going back to our <code>router.go</code> file and adding some real functionality as opposed to just throwing random errors :)</p><p>Logically, we&rsquo;ll implement the registration route first:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HandleRegistration</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>user</span> <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>decoder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewDecoder</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Body</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>decoder</span>.<span style=color:#a6e22e>Decode</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>WriteError</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Error Decoding User&#34;</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>success</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>WriteError</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Status: %t&#34;</span>, <span style=color:#a6e22e>success</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>WriteError</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>statusCode</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>statusCode</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You&rsquo;ll notice that I added a <code>WriteError</code> helper function since it&rsquo;s easier than repeating this code over and over again. Passing the actual error through to the client is PROBABLY not a great idea in a production environment though.</p><p>Before we can successfully build and run this, we will need to initialize our database. In <code>main.go</code> we&rsquo;ll add a helper function and call it before we initialize the Router.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Hello, World!&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>InitializeDatabase</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>InitializeHttpServer</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>InitializeHttpServer</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewRouter</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Panic</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#a6e22e>r</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>InitializeDatabase</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DB</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>DBClient</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>Initialize</span>(<span style=color:#e6db74>&#34;bolt.db&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now - Build it and run! <code>go build</code> and <code>./whatever-your-foldername-is</code> if you&rsquo;re on *nix or <code>./whatever-your-foldername-is.exe</code> if you&rsquo;re on windows! I use Postman, you can use CURL if you like, but no matter what let&rsquo;s send a registration request to <code>http://localhost:8080/register</code> with a payload of</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;someemail@domain.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;password&#34;</span>: <span style=color:#e6db74>&#34;password&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You should get a response of: <code>Status: true</code>. Success! We have registered a user!</p><p>Now we should allow this user to login. We&rsquo;ll implement the <code>HandleLogin</code> handler next.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HandleLogin</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>user</span> <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>decoder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewDecoder</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Body</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>decoder</span>.<span style=color:#a6e22e>Decode</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>WriteError</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Error Decoding User&#34;</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>status</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>Login</span>(<span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Email</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Password</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>WriteError</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>status</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Buld and run again! Send a POST to <code>http://localhost:8080/login</code> with the payload</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;someemail@domain.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;password&#34;</span>: <span style=color:#e6db74>&#34;password&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And you should get the message: <code>yep</code>.</p><p>Anyways, this post has gotten REALLY long. So check back for part 2 where we implement the token service, the <code>tokenValidation</code> endpoints, and make some more interesting responses that can be digested better by a calling service.</p><p>Keep Hacking!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.jimdhughes.com/tags/golang/>Golang</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://blog.jimdhughes.com/>James Hughes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>